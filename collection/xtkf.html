<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>IO 系统开发 | suting-Blogs</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="分布式博客云笔记">
    
    <link rel="preload" href="/assets/css/0.styles.386f4818.css" as="style"><link rel="preload" href="/assets/js/app.e2ddde8e.js" as="script"><link rel="preload" href="/assets/js/2.e74445cb.js" as="script"><link rel="preload" href="/assets/js/46.3ddc24a7.js" as="script"><link rel="prefetch" href="/assets/js/10.383382f2.js"><link rel="prefetch" href="/assets/js/11.79913c72.js"><link rel="prefetch" href="/assets/js/12.18e85316.js"><link rel="prefetch" href="/assets/js/13.78e33ed3.js"><link rel="prefetch" href="/assets/js/14.92269bd7.js"><link rel="prefetch" href="/assets/js/15.acc92b96.js"><link rel="prefetch" href="/assets/js/16.d8716382.js"><link rel="prefetch" href="/assets/js/17.fa6a1da4.js"><link rel="prefetch" href="/assets/js/18.c5024350.js"><link rel="prefetch" href="/assets/js/19.c3e206a7.js"><link rel="prefetch" href="/assets/js/20.6a00e35f.js"><link rel="prefetch" href="/assets/js/21.37c42ff6.js"><link rel="prefetch" href="/assets/js/22.abd1537f.js"><link rel="prefetch" href="/assets/js/23.6a041ee1.js"><link rel="prefetch" href="/assets/js/24.ab067683.js"><link rel="prefetch" href="/assets/js/25.a2de42cd.js"><link rel="prefetch" href="/assets/js/26.efa7caf3.js"><link rel="prefetch" href="/assets/js/27.1520ec85.js"><link rel="prefetch" href="/assets/js/28.be40ede1.js"><link rel="prefetch" href="/assets/js/29.5e42d4f2.js"><link rel="prefetch" href="/assets/js/3.fbcd2674.js"><link rel="prefetch" href="/assets/js/30.eae39a3c.js"><link rel="prefetch" href="/assets/js/31.63618f89.js"><link rel="prefetch" href="/assets/js/32.43b53339.js"><link rel="prefetch" href="/assets/js/33.931d2183.js"><link rel="prefetch" href="/assets/js/34.e7f37503.js"><link rel="prefetch" href="/assets/js/35.6302af3d.js"><link rel="prefetch" href="/assets/js/36.7aec4478.js"><link rel="prefetch" href="/assets/js/37.58461b9d.js"><link rel="prefetch" href="/assets/js/38.811a26e0.js"><link rel="prefetch" href="/assets/js/39.c3d07ac9.js"><link rel="prefetch" href="/assets/js/4.23df146b.js"><link rel="prefetch" href="/assets/js/40.b2c32317.js"><link rel="prefetch" href="/assets/js/41.368ac455.js"><link rel="prefetch" href="/assets/js/42.d68c9491.js"><link rel="prefetch" href="/assets/js/43.74a44b32.js"><link rel="prefetch" href="/assets/js/44.633f2e2b.js"><link rel="prefetch" href="/assets/js/45.eab6bf9b.js"><link rel="prefetch" href="/assets/js/5.4c581b45.js"><link rel="prefetch" href="/assets/js/6.27888615.js"><link rel="prefetch" href="/assets/js/7.e23a1d77.js"><link rel="prefetch" href="/assets/js/8.928501ca.js"><link rel="prefetch" href="/assets/js/9.0b4be001.js">
    <link rel="stylesheet" href="/assets/css/0.styles.386f4818.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">suting-Blogs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  home
</a></div><div class="nav-item"><a href="https://javaguide.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaGuide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://home.code-nav.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  code-nav
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/sutinghu153" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://mp.weixin.qq.com/mp/profile_ext?action=home&amp;__biz=MzA5ODI3NTI1OA==&amp;scene=124#wechat_redirect" target="_blank" rel="noopener noreferrer" class="nav-link external">
  WK听潮
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/itdevbooks/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  book
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  湘ICP备2021013988号-1
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  home
</a></div><div class="nav-item"><a href="https://javaguide.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaGuide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://home.code-nav.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  code-nav
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/sutinghu153" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://mp.weixin.qq.com/mp/profile_ext?action=home&amp;__biz=MzA5ODI3NTI1OA==&amp;scene=124#wechat_redirect" target="_blank" rel="noopener noreferrer" class="nav-link external">
  WK听潮
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/itdevbooks/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  book
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  湘ICP备2021013988号-1
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>个人项目</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>C/C++/Java/Golang</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux内核</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Linux系统开发</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/collection/xtkf.html" aria-current="page" class="active sidebar-link">IO-系统开发</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/collection/xtkf.html#关于linux" class="sidebar-link">关于Linux</a></li><li class="sidebar-sub-header"><a href="/collection/xtkf.html#文件io" class="sidebar-link">文件IO</a></li><li class="sidebar-sub-header"><a href="/collection/xtkf.html#标准io" class="sidebar-link">标准IO</a></li><li class="sidebar-sub-header"><a href="/collection/xtkf.html#函数库的制作" class="sidebar-link">函数库的制作</a></li><li class="sidebar-sub-header"><a href="/collection/xtkf.html#目录io" class="sidebar-link">目录IO</a></li><li class="sidebar-sub-header"><a href="/collection/xtkf.html#单机模式下文件的上传和下载实现" class="sidebar-link">单机模式下文件的上传和下载实现</a></li></ul></li><li><a href="/collection/jcjtx.html" class="sidebar-link">进程间通信</a></li><li><a href="/collection/dxctx.html" class="sidebar-link">Linux多线程</a></li><li><a href="/collection/netcode.html" class="sidebar-link">网络编程</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux/Makefile/Shell</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>区块链</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机视觉</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中间件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>常用命令</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>系统部署</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="io-系统开发"><a href="#io-系统开发" class="header-anchor">#</a> IO 系统开发</h1> <h2 id="关于linux"><a href="#关于linux" class="header-anchor">#</a> 关于Linux</h2> <h3 id="_01-linux的五大功能"><a href="#_01-linux的五大功能" class="header-anchor">#</a> 01 Linux的五大功能</h3> <p>文件管理</p> <p>进程管理</p> <p>内存管理</p> <p>网络管理</p> <h3 id="_02-linux高级编程的特点"><a href="#_02-linux高级编程的特点" class="header-anchor">#</a> 02 Linux高级编程的特点</h3> <p>涉及到内核向用户空间提供的接口</p> <ol><li>内核要为应用程序服务，否则应用程序很单一</li> <li>内核是稳定的代码，同时也要为多个用户空间服务，为了防止用户空间某些用户程序使用内核代码产生其它问题</li></ol> <p>内核向用户空间提供接口，同时在接口上添加保护，这样会使符合接口函数的应用程序提供服务，同时也保护内核。</p> <h3 id="_03-系统编程的三要素"><a href="#_03-系统编程的三要素" class="header-anchor">#</a> 03 系统编程的三要素</h3> <p>接口</p> <p>参数</p> <p>返回值</p> <h2 id="文件io"><a href="#文件io" class="header-anchor">#</a> 文件IO</h2> <h3 id="_01-关于文件io"><a href="#_01-关于文件io" class="header-anchor">#</a> 01 关于文件IO</h3> <p>应用层：输入，内核输至应用层。输出，应用层输至内核层</p> <p>内核层：</p> <p>硬件层</p> <p>是从用户空间角度考虑</p> <p>input:输入，内核输至应用层</p> <p>output:输出，应用层输至内核层</p> <p>相关函数</p> <ul><li>open：打开内核的文件</li> <li>read：读取内核中的文件</li> <li>write：写入内核中的文件</li> <li>close：关闭内核中的文件</li> <li>leek：调整读写的位置指针</li></ul> <h3 id="_02-相关函数"><a href="#_02-相关函数" class="header-anchor">#</a> 02 相关函数</h3> <h4 id="_01-open函数"><a href="#_01-open函数" class="header-anchor">#</a> 01 open函数</h4> <h5 id="函数功能"><a href="#函数功能" class="header-anchor">#</a> 函数功能</h5> <ul><li>打开一个文件</li> <li>创建一个文件</li></ul> <h5 id="参数列表"><a href="#参数列表" class="header-anchor">#</a> 参数列表</h5> <table><thead><tr><th style="text-align:center;">参数名</th> <th style="text-align:center;">参数说明</th></tr></thead> <tbody><tr><td style="text-align:center;">char*</td> <td style="text-align:center;">包含有文件名和路径</td></tr> <tr><td style="text-align:center;">flag</td> <td style="text-align:center;">操作文件</td></tr> <tr><td style="text-align:center;">mode</td> <td style="text-align:center;">创建文件的权限</td></tr></tbody></table> <h5 id="参数用法"><a href="#参数用法" class="header-anchor">#</a> <strong>参数用法</strong></h5> <table><thead><tr><th style="text-align:center;">flag</th> <th style="text-align:center;">功能</th></tr></thead> <tbody><tr><td style="text-align:center;">O_RDONLY</td> <td style="text-align:center;">只读</td></tr> <tr><td style="text-align:center;">O_WRONLY</td> <td style="text-align:center;">只写</td></tr> <tr><td style="text-align:center;">O_RDWR</td> <td style="text-align:center;">读写</td></tr> <tr><td style="text-align:center;">O_CREAT</td> <td style="text-align:center;">创建一个文件</td></tr> <tr><td style="text-align:center;">O_TRUNC</td> <td style="text-align:center;">打开文件（会把已经存在的内容删除）</td></tr> <tr><td style="text-align:center;">O_APPEND</td> <td style="text-align:center;">追加方式用于打开文件（不会删除已存在的内容）</td></tr> <tr><td style="text-align:center;">O_EXCL</td> <td style="text-align:center;">如果创建一个文件时存在，则返回错误消息，该参数用于测试文件是否存在</td></tr></tbody></table> <h5 id="返回值"><a href="#返回值" class="header-anchor">#</a> <strong>返回值</strong></h5> <ul><li>成功：文件描述符，它是一个非负的正整数，即文件的ID号，相当于人的身份证号</li> <li>失败：-1</li></ul> <h5 id="关于文件描述符"><a href="#关于文件描述符" class="header-anchor">#</a> <strong>关于文件描述符</strong></h5> <p>ls -lai 可以获取文件描述符。</p> <ul><li>每个文件的描述符并不是固定的</li> <li>文件描述符总是从3开始，因为系统创建的进程默认为打开 3 个文件
<ul><li>标准输入（0）</li> <li>标准输出（1）</li> <li>标准错误（2）</li></ul></li> <li>文件描述符不是递增产生的，并且可以被回收且进行再次分配</li> <li>文件描述符是非负整型</li> <li>每个进程单独维护了一个文件描述符的集合</li> <li>文件描述符其实就是file结构体数组的索引</li></ul> <blockquote><p><a href="https://zhuanlan.zhihu.com/p/108744787" target="_blank" rel="noopener noreferrer">文件描述符了解一下 - 知乎 (zhihu.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h5 id="设计touch函数"><a href="#设计touch函数" class="header-anchor">#</a> <strong>设计touch函数</strong></h5> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">// touch函数的实现</span>
<span class="token comment">// 文件创建函数</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;stdio.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;unistd.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;fcntl.h&quot;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">int</span> fd<span class="token punctuation">;</span>
	fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>O_CREAT <span class="token operator">|</span> O_RDWR<span class="token punctuation">,</span><span class="token number">0777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>fd<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;创建了一个文件 %s &quot;</span><span class="token punctuation">,</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;创建了一个文件 %s sucess fd=%d\n &quot;</span><span class="token punctuation">,</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  
</code></pre></div><h5 id="umask【权限掩码】"><a href="#umask【权限掩码】" class="header-anchor">#</a> <strong>umask</strong>【权限掩码】</h5> <ul><li><p>​	linux umask命令指定在建立文件时预设的权限掩码。</p></li> <li><p>​	umask可用来设定[权限掩码]。[权限掩码]是由3个八进制的数字所组成，将现有的存取权限减掉权限掩码后，即可产生建立文件时预设的权限。</p></li></ul> <h5 id="如当掩码为022时"><a href="#如当掩码为022时" class="header-anchor">#</a> <strong>如当掩码为022时：</strong></h5> <div class="language- extra-class"><pre class="language-text"><code>掩码：将权限掩掉了

777：111 111 111 本身权限

022：000 010 010 掩码

755：111 101 101 掩码结果
</code></pre></div><h4 id="_02-read-write函数"><a href="#_02-read-write函数" class="header-anchor">#</a> 02 read&amp;write函数</h4> <p>向Linux内核中写入流。内核中存在很多文件，将流写入某个文件时，为write。</p> <p>将流从文件中读取时，为read。</p> <h5 id="参数与返回值"><a href="#参数与返回值" class="header-anchor">#</a> 参数与返回值</h5> <p>*<em>write(int fd,void <em>buf,size_t touch)</em></em></p> <p>*<em>read(int fd,void <em>buf,size_t touch)</em></em></p> <table><thead><tr><th style="text-align:center;">函数</th> <th style="text-align:center;">条件</th> <th style="text-align:center;">具体描述</th></tr></thead> <tbody><tr><td style="text-align:center;">write</td> <td style="text-align:center;">写到哪里去,文件描述符</td> <td style="text-align:center;">int fld</td></tr> <tr><td style="text-align:center;">write</td> <td style="text-align:center;">写入什么,存放要写入的数据的缓冲区首地址</td> <td style="text-align:center;">void *buff</td></tr> <tr><td style="text-align:center;">write</td> <td style="text-align:center;">写多少个,想要写入的字节数</td> <td style="text-align:center;">size t touch</td></tr> <tr><td style="text-align:center;">write</td> <td style="text-align:center;">返回值</td> <td style="text-align:center;">实际写入的字节数</td></tr> <tr><td style="text-align:center;"></td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">read</td> <td style="text-align:center;">从哪里读,文件描述符</td> <td style="text-align:center;">int fld</td></tr> <tr><td style="text-align:center;">read</td> <td style="text-align:center;">读到哪里去,存放要写入的数据的缓冲区首地址</td> <td style="text-align:center;">void *buff</td></tr> <tr><td style="text-align:center;">read</td> <td style="text-align:center;">想读多少个,想要写入的字节数</td> <td style="text-align:center;">size t touch</td></tr> <tr><td style="text-align:center;">read</td> <td style="text-align:center;">返回值</td> <td style="text-align:center;">实际读出的字节数</td></tr></tbody></table> <h5 id="write函数测试"><a href="#write函数测试" class="header-anchor">#</a> <strong>write函数测试</strong></h5> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;stdio.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;unistd.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;fcntl.h&quot;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">int</span> fd<span class="token punctuation">;</span>
	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;hello world&quot;</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> wr_ret<span class="token punctuation">;</span>
	fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;./a.c&quot;</span><span class="token punctuation">,</span>O_RDWR<span class="token operator">|</span>O_TRUNC<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span>fd<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;open file a.c failure\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;open file a.c success fd = %d\n&quot;</span><span class="token punctuation">,</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
	wr_ret <span class="token operator">=</span> <span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;写入的字节数为 ： %d\n&quot;</span><span class="token punctuation">,</span>wr_ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_03-close函数"><a href="#_03-close函数" class="header-anchor">#</a> 03 close函数</h4> <p><strong>int close(int fd);</strong></p> <h5 id="参数与返回值-2"><a href="#参数与返回值-2" class="header-anchor">#</a> 参数与返回值</h5> <ul><li>fd 文件描述符</li> <li>调用成功返回0，否则返回-1并设置errno；</li></ul> <h4 id="_04-lseek函数"><a href="#_04-lseek函数" class="header-anchor">#</a> 04 lseek函数</h4> <h5 id="功能"><a href="#功能" class="header-anchor">#</a> 功能</h5> <p>调整读写的位置指针。</p> <p><strong>lseek(int fd,off_t offset,int whence)</strong></p> <h5 id="参数说明"><a href="#参数说明" class="header-anchor">#</a> 参数说明</h5> <table><thead><tr><th style="text-align:center;">参数名称</th> <th style="text-align:center;">解释</th> <th style="text-align:center;">参数说明</th></tr></thead> <tbody><tr><td style="text-align:center;">int fd</td> <td style="text-align:center;"></td> <td style="text-align:center;">要调整的文件的文件描述符</td></tr> <tr><td style="text-align:center;">off_t offset</td> <td style="text-align:center;"></td> <td style="text-align:center;">偏移量，每读写操作所需要移动的距离，单位是字节的数量，可正可负（前移，后移）</td></tr> <tr><td style="text-align:center;">int whence</td> <td style="text-align:center;"></td> <td style="text-align:center;">当前位置的基点</td></tr></tbody></table> <h5 id="int-whence-参数说明"><a href="#int-whence-参数说明" class="header-anchor">#</a> int whence 参数说明</h5> <table><thead><tr><th style="text-align:center;">参数</th> <th style="text-align:center;">说明</th> <th style="text-align:center;"></th></tr></thead> <tbody><tr><td style="text-align:center;">SEEK_SET</td> <td style="text-align:center;">当前位置的文件开头，新位置为偏移量的大小</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">SEEK_CUR</td> <td style="text-align:center;">当前位置为文件指针位置，新位置为当前位置加上偏移量</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">SEEK_END</td> <td style="text-align:center;">当前位置为文件的结尾，新位置为文件的大小加偏移量的大小</td> <td style="text-align:center;"></td></tr></tbody></table> <h5 id="返回值-说明"><a href="#返回值-说明" class="header-anchor">#</a> 返回值 说明</h5> <ul><li>成功 文件当前的位置</li> <li>失败 -1</li></ul> <h5 id="通过lseek实现cp命令"><a href="#通过lseek实现cp命令" class="header-anchor">#</a> 通过lseek实现cp命令</h5> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;stdio.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;unistd.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;fcntl.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;string.h&quot;</span> </span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// 操作文件的文件描述符和目标文件的文件描述符 </span>
	<span class="token keyword">int</span> rd_fd<span class="token punctuation">,</span>wr_fd<span class="token punctuation">;</span>
	<span class="token comment">// 缓冲区 </span>
	<span class="token keyword">char</span> read_buf<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span> 
	<span class="token comment">//  保存文件的文件描述符 </span>
	<span class="token keyword">int</span> rd_ret <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 
	<span class="token comment">// 如果没有源文件和目标文件路径 </span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>argc<span class="token operator">&lt;</span><span class="token number">3</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;please input src file and des file\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>		
	<span class="token punctuation">}</span>
	<span class="token comment">// 打开操作文件 </span>
	rd_fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">;</span> 
	<span class="token comment">// 如果操作文件报错 </span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>rd_fd<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;open src file %s failure\n&quot;</span><span class="token punctuation">,</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> 
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;open src file %s success,rd_fd=%d\n&quot;</span><span class="token punctuation">,</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>rd_fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 打开目标文件 </span>
	wr_fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>O_WRONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 如果目标文件报错 </span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>wr_fd<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;open des file %s failure\n&quot;</span><span class="token punctuation">,</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> 
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;open des file %s success,rd_fd=%d\n&quot;</span><span class="token punctuation">,</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>wr_fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 将内容从源文件copy到目标文件</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		rd_ret <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>rd_fd<span class="token punctuation">,</span>read_buf<span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>rd_ret<span class="token operator">&lt;</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token function">write</span><span class="token punctuation">(</span>wr_fd<span class="token punctuation">,</span>read_buf<span class="token punctuation">,</span>rd_ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 清空缓存 </span>
		<span class="token function">memset</span><span class="token punctuation">(</span>read_buf<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> 
	<span class="token function">write</span><span class="token punctuation">(</span>wr_fd<span class="token punctuation">,</span>read_buf<span class="token punctuation">,</span>rd_ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">close</span><span class="token punctuation">(</span>rd_fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">close</span><span class="token punctuation">(</span>wr_fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


</code></pre></div><h2 id="标准io"><a href="#标准io" class="header-anchor">#</a> 标准IO</h2> <h3 id="_01-标准io与文件io的区别"><a href="#_01-标准io与文件io的区别" class="header-anchor">#</a> 01 标准IO与文件IO的区别</h3> <ol><li><p>文件IO，是直接调用内核提供的系统调用函数，头文件是unistd.h</p></li> <li><p>标准IO，是间接调用系统调用函数，头文件是stdio.h</p> <div class="language- extra-class"><pre class="language-text"><code>getchar(),putchar()--单个字符
gets(),puts()--多个字符
scanf(),printf()--多个或单个都可

输入输出相关的函数，都是和标准的输入（键盘），标准的输出（显示器）相关，与一些普通文件的读写没有关系，即这些函数不能读写普通文件。
</code></pre></div></li> <li><p>标准的IO中的相关函数，不仅可以读写普通文件，也可以向标准的输入或标准的输出中读写。</p></li> <li><p>Linux中做文件IO最常用到的5个函数是： open ,  close ,  read ,  write 和 lseek ，不是ISO C的组成部分，这5个函数是<strong>不带缓冲的IO</strong>，也即每个read和write都调用了内核的一个系统调用。</p></li> <li><p>标准IO库提供缓冲功能，减少系统调用。</p></li> <li><p>文件IO函数直接操作内核函数，标准IO函数先操作C库函数，获得一定的缓冲。</p></li></ol> <h3 id="_02-三个缓存的概念"><a href="#_02-三个缓存的概念" class="header-anchor">#</a> 02 三个缓存的概念</h3> <ol><li>用户空间的缓存，user buff，用户空间的缓存（用户使用的缓存）</li> <li>内核空间的缓存，kernel buff，内核在使用时会开辟内核缓存(最底层的缓存)</li> <li>库缓存，lib buff，标准IO中调用库函数时的缓存（缓冲缓存的缓存）</li></ol> <h3 id="_03-缓存的特征"><a href="#_03-缓存的特征" class="header-anchor">#</a> 03 缓存的特征</h3> <ol><li>printf 函数在满足一定的条件，即 遇到 \n 时，会将库缓存的内容写到内核中，即调用了系统调用函数。</li> <li>库缓存写满时，会调用系统调用函数。库缓存大小为 1024 byte.</li></ol> <h3 id="_04-缓存的分类"><a href="#_04-缓存的分类" class="header-anchor">#</a> 04 缓存的分类</h3> <h4 id="全缓存"><a href="#全缓存" class="header-anchor">#</a> 全缓存</h4> <p>全缓冲指的是系统在填满标准IO缓冲区之后才进行实际的IO操作；注意，对于驻留在磁盘上的文件来说通常是由标准IO库实施全缓冲。</p> <h4 id="行缓存"><a href="#行缓存" class="header-anchor">#</a> 行缓存</h4> <p>遇到 <strong>\n</strong> 时会将库缓存中的内容写入内核中。行缓存1024byte.</p> <h4 id="无缓存"><a href="#无缓存" class="header-anchor">#</a> 无缓存</h4> <p>无缓冲指的是标准IO库不对字符进行缓冲存储；注意，标准出错流stderr通常是无缓冲的。</p> <h4 id="缓冲区"><a href="#缓冲区" class="header-anchor">#</a> 缓冲区</h4> <p>缓冲区是库函数在系统调用的上层，是对系统调用的封装。</p> <h3 id="_05-相关的函数"><a href="#_05-相关的函数" class="header-anchor">#</a> 05 相关的函数</h3> <h4 id="打开-创建-fopen"><a href="#打开-创建-fopen" class="header-anchor">#</a> 打开/创建 fopen()</h4> <p>FILE *fopen(const char *path,const char *mode);</p> <h5 id="返回值-2"><a href="#返回值-2" class="header-anchor">#</a> 返回值</h5> <p>FILE* 文件流指针 类似于IO中的文件描述符</p> <p>FILE定义：struct_IO_FILE，在/usr/include/libio.h中包含读写缓存的首地址、大小、位置指针等。</p> <ul><li>stdin 标准输入流</li> <li>stdout 标准输出流</li> <li>stder 标准出错流</li></ul> <h5 id="参数"><a href="#参数" class="header-anchor">#</a> 参数</h5> <table><thead><tr><th style="text-align:center;">参数</th> <th style="text-align:center;">类型</th> <th style="text-align:center;">说明</th></tr></thead> <tbody><tr><td style="text-align:center;">*path</td> <td style="text-align:center;">const char</td> <td style="text-align:center;">文件路径</td></tr> <tr><td style="text-align:center;">*mode</td> <td style="text-align:center;">r/rb</td> <td style="text-align:center;">打开只读文件，该文件必须存在</td></tr> <tr><td style="text-align:center;">*mode</td> <td style="text-align:center;">r+或r+b</td> <td style="text-align:center;">打开只读写文件，该文件必须存在</td></tr> <tr><td style="text-align:center;">*mode</td> <td style="text-align:center;">w/wb</td> <td style="text-align:center;">打开只写文件，该文件存在则文件长度为0，即会擦除文件以前内容，若文件不存在则建立该文件</td></tr> <tr><td style="text-align:center;">*mode</td> <td style="text-align:center;">w+/w+b/wb+</td> <td style="text-align:center;">打开可读写文件，若文件存在则文件长度为0，即会擦除文件以前内容，若文件不存在则建立该文件</td></tr> <tr><td style="text-align:center;">*mode</td> <td style="text-align:center;">a/ab</td> <td style="text-align:center;">以附加的方式打开只写文件，若文件不存在，则建立该文件，如果文件存在，写入的数据会被加到文件尾，即文件原先的内容会被保留</td></tr> <tr><td style="text-align:center;">*mode</td> <td style="text-align:center;">a+/a+b/ab+</td> <td style="text-align:center;">以附加的方式打开读写文件，若文件不存在，则建立该文件，如果文件存在，写入的数据会被加到文件尾，即文件原先的内容会被保留</td></tr></tbody></table> <ul><li>b:二进制文件</li> <li>r:只读方式打开文件，文件必须存在</li> <li>w/a:只写方式打开文件，文件不存在则创建（a追加、w删除）</li> <li>r+:读写方式打开文件，文件必须存在</li> <li>+:读写方式打开文件，文件必须存在</li></ul> <h4 id="读写函数"><a href="#读写函数" class="header-anchor">#</a> 读写函数</h4> <h5 id="分类"><a href="#分类" class="header-anchor">#</a> 分类</h5> <ol><li>行缓存，遇到换行符 \n或写满缓存时 即调用系统调用函数
<ol><li>读，fgets、gets、printf、fprintf、sprintf</li> <li>写，fputs、puts、scanf</li> <li>按字符的读，fgetc、getc、getchar</li> <li>按字符的写，fputc、putc、putchar</li></ol></li> <li>无缓存，只要用户调用了该函数，就会将其中的内容写入到内核中</li> <li>全缓存，只有写满缓存再调用系统调用函数
<ol><li>读，fread</li> <li>写，fwrite</li></ol></li></ol> <h5 id="fgets和fputs-行缓存"><a href="#fgets和fputs-行缓存" class="header-anchor">#</a> fgets和fputs(行缓存)</h5> <p>**char *fgets(char <em>s,int size,FILE <em>stream)</em></em></p> <p>**int fputs(const char <em>s,FILE <em>stream)</em></em></p> <table><thead><tr><th>函数</th> <th>参数</th> <th>说明</th> <th>其它</th></tr></thead> <tbody><tr><td>fgets</td> <td>s</td> <td>缓存</td> <td>读到那里去</td></tr> <tr><td>fgets</td> <td>size</td> <td>读取量</td> <td>读多少个字节</td></tr> <tr><td>fgets</td> <td>stream</td> <td>读取位置</td> <td>读取的来源</td></tr> <tr><td>fgets</td> <td>返回值</td> <td>成功则为s缓存的地址或文件尾</td> <td>出错则为null</td></tr> <tr><td></td> <td></td> <td></td> <td></td></tr> <tr><td>fputs</td> <td>s</td> <td>缓存</td> <td>写入什么内容</td></tr> <tr><td>fputs</td> <td>stream</td> <td>写到哪里去</td> <td>目标文件</td></tr> <tr><td>fputs</td> <td>返回值</td> <td>成功则为非负值</td> <td>出错为EOF</td></tr></tbody></table> <h5 id="gets和puts-行缓存"><a href="#gets和puts-行缓存" class="header-anchor">#</a> gets和puts（行缓存）</h5> <p>**char <em>gets(char <em>s);</em></em></p> <p>*<em>int puts(const char <em>s);</em></em></p> <h6 id="gets与fgets的区别"><a href="#gets与fgets的区别" class="header-anchor">#</a> gets与fgets的区别</h6> <ul><li>gets()不能指定缓存的长度，可能造成缓存越界，写到缓存之后的存储空间中，从而产生不可预料的后果。</li> <li>gets()只能从标准输入中读</li> <li>gets()与fgets()的另一个区别是，gets()并不将新行符存入缓存中，fgets将新行符存入缓存中</li></ul> <h6 id="puts与fgets的区别"><a href="#puts与fgets的区别" class="header-anchor">#</a> puts与fgets的区别</h6> <ul><li>puts()只能向标准输出中写</li> <li>puts()与fputs()的另一个区别是puts()输出时会添加一个新行符，fputs不会</li></ul> <h5 id="fprint、printf与sprintf"><a href="#fprint、printf与sprintf" class="header-anchor">#</a> fprint、printf与sprintf</h5> <p>int fprintf(FILE *stream,&quot;字符串格式&quot;)；</p> <ul><li>fprintf 可以输出到文件中，也可以输出到显示器</li> <li>printf 只能输出到显示器中</li></ul> <p>int sprintf(str*,&quot;字符串格式&quot;)；</p> <ul><li>输出内容到一个字符串中</li></ul> <h5 id="fgetc和fputc"><a href="#fgetc和fputc" class="header-anchor">#</a> fgetc和fputc</h5> <p>int fgetc(FILE *fp)</p> <ul><li>将文件中的内容从一个字符的输出到显示器，到文件结尾时返回EOF</li> <li>功能，从文件中读取一个字符</li> <li>返回值，正确为读取的字符，到文件结尾或出错时返回EOF</li></ul> <p>int fputc(int c,FILE *fp)</p> <ul><li>输入一个字符到一个文件中，成功则返回输入的字符，失败返回EOF</li> <li>功能，写一个字符到文件中</li> <li>参数，第一个为要写的字符，第二个为文件流</li> <li>返回值，成功则返回输入的字符，失败则返回EOF</li></ul> <p><strong>fgetc有缓存，但不是行缓存函数</strong></p> <h5 id="fread和fwrite-全缓存"><a href="#fread和fwrite-全缓存" class="header-anchor">#</a> fread和fwrite(全缓存)</h5> <p>size_t fread (void *ptr,size_t  size,size_t nmemb,FILE *stream);</p> <p>size_t fwrite (const void *ptr,size_t  size,size_t nmemb,FILE *stream);</p> <ul><li>功能，全缓存的读写函数</li> <li>ptr，第一个参数，buf，缓存中要写入的内容（读到哪里去）</li> <li>size，第二个参数，写的内容中，每一个单元所占的字节数</li> <li>nmemb，第三个参数，写的内容中，有多少个单元数</li> <li>stream，第四个参数，写到哪里去（从哪里读）</li> <li>size *nmemb，总共写了多少个字节</li> <li>返回值，实际写的单元数</li></ul> <h4 id="刷新fflush-file-fp"><a href="#刷新fflush-file-fp" class="header-anchor">#</a> 刷新fflush(FILE *fp)</h4> <h6 id="功能-2"><a href="#功能-2" class="header-anchor">#</a> 功能</h6> <p>刷新函数，强制将行缓存中的内容写入内核。</p> <p>FILE *fp 类似于文件描述符。</p> <h6 id="注"><a href="#注" class="header-anchor">#</a> 注</h6> <p>flose()函数中包含fflush()函数。</p> <h6 id="无缓存-2"><a href="#无缓存-2" class="header-anchor">#</a> 无缓存</h6> <h4 id="读写位置指针函数"><a href="#读写位置指针函数" class="header-anchor">#</a> 读写位置指针函数</h4> <table><thead><tr><th style="text-align:center;">函数</th> <th style="text-align:center;">功能</th> <th style="text-align:center;">参数</th> <th style="text-align:center;">返回值</th></tr></thead> <tbody><tr><td style="text-align:center;">fseek()</td> <td style="text-align:center;">设定文件位置指示</td> <td style="text-align:center;">参数与lseek()一致</td> <td style="text-align:center;">成功返回0 失败返回-1L</td></tr> <tr><td style="text-align:center;">rewind(FILE *fp)</td> <td style="text-align:center;">用于设定流的文件位置指示为文件开始</td> <td style="text-align:center;">fp类似于文件描述符</td> <td style="text-align:center;">该函数调用成功无返回值</td></tr> <tr><td style="text-align:center;">ftell(FILE *fp)</td> <td style="text-align:center;">用于取得当前文件的位置指针</td> <td style="text-align:center;">fp类似于文件描述符</td> <td style="text-align:center;">成功为当前文件位置，失败-1L</td></tr></tbody></table> <h4 id="读写状态判断函数"><a href="#读写状态判断函数" class="header-anchor">#</a> 读写状态判断函数</h4> <table><thead><tr><th style="text-align:center;">函数</th> <th style="text-align:center;">功能</th> <th style="text-align:center;">参数</th> <th style="text-align:center;">返回值</th></tr></thead> <tbody><tr><td style="text-align:center;">int feof(FILE *stream)</td> <td style="text-align:center;">判断是否到了文件结束</td> <td style="text-align:center;">文件流</td> <td style="text-align:center;">文件结束时，返回为非0，否则为0</td></tr> <tr><td style="text-align:center;">int ferror(FILE *stream)</td> <td style="text-align:center;">判断是否读写错误</td> <td style="text-align:center;">文件流</td> <td style="text-align:center;">读写错误 返回非0，否则返回0</td></tr> <tr><td style="text-align:center;">void clearerr(FILE *stream)</td> <td style="text-align:center;">清除流错误</td> <td style="text-align:center;">文件流</td> <td style="text-align:center;">无</td></tr></tbody></table> <h4 id="cat-函数的实现"><a href="#cat-函数的实现" class="header-anchor">#</a> cat 函数的实现</h4> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">// linux中cat的实现</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;stdio.h&quot;</span></span>
<span class="token comment">// 将文件的内容输出到显示器</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">// 定义文件指针 </span>
	 FILE <span class="token operator">*</span>src_fp<span class="token punctuation">;</span>
	 
	 <span class="token comment">// 获取文件的字符 </span>
	 <span class="token keyword">int</span> read_ret<span class="token punctuation">;</span>
	 
	 <span class="token comment">// 如果参数输入不全 则退出 且提示 </span>
	 <span class="token keyword">if</span><span class="token punctuation">(</span>argc <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span>
	 <span class="token punctuation">{</span>
	 	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;please input src file\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	 <span class="token punctuation">}</span>
	 
	 <span class="token comment">// 打开指定文件 </span>
	 src_fp<span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">&quot;r&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 
	 <span class="token comment">// 如果文件不存在报错 </span>
	 <span class="token keyword">if</span><span class="token punctuation">(</span>src_fp<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span>
	 <span class="token punctuation">{</span>
	 	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;open src file %s failure\n&quot;</span><span class="token punctuation">,</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">;</span>
	 <span class="token punctuation">}</span>
	 
	 <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;open src file %s SUCCESS\n&quot;</span><span class="token punctuation">,</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 
	 <span class="token comment">// 读取文件 </span>
	 <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	 <span class="token punctuation">{</span>
	 	read_ret <span class="token operator">=</span> <span class="token function">fgetc</span><span class="token punctuation">(</span>src_fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	 	<span class="token comment">// 判断文件是否读取结束 </span>
	 	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">feof</span><span class="token punctuation">(</span>src_fp<span class="token punctuation">)</span><span class="token punctuation">)</span>
	 	<span class="token punctuation">{</span>
	 		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;read file %s end\n&quot;</span><span class="token punctuation">,</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 		<span class="token keyword">break</span><span class="token punctuation">;</span>
		 <span class="token punctuation">}</span>
	 	<span class="token function">fputc</span><span class="token punctuation">(</span>read_ret<span class="token punctuation">,</span><span class="token constant">stdout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 <span class="token punctuation">}</span>
	 <span class="token comment">// 关闭文件流 </span>
	 <span class="token function">fclose</span><span class="token punctuation">(</span>src_fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	 <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="函数库的制作"><a href="#函数库的制作" class="header-anchor">#</a> 函数库的制作</h2> <p>Linux下函数库分为静态库和动态库。</p> <p>静态库：在程序生成.c文件编译运行时，就已经将库加载到运行环境中</p> <ul><li>.a 后缀</li> <li>编译时酒将库编译进可执行程序中</li> <li>优点，程序的运行环境不需要外部的函数库</li> <li>缺点，可执行程序大</li></ul> <p>动态库：在程序编运行时，动态的将库加载到运行环境中</p> <ul><li>.so 后缀</li> <li>又称共享库，在运行时将库加载到可执行程序中</li> <li>优点，可执行程序</li> <li>缺点，程序的运行环境必须提供相应的库</li></ul> <p><strong>库函数在 usr\lib——参考</strong></p> <blockquote><p><a href="https://blog.csdn.net/weixin_45157820/article/details/115789297" target="_blank" rel="noopener noreferrer"> Linux_静态库与动态库的制作与使用<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="_01-静态库的制作"><a href="#_01-静态库的制作" class="header-anchor">#</a> 01 静态库的制作</h3> <ol><li>函数文件及main.c文件</li> <li>gcc -o file.o</li> <li>gcc -c -o file.o file.c</li> <li>ar -cr -o lib_file.a  file.o</li> <li>gcc -o main main.c lib_file.a (使用)</li></ol> <h3 id="_02-动态库的制作"><a href="#_02-动态库的制作" class="header-anchor">#</a> 02 动态库的制作</h3> <ol><li>函数文件及main.c文件</li> <li>gcc -o file.o</li> <li>gcc -c -o file.o file.c</li> <li>gcc -shared -fpic -o lib_file.so file.o</li> <li>gcc -o main main.c lib_file.a (使用)</li></ol> <p>动态库默认在usr/lib文件夹下找对应的实现库，要让程序能够执行成功，有以下几个方法可以使用</p> <ol><li>将自己的库放到/usr/lib文件夹中</li> <li>设置环境变量
<ol><li>假设lib_file.so 在/home/linux/file中，则设置环境变量</li> <li>export LD_LIBRARY_PATH=/home/linux/file:$LD_LIBRARY_PATH</li></ol></li> <li>在/etc/ld.so.conf文件里加入生成的库的目录，然后通过/sbin/ldconfig</li></ol> <p>脚本运行ld.so.conf</p> <div class="language-c extra-class"><pre class="language-c"><code>include ld<span class="token punctuation">.</span>so<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>d<span class="token comment">/*.conf
</span></code></pre></div><h2 id="目录io"><a href="#目录io" class="header-anchor">#</a> 目录IO</h2> <blockquote><p><a href="https://blog.csdn.net/qq_41669298/article/details/105331453" target="_blank" rel="noopener noreferrer">【Linux】文件IO详解<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://blog.csdn.net/weixin_43937576/article/details/116596766" target="_blank" rel="noopener noreferrer">Linux高级编程之目录IO<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p>#include &lt;sys/type.h&gt;</p> <p>#include&lt;dirent.h&gt;</p></blockquote> <h3 id="_01-目录io与文件io函数的比较"><a href="#_01-目录io与文件io函数的比较" class="header-anchor">#</a> 01 目录IO与文件IO函数的比较</h3> <table><thead><tr><th style="text-align:center;">目录IO</th> <th style="text-align:center;">功能描述</th> <th style="text-align:center;">文件IO</th> <th style="text-align:center;">功能描述</th></tr></thead> <tbody><tr><td style="text-align:center;">opendir()</td> <td style="text-align:center;">只能打开目录</td> <td style="text-align:center;">open()</td> <td style="text-align:center;">打开文件流</td></tr> <tr><td style="text-align:center;">mkdir()</td> <td style="text-align:center;">创建目录</td> <td style="text-align:center;"></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">readdir()</td> <td style="text-align:center;">读取目录</td> <td style="text-align:center;">read()</td> <td style="text-align:center;">读取文件流</td></tr> <tr><td style="text-align:center;">rewinddir()</td> <td style="text-align:center;">调整位置指针</td> <td style="text-align:center;">rewind()</td> <td style="text-align:center;">调整位置指针</td></tr> <tr><td style="text-align:center;">telldir()</td> <td style="text-align:center;">调整位置指针</td> <td style="text-align:center;">ftell()</td> <td style="text-align:center;">调整位置指针</td></tr> <tr><td style="text-align:center;">seekdir()</td> <td style="text-align:center;">调整位置指针</td> <td style="text-align:center;">fseek()</td> <td style="text-align:center;">调整位置指针</td></tr> <tr><td style="text-align:center;">closedir()</td> <td style="text-align:center;">关闭目录</td> <td style="text-align:center;">close()</td> <td style="text-align:center;">关闭文件流</td></tr></tbody></table> <h3 id="_02-相关函数-2"><a href="#_02-相关函数-2" class="header-anchor">#</a> 02 相关函数</h3> <h4 id="opendir"><a href="#opendir" class="header-anchor">#</a> opendir</h4> <p>DIR *opendir(const char *pathname);</p> <ul><li>参数，打开文件的目录路径</li> <li>返回值，成功返回目录流指针，否则返回NULL</li></ul> <h4 id="mkdir"><a href="#mkdir" class="header-anchor">#</a> mkdir</h4> <p>int mkdir(const char *path,mode_t mode);</p> <ul><li>path为想要创建的目录文件路径</li> <li>mode为该目录的访问权限</li> <li>返回值，如果目录创建成功则返回0，失败则返回-1</li> <li>访问权限是与umask为补集</li></ul> <h5 id="mkdir-命令的实现"><a href="#mkdir-命令的实现" class="header-anchor">#</a> mkdir 命令的实现</h5> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;stdio.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;sys/types.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;dirent.h&quot;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> ret<span class="token punctuation">;</span>
	ret <span class="token operator">=</span> <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token string">&quot;./mydir&quot;</span><span class="token punctuation">,</span><span class="token number">0777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>ret<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;creat mydir failure\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;creat mydir success\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="readdir"><a href="#readdir" class="header-anchor">#</a> readdir</h4> <p>struct dirent *readdir(DIR *dr)</p> <ul><li>目录流指针</li> <li>返回值，成功时返回struct dirent 指针，失败则返回NULL</li> <li>struct dirent定义在头文件dirent.h中</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">dirent</span>
<span class="token punctuation">{</span>
	<span class="token class-name">ino_t</span> d_ino<span class="token operator">:</span> <span class="token comment">//inode号--内核进行管理的唯一的标识</span>
	<span class="token keyword">char</span> d_name<span class="token punctuation">[</span>NAME_MAX<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//文件名</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>目录中的子目录和子文件通过一个链表存放。因此要读取所有的文件，需要遍历整个链表。</strong></p> <h4 id="closedir"><a href="#closedir" class="header-anchor">#</a> closedir</h4> <p>int closedir(DIR *dir);</p> <ul><li>参数，目录流指针</li> <li>返回值，成功0，失败-1</li></ul> <h2 id="单机模式下文件的上传和下载实现"><a href="#单机模式下文件的上传和下载实现" class="header-anchor">#</a> 单机模式下文件的上传和下载实现</h2> <h3 id="_01-实现内容"><a href="#_01-实现内容" class="header-anchor">#</a> 01 实现内容</h3> <ol><li>输入的条件
<ol><li>服务器的地址</li> <li>路径和目录名</li></ol></li> <li>列出服务器中存在的文件：opendir readdir</li> <li>输入从服务器下载的文件名  或  上传文件到服务器的文件名</li> <li>文件下载 或 文件上传</li> <li>使用到的函数
<ol><li>文件io open read write close</li> <li>标准io fopen fputs fgets fputs fgets fread fwrite fclose</li></ol></li></ol> <h3 id="_02-代码实现"><a href="#_02-代码实现" class="header-anchor">#</a> 02 代码实现</h3> <div class="language-c extra-class"><pre class="language-c"><code><span class="token comment">// 共享目录文件的上传下载 </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;stdio.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;sys/types.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;dirent.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;string.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;unistd.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;fcntl.h&quot;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token comment">// 文件夹目录指针 </span>
	DIR  <span class="token operator">*</span>dp<span class="token punctuation">;</span>
	<span class="token comment">// 下载或上传的文件描述符 </span>
	<span class="token keyword">int</span> src_fd<span class="token punctuation">;</span>
	<span class="token keyword">int</span> des_fd<span class="token punctuation">;</span>
	<span class="token keyword">int</span> ret<span class="token punctuation">;</span>
	<span class="token keyword">char</span> buff<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> fd<span class="token punctuation">;</span>
	<span class="token comment">// 文件夹结构体 </span>
	<span class="token keyword">struct</span> <span class="token class-name">dirent</span> <span class="token operator">*</span>dir<span class="token punctuation">;</span>
	<span class="token comment">// 输入的服务名 </span>
	<span class="token keyword">char</span> server<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token comment">// 输入的文件名 </span>
	<span class="token keyword">char</span> file<span class="token punctuation">[</span><span class="token number">128</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
start<span class="token operator">:</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;please servre IP and file url\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 将结果存入对应的变量中</span>
	<span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">&quot;%s&quot;</span><span class="token punctuation">,</span>server<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 打开文件夹 并展示文件列表</span>
	dp <span class="token operator">=</span> <span class="token function">opendir</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span><span class="token punctuation">;</span> 
	
	<span class="token keyword">if</span><span class="token punctuation">(</span>dp <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;open file failure\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">goto</span> start<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;open this dir%s\n&quot;</span><span class="token punctuation">,</span>server<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 循环读取目录中的内容</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		dir<span class="token operator">=</span><span class="token function">readdir</span><span class="token punctuation">(</span>dp<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>dir<span class="token operator">==</span><span class="token constant">NULL</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span>
		<span class="token punctuation">{</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;inode=%ld\t file_name=%s\n&quot;</span><span class="token punctuation">,</span>dir<span class="token operator">-&gt;</span>d_ino<span class="token punctuation">,</span>dir<span class="token operator">-&gt;</span>d_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	 <span class="token punctuation">}</span>
	 
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n please input this dir \n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">&quot;%s&quot;</span><span class="token punctuation">,</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	src_fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token function">strcat</span><span class="token punctuation">(</span><span class="token function">strcat</span><span class="token punctuation">(</span>server<span class="token punctuation">,</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>file<span class="token punctuation">)</span><span class="token punctuation">,</span>O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span>src_fd<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;open file failure\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> 
	<span class="token punctuation">}</span>
	
	des_fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span>O_WRONLY<span class="token punctuation">,</span><span class="token number">0777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span>des_fd<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;target server create failure\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">;</span> 
	<span class="token punctuation">}</span>
	
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		ret <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>src_fd<span class="token punctuation">,</span>buff<span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>ret<span class="token operator">&lt;</span><span class="token number">128</span><span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token function">write</span><span class="token punctuation">(</span>des_fd<span class="token punctuation">,</span>buff<span class="token punctuation">,</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
	 <span class="token punctuation">}</span> 
	<span class="token function">write</span><span class="token punctuation">(</span>des_fd<span class="token punctuation">,</span>buff<span class="token punctuation">,</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">close</span><span class="token punctuation">(</span>src_fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">close</span><span class="token punctuation">(</span>des_fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">closedir</span><span class="token punctuation">(</span>dp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/collection/linuxjg.html" class="prev">
        Linux内核架构
      </a></span> <span class="next"><a href="/collection/jcjtx.html">
        进程间通信
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e2ddde8e.js" defer></script><script src="/assets/js/2.e74445cb.js" defer></script><script src="/assets/js/46.3ddc24a7.js" defer></script>
  </body>
</html>
