<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Makefile | suting-Blogs</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="分布式博客云笔记">
    
    <link rel="preload" href="/assets/css/0.styles.386f4818.css" as="style"><link rel="preload" href="/assets/js/app.e2ddde8e.js" as="script"><link rel="preload" href="/assets/js/2.e74445cb.js" as="script"><link rel="preload" href="/assets/js/29.5e42d4f2.js" as="script"><link rel="prefetch" href="/assets/js/10.383382f2.js"><link rel="prefetch" href="/assets/js/11.79913c72.js"><link rel="prefetch" href="/assets/js/12.18e85316.js"><link rel="prefetch" href="/assets/js/13.78e33ed3.js"><link rel="prefetch" href="/assets/js/14.92269bd7.js"><link rel="prefetch" href="/assets/js/15.acc92b96.js"><link rel="prefetch" href="/assets/js/16.d8716382.js"><link rel="prefetch" href="/assets/js/17.fa6a1da4.js"><link rel="prefetch" href="/assets/js/18.c5024350.js"><link rel="prefetch" href="/assets/js/19.c3e206a7.js"><link rel="prefetch" href="/assets/js/20.6a00e35f.js"><link rel="prefetch" href="/assets/js/21.37c42ff6.js"><link rel="prefetch" href="/assets/js/22.abd1537f.js"><link rel="prefetch" href="/assets/js/23.6a041ee1.js"><link rel="prefetch" href="/assets/js/24.ab067683.js"><link rel="prefetch" href="/assets/js/25.a2de42cd.js"><link rel="prefetch" href="/assets/js/26.efa7caf3.js"><link rel="prefetch" href="/assets/js/27.1520ec85.js"><link rel="prefetch" href="/assets/js/28.be40ede1.js"><link rel="prefetch" href="/assets/js/3.fbcd2674.js"><link rel="prefetch" href="/assets/js/30.eae39a3c.js"><link rel="prefetch" href="/assets/js/31.63618f89.js"><link rel="prefetch" href="/assets/js/32.43b53339.js"><link rel="prefetch" href="/assets/js/33.931d2183.js"><link rel="prefetch" href="/assets/js/34.e7f37503.js"><link rel="prefetch" href="/assets/js/35.6302af3d.js"><link rel="prefetch" href="/assets/js/36.7aec4478.js"><link rel="prefetch" href="/assets/js/37.58461b9d.js"><link rel="prefetch" href="/assets/js/38.811a26e0.js"><link rel="prefetch" href="/assets/js/39.c3d07ac9.js"><link rel="prefetch" href="/assets/js/4.23df146b.js"><link rel="prefetch" href="/assets/js/40.b2c32317.js"><link rel="prefetch" href="/assets/js/41.368ac455.js"><link rel="prefetch" href="/assets/js/42.d68c9491.js"><link rel="prefetch" href="/assets/js/43.74a44b32.js"><link rel="prefetch" href="/assets/js/44.633f2e2b.js"><link rel="prefetch" href="/assets/js/45.eab6bf9b.js"><link rel="prefetch" href="/assets/js/46.3ddc24a7.js"><link rel="prefetch" href="/assets/js/5.4c581b45.js"><link rel="prefetch" href="/assets/js/6.27888615.js"><link rel="prefetch" href="/assets/js/7.e23a1d77.js"><link rel="prefetch" href="/assets/js/8.928501ca.js"><link rel="prefetch" href="/assets/js/9.0b4be001.js">
    <link rel="stylesheet" href="/assets/css/0.styles.386f4818.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">suting-Blogs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  home
</a></div><div class="nav-item"><a href="https://javaguide.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaGuide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://home.code-nav.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  code-nav
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/sutinghu153" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://mp.weixin.qq.com/mp/profile_ext?action=home&amp;__biz=MzA5ODI3NTI1OA==&amp;scene=124#wechat_redirect" target="_blank" rel="noopener noreferrer" class="nav-link external">
  WK听潮
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/itdevbooks/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  book
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  湘ICP备2021013988号-1
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  home
</a></div><div class="nav-item"><a href="https://javaguide.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaGuide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://home.code-nav.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  code-nav
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/sutinghu153" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://mp.weixin.qq.com/mp/profile_ext?action=home&amp;__biz=MzA5ODI3NTI1OA==&amp;scene=124#wechat_redirect" target="_blank" rel="noopener noreferrer" class="nav-link external">
  WK听潮
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/itdevbooks/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  book
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  湘ICP备2021013988号-1
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>个人项目</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>C/C++/Java/Golang</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux内核</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux系统开发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Linux/Makefile/Shell</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/collection/linux.html" class="sidebar-link">Linux</a></li><li><a href="/collection/makefile.html" aria-current="page" class="active sidebar-link">Makefile</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/collection/makefile.html#程序执行的一般过程" class="sidebar-link">程序执行的一般过程</a></li><li class="sidebar-sub-header"><a href="/collection/makefile.html#about-makefile" class="sidebar-link">about Makefile</a></li><li class="sidebar-sub-header"><a href="/collection/makefile.html#makefile的规则" class="sidebar-link">Makefile的规则</a></li><li class="sidebar-sub-header"><a href="/collection/makefile.html#makefile的工作机制" class="sidebar-link">Makefile的工作机制</a></li><li class="sidebar-sub-header"><a href="/collection/makefile.html#makefile中的变量" class="sidebar-link">Makefile中的变量</a></li><li class="sidebar-sub-header"><a href="/collection/makefile.html#引用其它的makefile文件" class="sidebar-link">引用其它的Makefile文件</a></li><li class="sidebar-sub-header"><a href="/collection/makefile.html#环境变量-makefiles" class="sidebar-link">环境变量 MAKEFILES</a></li><li class="sidebar-sub-header"><a href="/collection/makefile.html#makefile中的运算符" class="sidebar-link">Makefile中的运算符</a></li><li class="sidebar-sub-header"><a href="/collection/makefile.html#makefile中的文件搜索" class="sidebar-link">Makefile中的文件搜索</a></li></ul></li><li><a href="/collection/shell.html" class="sidebar-link">Shell</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>区块链</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机视觉</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中间件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>常用命令</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>系统部署</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="makefile"><a href="#makefile" class="header-anchor">#</a> Makefile</h1> <h2 id="程序执行的一般过程"><a href="#程序执行的一般过程" class="header-anchor">#</a> 程序执行的一般过程</h2> <p><strong>编译</strong>：C 、C++ 源文件编译成中间代码文件——<strong>.c .cpp</strong>文件</p> <p><strong>链接</strong>：将中间文件合成执行文件——<strong>.o</strong>文件</p> <p><strong>打包</strong>：链接器只会查询方法、函数对应的目标文件，并不受源文件的影响。当源文件过多时，编译生成的中间目标文件太多，为了方便管理，需要给中间文件打包——<strong>.a</strong>文件</p> <h2 id="about-makefile"><a href="#about-makefile" class="header-anchor">#</a> about Makefile</h2> <p><strong>make</strong> 命令执行时，需要一个 <strong>Makefile</strong> 文件，以告诉 <strong>make</strong> 命令需要怎么样的去编译和链接程序。Makefile可以解决以下问题：</p> <ul><li>如果这个工程没有编译过，那么我们的所有 C 文件都要编译并被链接。</li> <li>如果这个工程的某几个 C 文件被修改，那么我们只编译被修改的 C 文件，并链接目标程。</li> <li>如果这个工程的头文件被改变了，那么我们需要编译引用了这几个头文件的 C 文件，并链接目标程序。</li></ul> <h2 id="makefile的规则"><a href="#makefile的规则" class="header-anchor">#</a> Makefile的规则</h2> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token symbol">target ...</span> <span class="token punctuation">:</span> prerequisites ...
command
</code></pre></div><ul><li>target，目标文件，可以是objectfile 也可以是执行文件</li> <li>prerequisites，依赖文件，即生成目标文件所需要的所有的文件或目标</li> <li>command，make需要执行的命令，任意的shell命令</li></ul> <p><strong>target</strong> 这一个或多个的目标文件依赖于<strong>prerequisites</strong> 中的文件，其生成规则定义在 <strong>command</strong> 中</p> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token symbol">run</span><span class="token punctuation">:</span> main.o hello.o test.o
    gcc -o run main.o hello.o test.o
<span class="token builtin">.PHONY</span><span class="token punctuation">:</span> clean
<span class="token symbol">clean</span><span class="token punctuation">:</span>
    -rm run *.o  
</code></pre></div><h2 id="makefile的工作机制"><a href="#makefile的工作机制" class="header-anchor">#</a> Makefile的工作机制</h2> <ul><li>make 会在<strong>当前目录下</strong>找名字叫“Makefile”或“makefile”的文件。</li> <li>如果找到，它会找文件中的<strong>第一个目标文件</strong>（target），并把这个文件作为最终的目标文件。</li> <li>如果 目标文件不存在，或是 目标文件 所依赖的后面的 .o 文件的文件修改时间要比 目标文件新，那么，他就会执行后面所定义的命令来生成目标文件。</li> <li>如果 目标文件所依赖的.o 文件也存在，那么 make 会在当前文件中找目标为.o 文件的依赖性，如果找到则再根据那一个规则生成.o 文件。（这有点像一个堆栈的过程）</li> <li>当然，你的 C 文件和 H 文件是存在的啦，于是 make 会生成 .o 文件，然后再用 .o 文件生成执行文件。</li></ul> <blockquote><p>以上过程层层依赖，直到最终编译出第一个目标文件</p> <p>规则的执行代码行要以   Tab   键作为开头</p> <p>整个系统文件的Makefile的工作方式如下</p> <p>1、读入所有的 Makefile。</p> <p>2、读入被 include 的其它 Makefile。</p> <p>3、初始化文件中的变量。</p> <p>4、推导隐晦规则，并分析所有规则。</p> <p>5、为所有的目标文件创建依赖关系链。</p> <p>6、根据依赖关系，决定哪些目标要重新生成。</p> <p>7、执行生成命令。</p></blockquote> <h2 id="makefile中的变量"><a href="#makefile中的变量" class="header-anchor">#</a> Makefile中的变量</h2> <p><code>$(变量名)</code> 采用该方式来表示Makefile文件中的所有字符串变量。</p> <h2 id="引用其它的makefile文件"><a href="#引用其它的makefile文件" class="header-anchor">#</a> 引用其它的Makefile文件</h2> <p><code>include &lt;filename&gt;</code> 用来包含其它Makefile文件</p> <ul><li>优先在当前目录搜索</li> <li>其次如果使用<strong>make -I</strong> 路径 或者 <strong>make --include-dir</strong> 路径，会在参数指定的位置搜索</li> <li>最后默认路径**（/usr/local/bin或者/usr/include）**中搜索</li></ul> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token keyword">include</span> Makefile.hello
<span class="token symbol">run</span><span class="token punctuation">:</span> main.o hello.o test.o
    gcc -o run main.o hello.o test.o
<span class="token builtin">.PHONY</span><span class="token punctuation">:</span> clean
<span class="token symbol">clean</span><span class="token punctuation">:</span>
    -rm run *.o  
</code></pre></div><p>如果打算无法找到Makefile.hello文件也要进行执行下去，只需在include前加个减号</p> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token keyword">-include</span> Makefile.hello
</code></pre></div><h2 id="环境变量-makefiles"><a href="#环境变量-makefiles" class="header-anchor">#</a> 环境变量 MAKEFILES</h2> <p>为了方便管理环境变量及当前的目录，即方便<code>include</code>命令的使用，可以使用环境变量。类似于全局变量、宏。</p> <ul><li><p>需要在当前环境中进行定义</p></li> <li><p>所有的Makefile都将受影响</p></li></ul> <h2 id="makefile中的运算符"><a href="#makefile中的运算符" class="header-anchor">#</a> Makefile中的运算符</h2> <p>通配符用来处理一系列类似或相似的文件。</p> <table><thead><tr><th style="text-align:center;">符号</th> <th style="text-align:center;">含义</th> <th style="text-align:center;">例子</th> <th>释义</th></tr></thead> <tbody><tr><td style="text-align:center;">*</td> <td style="text-align:center;">代表类似的文件</td> <td style="text-align:center;">*.c</td> <td>代表以.c结尾的文件</td></tr> <tr><td style="text-align:center;">~</td> <td style="text-align:center;">指向某个用户</td> <td style="text-align:center;">~/test</td> <td>表示当前用户的$HOME 目录下的 test 目录</td></tr> <tr><td style="text-align:center;">~</td> <td style="text-align:center;">指向某个用户</td> <td style="text-align:center;">~sutinghu/test</td> <td>表示sutinghu用户空间下的test目录</td></tr> <tr><td style="text-align:center;">$()</td> <td style="text-align:center;">占位符</td> <td style="text-align:center;">name = $(sutinghu)</td> <td>实际使用过程中，将i替换为sutinghu</td></tr> <tr><td style="text-align:center;">:=</td> <td style="text-align:center;">限定赋值符</td> <td style="text-align:center;">name := $(sutinghu)</td> <td>实际过程中，name所取变量为sutinghu，无论后面是否有其它赋值操作</td></tr> <tr><td style="text-align:center;">=</td> <td style="text-align:center;">赋值符</td> <td style="text-align:center;">name = sutinghu</td> <td>将name的值赋值为sutinghu</td></tr> <tr><td style="text-align:center;">?=</td> <td style="text-align:center;">判断赋值符</td> <td style="text-align:center;">name?=sutinghu</td> <td>如果name前面没有被赋值，那么该变量就是sutinghu，如果前面已经被赋值过，就使用前面的值</td></tr> <tr><td style="text-align:center;">+=</td> <td style="text-align:center;">变量追加</td> <td style="text-align:center;">objects = main.o inpiut.o，objects += calcu.o</td> <td>一开始变量 objects 的值为“main.o input.o”，后面我们给他追加了一个“calcu.o”，因此变量 objects 变成了“main.o input.o calcu.o”</td></tr></tbody></table> <div class="language-makefile extra-class"><pre class="language-makefile"><code>objects <span class="token operator">=</span> <span class="token variable">$</span><span class="token punctuation">(</span>main.o hello.o test.o<span class="token punctuation">)</span>
<span class="token symbol">run</span><span class="token punctuation">:</span> 
    gcc -o run main.o hello.o test.o
<span class="token builtin">.PHONY</span><span class="token punctuation">:</span> clean
<span class="token symbol">clean</span><span class="token punctuation">:</span>
    -rm run *.o  
</code></pre></div><h2 id="makefile中的文件搜索"><a href="#makefile中的文件搜索" class="header-anchor">#</a> Makefile中的文件搜索</h2> <ul><li>VPATH
<ul><li>如果没有指明这个变量，make 只会在当前的目录中去找寻依赖文件和目标文件。</li> <li>如果定义了这个变量，那么，make就会在当当前目录找不到的情况下，到所指定的目录中去找寻文件了</li></ul></li></ul> <div class="language-makefile extra-class"><pre class="language-makefile"><code>VPATH <span class="token operator">=</span> src<span class="token punctuation">:</span>../headers <span class="token comment">#make 会按照这个顺序进行搜索</span>
</code></pre></div><ul><li>vpath
<ul><li>vpath   <em><strong>pattern   directories</strong></em> 为符合模式 <em><strong>pattern</strong></em> 的文件指定搜索目录 <em><strong>directories</strong></em> 。</li> <li>vpath <em><strong>pattern</strong></em>
清除符合模式 <em><strong>pattern</strong></em> 的文件的搜索目录。</li> <li>vpath
清除所有已被设置好了的文件搜索目录。</li></ul></li></ul> <ol><li>vapth 使用方法中的 <em><strong>pattern</strong></em> 需要包含 <em><strong>“%”</strong></em> 字符。</li> <li><em><strong>“%”</strong></em> 的意思是匹配零或若干字符，例如， <em><strong>“%.h”</strong></em> 表示所有以 <em><strong>“.h”</strong></em> 结尾的文件。</li> <li><em><strong>pattern</strong></em> 指定了要搜索的文件集.</li> <li><em><strong>directories</strong></em> 则指定了 <em><strong>pattern</strong></em> 的文件集的搜索的目录。</li></ol> <div class="language-makefile extra-class"><pre class="language-makefile"><code><span class="token comment">#  make 在“../headers”目录下搜索所有以“.h”结尾的文件。</span>
<span class="token keyword">vpath</span> %.h ../headers
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/collection/linux.html" class="prev">
        Linux
      </a></span> <span class="next"><a href="/collection/shell.html">
        Shell
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e2ddde8e.js" defer></script><script src="/assets/js/2.e74445cb.js" defer></script><script src="/assets/js/29.5e42d4f2.js" defer></script>
  </body>
</html>
