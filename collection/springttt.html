<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>suting-Blogs</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="分布式博客云笔记">
    
    <link rel="preload" href="/assets/css/0.styles.386f4818.css" as="style"><link rel="preload" href="/assets/js/app.e2ddde8e.js" as="script"><link rel="preload" href="/assets/js/2.e74445cb.js" as="script"><link rel="preload" href="/assets/js/41.368ac455.js" as="script"><link rel="prefetch" href="/assets/js/10.383382f2.js"><link rel="prefetch" href="/assets/js/11.79913c72.js"><link rel="prefetch" href="/assets/js/12.18e85316.js"><link rel="prefetch" href="/assets/js/13.78e33ed3.js"><link rel="prefetch" href="/assets/js/14.92269bd7.js"><link rel="prefetch" href="/assets/js/15.acc92b96.js"><link rel="prefetch" href="/assets/js/16.d8716382.js"><link rel="prefetch" href="/assets/js/17.fa6a1da4.js"><link rel="prefetch" href="/assets/js/18.c5024350.js"><link rel="prefetch" href="/assets/js/19.c3e206a7.js"><link rel="prefetch" href="/assets/js/20.6a00e35f.js"><link rel="prefetch" href="/assets/js/21.37c42ff6.js"><link rel="prefetch" href="/assets/js/22.abd1537f.js"><link rel="prefetch" href="/assets/js/23.6a041ee1.js"><link rel="prefetch" href="/assets/js/24.ab067683.js"><link rel="prefetch" href="/assets/js/25.a2de42cd.js"><link rel="prefetch" href="/assets/js/26.efa7caf3.js"><link rel="prefetch" href="/assets/js/27.1520ec85.js"><link rel="prefetch" href="/assets/js/28.be40ede1.js"><link rel="prefetch" href="/assets/js/29.5e42d4f2.js"><link rel="prefetch" href="/assets/js/3.fbcd2674.js"><link rel="prefetch" href="/assets/js/30.eae39a3c.js"><link rel="prefetch" href="/assets/js/31.63618f89.js"><link rel="prefetch" href="/assets/js/32.43b53339.js"><link rel="prefetch" href="/assets/js/33.931d2183.js"><link rel="prefetch" href="/assets/js/34.e7f37503.js"><link rel="prefetch" href="/assets/js/35.6302af3d.js"><link rel="prefetch" href="/assets/js/36.7aec4478.js"><link rel="prefetch" href="/assets/js/37.58461b9d.js"><link rel="prefetch" href="/assets/js/38.811a26e0.js"><link rel="prefetch" href="/assets/js/39.c3d07ac9.js"><link rel="prefetch" href="/assets/js/4.23df146b.js"><link rel="prefetch" href="/assets/js/40.b2c32317.js"><link rel="prefetch" href="/assets/js/42.d68c9491.js"><link rel="prefetch" href="/assets/js/43.74a44b32.js"><link rel="prefetch" href="/assets/js/44.633f2e2b.js"><link rel="prefetch" href="/assets/js/45.eab6bf9b.js"><link rel="prefetch" href="/assets/js/46.3ddc24a7.js"><link rel="prefetch" href="/assets/js/5.4c581b45.js"><link rel="prefetch" href="/assets/js/6.27888615.js"><link rel="prefetch" href="/assets/js/7.e23a1d77.js"><link rel="prefetch" href="/assets/js/8.928501ca.js"><link rel="prefetch" href="/assets/js/9.0b4be001.js">
    <link rel="stylesheet" href="/assets/css/0.styles.386f4818.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">suting-Blogs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  home
</a></div><div class="nav-item"><a href="https://javaguide.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaGuide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://home.code-nav.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  code-nav
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/sutinghu153" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://mp.weixin.qq.com/mp/profile_ext?action=home&amp;__biz=MzA5ODI3NTI1OA==&amp;scene=124#wechat_redirect" target="_blank" rel="noopener noreferrer" class="nav-link external">
  WK听潮
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/itdevbooks/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  book
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  湘ICP备2021013988号-1
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  home
</a></div><div class="nav-item"><a href="https://javaguide.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaGuide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://home.code-nav.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  code-nav
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/sutinghu153" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://mp.weixin.qq.com/mp/profile_ext?action=home&amp;__biz=MzA5ODI3NTI1OA==&amp;scene=124#wechat_redirect" target="_blank" rel="noopener noreferrer" class="nav-link external">
  WK听潮
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/itdevbooks/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  book
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  湘ICP备2021013988号-1
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>个人项目</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>C/C++/Java/Golang</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/collection/languagec.html" class="sidebar-link">C</a></li><li><a href="/collection/qt.html" class="sidebar-link">Qt</a></li><li><a href="/collection/languagejava.html" class="sidebar-link">JAVA</a></li><li><a href="/collection/springttt.html" aria-current="page" class="active sidebar-link">spring微服务问题</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/collection/go.html" class="sidebar-link">Golang</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux内核</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux系统开发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux/Makefile/Shell</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>区块链</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机视觉</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中间件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>常用命令</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>系统部署</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 align="center">Java一站式问题Q&amp;A</h1> <p>本文总结了在Java一站式springboot微服务中遇到的一系列问题，章节分析了问题出现的原因及解决方案。</p> <h5 align="center">2021-11-19 <h1 id="目录"><a href="#目录" class="header-anchor">#</a> 目录</h1> <p>[TOC]</p> <h1 id="q-a"><a href="#q-a" class="header-anchor">#</a> Q&amp;A</h1> <h3 id="_001-controller-接口url重名"><a href="#_001-controller-接口url重名" class="header-anchor">#</a> 001  Controller 接口Url重名</h3> <h4 id="question"><a href="#question" class="header-anchor">#</a> Question</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Caused</span> by<span class="token operator">:</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span></span>UnsatisfiedDependencyException</span><span class="token operator">:</span> <span class="token class-name">Error</span> creating bean <span class="token keyword">with</span> <span class="token namespace">name</span> <span class="token string">'webMvcRequestHandlerProvider'</span> defined in URL <span class="token punctuation">[</span>jar<span class="token operator">:</span>file<span class="token operator">:</span><span class="token operator">/</span><span class="token class-name">D</span><span class="token operator">:</span><span class="token operator">/</span>shijuMVN<span class="token operator">/</span>io<span class="token operator">/</span>springfox<span class="token operator">/</span>springfox<span class="token operator">-</span>spring<span class="token operator">-</span>webmvc<span class="token operator">/</span><span class="token number">3.0</span><span class="token number">.0</span><span class="token operator">/</span>springfox<span class="token operator">-</span>spring<span class="token operator">-</span>webmvc<span class="token operator">-</span><span class="token number">3.0</span><span class="token number">.0</span><span class="token punctuation">.</span>jar<span class="token operator">!</span><span class="token operator">/</span>springfox<span class="token operator">/</span>documentation<span class="token operator">/</span>spring<span class="token operator">/</span>web<span class="token operator">/</span>plugins<span class="token operator">/</span><span class="token class-name">WebMvcRequestHandlerProvider</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token class-name">Unsatisfied</span> dependency expressed through constructor parameter <span class="token number">2</span><span class="token punctuation">;</span> nested exception is <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span></span>BeanCreationException</span><span class="token operator">:</span> <span class="token class-name">Error</span> creating bean <span class="token keyword">with</span> <span class="token namespace">name</span> <span class="token string">'requestMappingHandlerMapping'</span> defined in <span class="token keyword">class</span> path resource <span class="token punctuation">[</span>org<span class="token operator">/</span>springframework<span class="token operator">/</span>boot<span class="token operator">/</span>autoconfigure<span class="token operator">/</span>web<span class="token operator">/</span>servlet<span class="token operator">/</span><span class="token class-name">WebMvcAutoConfiguration</span>$<span class="token class-name">EnableWebMvcConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token class-name">Invocation</span> of init method failed<span class="token punctuation">;</span> nested exception is <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>IllegalStateException</span><span class="token operator">:</span> <span class="token class-name">Ambiguous</span> <span class="token class-name"><span class="token namespace">mapping<span class="token punctuation">.</span></span> Cannot</span> map <span class="token string">'keyProLanduserController'</span> method 
</code></pre></div><h4 id="answer"><a href="#answer" class="header-anchor">#</a> Answer</h4> <p><strong>分析：</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">Error</span> creating bean <span class="token keyword">with</span> <span class="token namespace">name</span> <span class="token string">'webMvcRequestHandlerProvider'</span> defined in URL
</code></pre></div><p><strong>webMvcRequestHandlerProvider</strong> 是spring boot中统一接口管理的类，<strong>同一个接口中的Url不能重复</strong>，如果接口有相同的Url，则初始化时会报该问题。</p> <p><strong>方案：</strong></p> <ol><li>检查接口中是否存在Url相同的方法</li> <li>如果存在，检查方法的参数和请求方法是否一样</li></ol> <p><strong><u>以上出现任意一个情况，都需要对接口进行差异化处理。</u></strong></p> <h3 id="_002-seata-服务发现"><a href="#_002-seata-服务发现" class="header-anchor">#</a> 002  Seata 服务发现</h3> <h4 id="question-2"><a href="#question-2" class="header-anchor">#</a> Question</h4> <div class="language-java extra-class"><pre class="language-java"><code>no available service found in cluster <span class="token string">'default'</span><span class="token punctuation">,</span> please make sure registry config correct and keep your seata server running
</code></pre></div><h4 id="answer-2"><a href="#answer-2" class="header-anchor">#</a> Answer</h4> <p><strong>分析：</strong></p> <p>registry.conf 配置文件中，指定了seata管理的服务的地址</p> <div class="language-java extra-class"><pre class="language-java"><code>registry <span class="token punctuation">{</span>
  # file 、nacos 、eureka、redis、zk、consul、etcd3、sofa
  type <span class="token operator">=</span> <span class="token string">&quot;nacos&quot;</span>

  nacos <span class="token punctuation">{</span>
    application <span class="token operator">=</span> <span class="token string">&quot;serverAddr&quot;</span>
    serverAddr <span class="token operator">=</span> <span class="token string">&quot;XXXXXXX&quot;</span>
    group <span class="token operator">=</span> <span class="token string">&quot;SEATA_GROUP&quot;</span>
    namespace <span class="token operator">=</span> <span class="token string">&quot;XXXXXX&quot;</span>
    cluster <span class="token operator">=</span> <span class="token string">&quot;default&quot;</span>
    username <span class="token operator">=</span> <span class="token string">&quot;XXXXX&quot;</span>
    password <span class="token operator">=</span> <span class="token string">&quot;XXXX&quot;</span>
  <span class="token punctuation">}</span>
  eureka <span class="token punctuation">{</span>
    serviceUrl <span class="token operator">=</span> <span class="token string">&quot;http://localhost:8761/eureka&quot;</span>
    application <span class="token operator">=</span> <span class="token string">&quot;default&quot;</span>
    weight <span class="token operator">=</span> <span class="token string">&quot;1&quot;</span>
  <span class="token punctuation">}</span>
  redis <span class="token punctuation">{</span>
    serverAddr <span class="token operator">=</span> <span class="token string">&quot;localhost:6379&quot;</span>
    db <span class="token operator">=</span> <span class="token number">0</span>
    password <span class="token operator">=</span> <span class="token string">&quot;&quot;</span>
    cluster <span class="token operator">=</span> <span class="token string">&quot;default&quot;</span><span class="token comment">// 为默认的服务集群</span>
    timeout <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>

</code></pre></div><p>如文件中所示，default，为默认的服务集群。</p> <p>**方案：**检查 registry.conf 文件中 的cluster属性的配置是否为default，注意的是该配置必须与其他服务的nacos一致，如下所示。</p> <div class="language-java extra-class"><pre class="language-java"><code>seata<span class="token operator">:</span>
  enabled<span class="token operator">:</span> <span class="token boolean">true</span>
  application<span class="token operator">-</span>id<span class="token operator">:</span> XXXX
  use<span class="token operator">-</span>jdk<span class="token operator">-</span>proxy<span class="token operator">:</span> <span class="token boolean">false</span>
  enable<span class="token operator">-</span>auto<span class="token operator">-</span>data<span class="token operator">-</span>source<span class="token operator">-</span>proxy<span class="token operator">:</span> <span class="token boolean">false</span>
  tx<span class="token operator">-</span>service<span class="token operator">-</span>group<span class="token operator">:</span> <span class="token string">&quot;fsp_tx_group&quot;</span>
  registry<span class="token operator">:</span>
    type<span class="token operator">:</span> nacos
    nacos<span class="token operator">:</span>
      application<span class="token operator">:</span> seata
      server<span class="token operator">-</span>addr<span class="token operator">:</span> XXXX
      group<span class="token operator">:</span> <span class="token string">&quot;DEFAULT_GROUP&quot;</span>
      namespace<span class="token operator">:</span><span class="token string">&quot;STRING&quot;</span>
  service<span class="token operator">:</span>
    vgroup<span class="token operator">-</span>mapping<span class="token operator">:</span>
      fsp_tx_group<span class="token operator">:</span> <span class="token keyword">default</span> <span class="token comment">// 尤其要注意这个问题</span>
</code></pre></div><p>重点看这个服务组</p> <div class="language-java extra-class"><pre class="language-java"><code>service<span class="token operator">:</span>
    vgroup<span class="token operator">-</span>mapping<span class="token operator">:</span>
      fsp_tx_group<span class="token operator">:</span> <span class="token keyword">default</span>
</code></pre></div><h3 id="_003-openfeign-负载均衡"><a href="#_003-openfeign-负载均衡" class="header-anchor">#</a> 003  OpenFeign 负载均衡</h3> <h4 id="question-3"><a href="#question-3" class="header-anchor">#</a> Question</h4> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>netflix<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span>ClientException</span><span class="token operator">:</span> <span class="token class-name">Load</span> balancer does not have available server <span class="token keyword">for</span> client<span class="token operator">:</span> XXXX
</code></pre></div><h4 id="answer-3"><a href="#answer-3" class="header-anchor">#</a> Answer</h4> <p><strong>分析：</strong></p> <ul><li><p>springCloud 微服务体系，通过OpenFeign进行服务间通信。</p></li> <li><p>每个feign-client 有自己的名字和空间。如下所示</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>
	contextId <span class="token operator">=</span> <span class="token string">&quot;xxxx&quot;</span><span class="token punctuation">,</span>
	name <span class="token operator">=</span> <span class="token string">&quot;${osmp.comm.feign-client.name:xxxx}&quot;</span><span class="token punctuation">,</span>
	url <span class="token operator">=</span> <span class="token string">&quot;${osmp.comm.feign-client.url:}&quot;</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>进行服务间通信时，需要确定调用对象是哪个服务，因此需要在服务中心进行配置。</p></li></ul> <p><strong>方案：</strong></p> <p>检查nacos，并进行配置。</p> <div class="language-java extra-class"><pre class="language-java"><code>xxxx<span class="token operator">:</span>
    feign<span class="token operator">-</span>client<span class="token operator">:</span>
      name<span class="token operator">:</span> xxxx
      url<span class="token operator">:</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>服务注册地址nacos地址<span class="token operator">/</span>xxxx
</code></pre></div><h3 id="_004-nacos-服务注册"><a href="#_004-nacos-服务注册" class="header-anchor">#</a> 004 nacos 服务注册</h3> <h4 id="question-4"><a href="#question-4" class="header-anchor">#</a> Question</h4> <div class="language- extra-class"><pre class="language-text"><code>如何注册一个服务，供其他服务通过 openfeign 调用
</code></pre></div><h4 id="answer-4"><a href="#answer-4" class="header-anchor">#</a> Answer</h4> <p><strong>分析：</strong></p> <p>需要结合springboot框架进行配置。</p> <p><strong>方案：</strong></p> <p>SpringCloud 通过nacos 注册服务，做服务发现和调度中心。其基本流程大概为：</p> <ol><li><p>nacos 访问地址及统一端口号作为系统的入口，并由spring自带的鉴权模块统一管理入口权限</p> <div class="language- extra-class"><pre class="language-text"><code>spring:
  security:
    oauth2:
      resourceserver:
        jwt:
          jwk-set-uri: http://nacos访问地址:端口号/public/服务地址/oauth/jwks.json
</code></pre></div></li> <li><p>nacos 添加服务配置，并将鉴权管理添加（如上）</p></li> <li><p>配置中添加有效端口地址</p> <div class="language- extra-class"><pre class="language-text"><code>server:
  port: 有效端口地址
</code></pre></div></li> <li><p>为了seata调度中心能够统一，管理，nacos中需要添加seata的配置</p> <div class="language- extra-class"><pre class="language-text"><code>seata:
  enabled: true
  application-id: 服务名
  use-jdk-proxy: false
  enable-auto-data-source-proxy: false
  tx-service-group: fsp_tx_group
  registry:
    type: nacos
    nacos:
      application: seata
      server-addr: nacos地址
      group: &quot;DEFAULT_GROUP&quot;
      namespace: 系统nacos命名空间
  service:
    vgroup-mapping:
      fsp_tx_group: default
</code></pre></div></li></ol> <h3 id="_005-pg-客户过多"><a href="#_005-pg-客户过多" class="header-anchor">#</a> 005 pg 客户过多</h3> <h4 id="question-5"><a href="#question-5" class="header-anchor">#</a> Question</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>postgresql<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>PSQLException</span><span class="token operator">:</span> 致命错误<span class="token operator">:</span> 对不起<span class="token punctuation">,</span> 已经有太多的客户
</code></pre></div><h4 id="answer-5"><a href="#answer-5" class="header-anchor">#</a> Answer</h4> <p><strong>分析：</strong></p> <p>由数据库连接数太多导致的问题。</p> <p><strong>方案：</strong></p> <ul><li>首先通过查询，查看连接数</li></ul> <div class="language- extra-class"><pre class="language-text"><code>select * from pg_stat_activity WHERE state = 'active' 
</code></pre></div><p>结果集会显示出当前连接的数据库名，用户，IP地址，连接开始时间，查询的语句，状态等。
这时我们可以根据 state 列进行区分。</p> <ul><li><p>两种处理办法</p> <ul><li>如果大部分的连接state列的值为active，则需要考虑增加数据库的最大连接数，修改方法为：</li></ul> <div class="language- extra-class"><pre class="language-text"><code>找到postgresql安装配置文件 postgresql.conf ，直接修改配置值
max_connections = 2500 # (change requires restart)
其中2500为修改的具体值，根据自己的需要指定，修改后需要重启数据库服务。
</code></pre></div><ul><li><p>如果大部分的连连接state值为idle，并且我们不想重启的话</p> <p>可以用pg_stat_get_backend_activity(integer) 函数kill掉处于空闲状态的连接，完整sql如下：</p></li></ul> <div class="language- extra-class"><pre class="language-text"><code>SELECT pg_terminate_backend(pid) from pg_stat_activity where state = 'idle'
</code></pre></div></li></ul> <h3 id="_006-has-not-been-refreshed-yet"><a href="#_006-has-not-been-refreshed-yet" class="header-anchor">#</a> 006 has not been refreshed yet</h3> <h4 id="question-6"><a href="#question-6" class="header-anchor">#</a> Question</h4> <div class="language-java extra-class"><pre class="language-java"><code>fileListener execute error<span class="token punctuation">,</span> dataId <span class="token operator">:</span>service<span class="token punctuation">.</span>vgroupMapping<span class="token punctuation">.</span>fsp_tx_group
    
<span class="token class-name">Caused</span> by<span class="token operator">:</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>IllegalStateException</span><span class="token operator">:</span> <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span>AnnotationConfigServletWebServerApplicationContext</span><span class="token annotation punctuation">@73e132e0</span> has not been refreshed yet
</code></pre></div><h4 id="answer-6"><a href="#answer-6" class="header-anchor">#</a> Answer</h4> <p><strong>分析</strong>：</p> <blockquote><p>在Spring容器初始化时发生异常，此时 Spring还没有执行 destroy（该方法中会执行 close()-&gt;doClose()） 方法时尝试去获取Bean时会出现这个问题。</p> <p>因为在Spring容器初始化时发生异常 Spring会在catch块中捕捉异常然后调用 cancelRefresh方法，这个方法中会将 AbstractApplicationContext.active 设为 false，Spring在尝试进行获取 Bean 时会进入AbstractApplicationContext.assertBeanFactoryActive 方法，这个方法会校验 active 的值，如果为false 则会校验AbstractApplicationContext.closed 的值，如果 close 也为 true 的话就抛出has been closed already 异常，否则抛出 has not been refreshed yet 的异常。</p> <p>close 在执行 AbstractApplicationContext.doClose 方法中会被设为 true 。</p></blockquote> <p><strong>服务中抛出异常的源码为</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
	 * Assert that this context's BeanFactory is currently active,
	 * throwing an {@link IllegalStateException} if it isn't.
	 * &lt;p&gt;Invoked by all {@link BeanFactory} delegation methods that depend
	 * on an active context, i.e. in particular all bean accessor methods.
	 * &lt;p&gt;The default implementation checks the {@link #isActive() 'active'} status
	 * of this context overall. May be overridden for more specific checks, or for a
	 * no-op if {@link #getBeanFactory()} itself throws an exception in such a case.
	 */</span>
	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">assertBeanFactoryActive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>active<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>closed<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token function">getDisplayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; has been closed already&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token function">getDisplayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; has not been refreshed yet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>断言此上下文的BeanFactory当前处于活动状态，如果未处于活动状态，则抛出{@link IllegalStateException} 由依赖于活动上下文的所有{@linkBeanFactory}委托方法调用，尤其是所有bean访问器方法。默认实现检查此上下文的{@link#isActive（）'active'}状态。如果{@link#getBeanFactory（）}本身在这种情况下引发异常，则可能会覆盖更具体的检查，或覆盖no-op。
</code></pre></div><p>大概意思是bean工厂有问题，工厂没有启动或初始化。seata主要用来进行分布式事务管理，数据全局保持一致性。</p> <p><strong>方案</strong>：</p> <p>对于以上问题，产生的原因可能有</p> <ol><li>springboot 上下文声明有问题</li> <li>seata服务有问题</li> <li>数据库连接数据源有问题</li> <li>mapper文件读取数据有问题</li></ol> <h3 id="_007-seata集群问题"><a href="#_007-seata集群问题" class="header-anchor">#</a> 007  seata集群问题</h3> <h4 id="question-7"><a href="#question-7" class="header-anchor">#</a> Question</h4> <div class="language-java extra-class"><pre class="language-java"><code>can not get cluster name in registry config <span class="token string">'service.vgroupMapping.jiance-seata-service-group'</span><span class="token punctuation">,</span> please make sure registry config correct
    
无法在注册表配置“service<span class="token punctuation">.</span>vgroupMapping<span class="token punctuation">.</span>jiance seata service group”中获取群集名称，请确保注册表配置正确
</code></pre></div><h4 id="answer-7"><a href="#answer-7" class="header-anchor">#</a> Answer</h4> <p><strong>分析</strong>：</p> <p>这是因为nacos中没有设置集群服务管理</p> <p><strong>方案</strong>：进行下面的配置就完事了</p> <div class="language-java extra-class"><pre class="language-java"><code>seata<span class="token operator">:</span>
  enabled<span class="token operator">:</span> <span class="token boolean">true</span>
  application<span class="token operator">-</span>id<span class="token operator">:</span> jiance
  use<span class="token operator">-</span>jdk<span class="token operator">-</span>proxy<span class="token operator">:</span> <span class="token boolean">false</span>
  enable<span class="token operator">-</span>auto<span class="token operator">-</span>data<span class="token operator">-</span>source<span class="token operator">-</span>proxy<span class="token operator">:</span> <span class="token boolean">false</span>
  tx<span class="token operator">-</span>service<span class="token operator">-</span>group<span class="token operator">:</span> DEFAULT_GROUP
  registry<span class="token operator">:</span>
    type<span class="token operator">:</span> nacos
    nacos<span class="token operator">:</span>
      application<span class="token operator">:</span> seata
      server<span class="token operator">-</span>addr<span class="token operator">:</span> <span class="token number">10.14</span><span class="token number">.2</span><span class="token number">.31</span><span class="token operator">:</span><span class="token number">8848</span>
      group<span class="token operator">:</span> <span class="token string">&quot;DEFAULT_GROUP&quot;</span>
      namespace<span class="token operator">:</span> <span class="token number">19d</span>c9793<span class="token operator">-</span>a32b<span class="token operator">-</span><span class="token number">4</span>a2c<span class="token operator">-</span>af18<span class="token operator">-</span><span class="token number">95</span>c54e8aa811
  service<span class="token operator">:</span>
    vgroup<span class="token operator">-</span>mapping<span class="token operator">:</span>
      DEFAULT_GROUP<span class="token operator">:</span> seata
    enable<span class="token operator">-</span>degrade<span class="token operator">:</span> <span class="token boolean">false</span>
    disable<span class="token operator">-</span>global<span class="token operator">-</span>transaction<span class="token operator">:</span> <span class="token boolean">false</span>
</code></pre></div><h3 id="_008-服务集成天山"><a href="#_008-服务集成天山" class="header-anchor">#</a> 008 服务集成天山</h3> <h4 id="question-8"><a href="#question-8" class="header-anchor">#</a> Question</h4> <div class="language- extra-class"><pre class="language-text"><code>新增的服务模块如何集成天山
</code></pre></div><h4 id="answer-8"><a href="#answer-8" class="header-anchor">#</a> Answer</h4> <ul><li>新增配置接口</li></ul> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Inherited</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">EnableOsmpJianceConfiguration</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><ul><li>天山启动类中新增以上配置</li></ul> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EnableOsmpHomeConfiguration</span>
<span class="token annotation punctuation">@EnableOsmpMeetingConfiguration</span>
<span class="token annotation punctuation">@EnableProcessConfiguration</span>
<span class="token annotation punctuation">@EnableOsmpSuperviseConfiguration</span>
<span class="token annotation punctuation">@EnableOsmpOpConfiguration</span>
<span class="token annotation punctuation">@EnableOpBusinessConfiguration</span>
<span class="token annotation punctuation">@EnableOsmpJianceConfiguration</span>
<span class="token annotation punctuation">@EnableMisFlowAutoConfiguration</span>
<span class="token annotation punctuation">@EnableOsmpArchiveConfiguration</span>
<span class="token annotation punctuation">@EnableTzConfiguration</span>
<span class="token annotation punctuation">@EnableTzEnforcementConfigration</span>
<span class="token annotation punctuation">@EnableVenusCoreConfiguration</span>
<span class="token annotation punctuation">@EnableVenusCoreModuleUrlPrefix</span>

<span class="token annotation punctuation">@EnableAsync</span>
<span class="token annotation punctuation">@EnableCaching</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>exclude <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">DruidDataSourceAutoConfigure</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TianShanWebApplication</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">TianShanWebApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>	
</code></pre></div><ul><li>pom文件新增模块依赖</li></ul> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
			<span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>com<span class="token punctuation">.</span>hnup<span class="token punctuation">.</span>osmp<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
			<span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>jiance<span class="token operator">-</span>starter<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>

		<span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
			<span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>com<span class="token punctuation">.</span>hnup<span class="token punctuation">.</span>osmp<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
			<span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>jiance<span class="token operator">-</span>model<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
</code></pre></div><ul><li>修改nacos中的gateway文件</li></ul> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token operator">-</span> id<span class="token operator">:</span> jiance<span class="token operator">-</span>app
          uri<span class="token operator">:</span> lb<span class="token operator">:</span><span class="token operator">/</span>tianshan<span class="token operator">/</span>jiance
          predicates<span class="token operator">:</span>
            <span class="token operator">-</span> <span class="token class-name">Path</span><span class="token operator">=</span><span class="token operator">/</span>api<span class="token operator">/</span>jiance<span class="token comment">/**
          filters:
            - StripPrefix=1
</span></code></pre></div><h3 id="_009-本地项目pom文件引入jar-无maven仓库"><a href="#_009-本地项目pom文件引入jar-无maven仓库" class="header-anchor">#</a> 009 本地项目POM文件引入Jar（无maven仓库）</h3> <h4 id="question-9"><a href="#question-9" class="header-anchor">#</a> Question</h4> <div class="language- extra-class"><pre class="language-text"><code>如何不用maven仓库将jar包引入项目中
</code></pre></div><h4 id="answer-9"><a href="#answer-9" class="header-anchor">#</a> Answer</h4> <div class="language-java extra-class"><pre class="language-java"><code>mvn install<span class="token operator">:</span>install<span class="token operator">-</span>file <span class="token operator">-</span><span class="token class-name">DgroupId</span><span class="token operator">=</span>com<span class="token punctuation">.</span>hnup<span class="token punctuation">.</span>osmp <span class="token operator">-</span><span class="token class-name">DartifactId</span><span class="token operator">=</span>doc<span class="token operator">-</span>model <span class="token operator">-</span><span class="token class-name">Dversion</span><span class="token operator">=</span><span class="token number">4.0</span><span class="token number">.0</span><span class="token operator">-</span><span class="token number">20211115</span><span class="token operator">-</span>SNAPSHOT <span class="token operator">-</span><span class="token class-name">Dpackaging</span><span class="token operator">=</span>jar <span class="token operator">-</span><span class="token class-name">Dfile</span><span class="token operator">=</span><span class="token class-name">C</span><span class="token operator">:</span>\<span class="token class-name">Users</span>\MSI\<span class="token class-name">Desktop</span>\doc<span class="token operator">-</span>model<span class="token punctuation">.</span>jar 

</code></pre></div><h3 id="_010-数据库批量大小写设置"><a href="#_010-数据库批量大小写设置" class="header-anchor">#</a> 010 数据库批量大小写设置</h3> <h4 id="question-10"><a href="#question-10" class="header-anchor">#</a> Question</h4> <div class="language- extra-class"><pre class="language-text"><code>如果想把数据库中的表名及字段都改为大写，如何办
</code></pre></div><h4 id="answer-10"><a href="#answer-10" class="header-anchor">#</a> Answer</h4> <div class="language-mysql extra-class"><pre class="language-text"><code>begin
for c in (select COLUMN_NAME cn from all_tab_columns where table_name='JC_MANAGEMENT_CONTRO') loop
begin
execute immediate 'alter table JC_MANAGEMENT_CONTRO rename column &quot;'||c.cn||'&quot; to '||c.cn;
exception
when others then
dbms_output.put_line('JC_MANAGEMENT_CONTRO'||'.'||c.cn||'已经存在');
end;
end loop;
end;
	
</code></pre></div><h3 id="_011-数据库循环遍历sql语句"><a href="#_011-数据库循环遍历sql语句" class="header-anchor">#</a> 011 数据库循环遍历SQL语句</h3> <h4 id="question-11"><a href="#question-11" class="header-anchor">#</a> Question</h4> <blockquote><p>需要循环遍历 给一些表新增同样的字段，因此需要使用数据库遍历SQL语句</p></blockquote> <h4 id="answer-11"><a href="#answer-11" class="header-anchor">#</a> Answer</h4> <p>对于简单的新增可以用for循环 ，如下</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token number">1.</span>创建一个序列，是为了主键自增。

<span class="token keyword">create</span> sequence t_hvm_seq<span class="token punctuation">;</span>

<span class="token number">2.</span>以下是我在 HVM_ZSB_TJ这张表中添加数据

<span class="token keyword">insert</span> <span class="token keyword">into</span> hvm_zsb_tj t <span class="token punctuation">(</span>t<span class="token punctuation">.</span>id<span class="token punctuation">,</span>t<span class="token punctuation">.</span>stsres<span class="token punctuation">,</span>t<span class="token punctuation">.</span>bdzdydj<span class="token punctuation">,</span>t<span class="token punctuation">.</span>byq<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span>t_hvm_seq<span class="token punctuation">.</span>nextval<span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">3.</span>循环执行<span class="token keyword">sql</span>，以下是循环执行<span class="token number">100</span>遍

<span class="token keyword">declare</span>   
  i <span class="token keyword">integer</span><span class="token punctuation">;</span>  
<span class="token keyword">begin</span>  
  i:<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>  
  <span class="token keyword">for</span> i <span class="token operator">in</span> <span class="token number">1.</span><span class="token number">.100</span> <span class="token keyword">loop</span>  
<span class="token keyword">insert</span> <span class="token keyword">into</span> hvm_zsb_tj t <span class="token punctuation">(</span>t<span class="token punctuation">.</span>id<span class="token punctuation">,</span>t<span class="token punctuation">.</span>stsres<span class="token punctuation">,</span>t<span class="token punctuation">.</span>bdzdydj<span class="token punctuation">,</span>t<span class="token punctuation">.</span>byq<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span>t_hvm_seq<span class="token punctuation">.</span>nextval<span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">end</span> <span class="token keyword">loop</span><span class="token punctuation">;</span>     
<span class="token keyword">end</span><span class="token punctuation">;</span>  

</code></pre></div><p>对于复杂情况下的，可以使用SQL</p> <div class="language-sql extra-class"><pre class="language-sql"><code>
<span class="token keyword">DECLARE</span>
  V_SQL        VARCHAR2<span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">---定义一个变量接收SQL</span>
  V_TABLE_NAME VARCHAR2<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">----定义一个变量接收表名</span>
  <span class="token keyword">CURSOR</span> C1 <span class="token operator">IS</span><span class="token comment">----定义一个游标 接收查询结果方便遍历</span>
      <span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> CONCAT<span class="token punctuation">(</span><span class="token string">'form_data_'</span><span class="token punctuation">,</span> FORM_ID<span class="token punctuation">)</span> <span class="token keyword">as</span> TABLE_NAME  <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> FORM_ID <span class="token keyword">FROM</span> TZ <span class="token keyword">WHERE</span> FORM_ID <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
  <span class="token keyword">OPEN</span> C1<span class="token punctuation">;</span><span class="token comment">----打开游标</span>
  <span class="token keyword">LOOP</span>
    <span class="token comment">--提取一行数据到c1</span>
    <span class="token keyword">FETCH</span> C1
      <span class="token keyword">INTO</span> V_TABLE_NAME<span class="token punctuation">;</span>
    <span class="token comment">--判读是否提取到值，没取到值就退出</span>
    <span class="token comment">--取到值c_job%notfound 是false </span>
    <span class="token comment">--取不到值c_job%notfound 是true</span>
    <span class="token keyword">EXIT</span> <span class="token keyword">WHEN</span> C1<span class="token operator">%</span>NOTFOUND<span class="token punctuation">;</span>
    V_SQL :<span class="token operator">=</span> <span class="token string">'alter table '</span> <span class="token operator">||</span> V_TABLE_NAME <span class="token operator">||</span> <span class="token string">' add DATA_SOURCE NUMBER(4,0)'</span><span class="token punctuation">;</span><span class="token comment">----拼接SQL</span>
    <span class="token keyword">EXECUTE</span> IMMEDIATE V_SQL<span class="token punctuation">;</span><span class="token comment">---执行SQL</span>
  <span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span> <span class="token comment">--关闭游标</span>
  <span class="token keyword">CLOSE</span> C1<span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
</code></pre></div><p>如果要判断数据库是否存在某个表或表中是否存在某个字段</p> <div class="language-sql extra-class"><pre class="language-sql"><code>
<span class="token keyword">DECLARE</span>
  V_SQL        VARCHAR2<span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">---定义一个变量接收SQL</span>
  V_TABLE_NAME VARCHAR2<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">----定义一个变量接收表名</span>
	COUNT_N NUMBER<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">----定义一个变量判断字段是否存在</span>
  <span class="token keyword">CURSOR</span> C1 <span class="token operator">IS</span><span class="token comment">----定义一个游标 接收查询结果方便遍历</span>
      <span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> CONCAT<span class="token punctuation">(</span><span class="token string">'FORM_DATA_'</span><span class="token punctuation">,</span> FORM_ID<span class="token punctuation">)</span> <span class="token keyword">as</span> TABLE_NAME  <span class="token keyword">FROM</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> FORM_ID <span class="token keyword">FROM</span> TZ <span class="token keyword">WHERE</span> FORM_ID <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
  <span class="token keyword">OPEN</span> C1<span class="token punctuation">;</span><span class="token comment">----打开游标</span>
  <span class="token keyword">LOOP</span>
    <span class="token comment">--提取一行数据到c1</span>
    <span class="token keyword">FETCH</span> C1
      <span class="token keyword">INTO</span> 	V_TABLE_NAME<span class="token punctuation">;</span>
			
    <span class="token comment">--判读是否提取到值，没取到值就退出</span>
    <span class="token comment">--取到值c_job%notfound 是false </span>
    <span class="token comment">--取不到值c_job%notfound 是true</span>
    <span class="token keyword">EXIT</span> <span class="token keyword">WHEN</span> C1<span class="token operator">%</span>NOTFOUND<span class="token punctuation">;</span>
		dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span><span class="token string">'开始更新表'</span> <span class="token operator">||</span> V_TABLE_NAME<span class="token punctuation">)</span><span class="token punctuation">;</span>
		 
		 
	  <span class="token comment">-----判断数据库中是否存在某个表</span>
	  <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">INTO</span> COUNT_N <span class="token keyword">from</span> user_objects <span class="token keyword">where</span>  object_name <span class="token operator">=</span> V_TABLE_NAME<span class="token punctuation">;</span>
	  <span class="token keyword">IF</span> <span class="token punctuation">(</span>COUNT_N <span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">THEN</span>
					<span class="token comment">---判断表中是否存在字段</span>
				<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">INTO</span> COUNT_N <span class="token keyword">FROM</span> USER_TAB_COLUMNS <span class="token keyword">WHERE</span> UPPER<span class="token punctuation">(</span>TABLE_NAME<span class="token punctuation">)</span><span class="token operator">=</span> V_TABLE_NAME <span class="token operator">AND</span> COLUMN_NAME <span class="token operator">=</span> <span class="token string">'DATA_SOURCE'</span><span class="token punctuation">;</span>
				dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>COUNT_N<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">IF</span> <span class="token punctuation">(</span>COUNT_N <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token keyword">THEN</span>
				dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>V_TABLE_NAME <span class="token operator">||</span> <span class="token string">'不存在 DATA_SOURCE 字段 开始新增'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					V_SQL :<span class="token operator">=</span> <span class="token string">'alter table '</span> <span class="token operator">||</span> V_TABLE_NAME <span class="token operator">||</span> <span class="token string">' add DATA_SOURCE NUMBER(4,0)'</span><span class="token punctuation">;</span><span class="token comment">----拼接SQL</span>
					<span class="token keyword">EXECUTE</span> IMMEDIATE V_SQL<span class="token punctuation">;</span><span class="token comment">---执行SQL</span>
				<span class="token keyword">ELSE</span>
				dbms_output<span class="token punctuation">.</span>put_line<span class="token punctuation">(</span>V_TABLE_NAME <span class="token operator">||</span> <span class="token string">'已存在 DATA_SOURCE 字段 '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
		<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
  <span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span> <span class="token comment">--关闭游标</span>
  <span class="token keyword">CLOSE</span> C1<span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_012-数据库设置自增序列"><a href="#_012-数据库设置自增序列" class="header-anchor">#</a> 012 数据库设置自增序列</h3> <h4 id="question-12"><a href="#question-12" class="header-anchor">#</a> Question</h4> <blockquote><p>有时候我们需要在数据库插入数据，这个时候，需要我们自增序列</p></blockquote> <h4 id="answer-12"><a href="#answer-12" class="header-anchor">#</a> Answer</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> sequence TEST_SEQ  <span class="token comment">---序列名（TEST_SEQ 为序列名，自定义命名）­</span>
increment <span class="token keyword">by</span> <span class="token number">1</span>  <span class="token comment">---/每次增加1­</span>
<span class="token keyword">start</span> <span class="token keyword">with</span> <span class="token number">1</span> <span class="token comment">----从1开始­</span>
minvalue <span class="token number">1</span>  <span class="token comment">-----/最小值1­</span>
nomaxvalue  <span class="token comment">---//没有最大值 或者­ maxvalue 99999999999999999</span>
nocache  <span class="token comment">---//没有缓存序列­ 或者 cache 20 缓存20个</span>


<span class="token keyword">select</span> TEST_SEQ<span class="token punctuation">.</span>currval <span class="token keyword">from</span> dual<span class="token punctuation">;</span>   <span class="token comment">---//查询当前的序列值</span>
<span class="token keyword">select</span> TEST_SEQ<span class="token punctuation">.</span>nextval <span class="token keyword">from</span> dual<span class="token punctuation">;</span>  <span class="token comment">---//查询下一个序列值</span>
</code></pre></div></h5></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/collection/languagejava.html" class="prev">
        JAVA
      </a></span> <span class="next"><a href="/collection/go.html">
        Golang
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e2ddde8e.js" defer></script><script src="/assets/js/2.e74445cb.js" defer></script><script src="/assets/js/41.368ac455.js" defer></script>
  </body>
</html>
