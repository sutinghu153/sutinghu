<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>suting-Blogs</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="分布式博客云笔记">
    
    <link rel="preload" href="/assets/css/0.styles.386f4818.css" as="style"><link rel="preload" href="/assets/js/app.e2ddde8e.js" as="script"><link rel="preload" href="/assets/js/2.e74445cb.js" as="script"><link rel="preload" href="/assets/js/44.633f2e2b.js" as="script"><link rel="prefetch" href="/assets/js/10.383382f2.js"><link rel="prefetch" href="/assets/js/11.79913c72.js"><link rel="prefetch" href="/assets/js/12.18e85316.js"><link rel="prefetch" href="/assets/js/13.78e33ed3.js"><link rel="prefetch" href="/assets/js/14.92269bd7.js"><link rel="prefetch" href="/assets/js/15.acc92b96.js"><link rel="prefetch" href="/assets/js/16.d8716382.js"><link rel="prefetch" href="/assets/js/17.fa6a1da4.js"><link rel="prefetch" href="/assets/js/18.c5024350.js"><link rel="prefetch" href="/assets/js/19.c3e206a7.js"><link rel="prefetch" href="/assets/js/20.6a00e35f.js"><link rel="prefetch" href="/assets/js/21.37c42ff6.js"><link rel="prefetch" href="/assets/js/22.abd1537f.js"><link rel="prefetch" href="/assets/js/23.6a041ee1.js"><link rel="prefetch" href="/assets/js/24.ab067683.js"><link rel="prefetch" href="/assets/js/25.a2de42cd.js"><link rel="prefetch" href="/assets/js/26.efa7caf3.js"><link rel="prefetch" href="/assets/js/27.1520ec85.js"><link rel="prefetch" href="/assets/js/28.be40ede1.js"><link rel="prefetch" href="/assets/js/29.5e42d4f2.js"><link rel="prefetch" href="/assets/js/3.fbcd2674.js"><link rel="prefetch" href="/assets/js/30.eae39a3c.js"><link rel="prefetch" href="/assets/js/31.63618f89.js"><link rel="prefetch" href="/assets/js/32.43b53339.js"><link rel="prefetch" href="/assets/js/33.931d2183.js"><link rel="prefetch" href="/assets/js/34.e7f37503.js"><link rel="prefetch" href="/assets/js/35.6302af3d.js"><link rel="prefetch" href="/assets/js/36.7aec4478.js"><link rel="prefetch" href="/assets/js/37.58461b9d.js"><link rel="prefetch" href="/assets/js/38.811a26e0.js"><link rel="prefetch" href="/assets/js/39.c3d07ac9.js"><link rel="prefetch" href="/assets/js/4.23df146b.js"><link rel="prefetch" href="/assets/js/40.b2c32317.js"><link rel="prefetch" href="/assets/js/41.368ac455.js"><link rel="prefetch" href="/assets/js/42.d68c9491.js"><link rel="prefetch" href="/assets/js/43.74a44b32.js"><link rel="prefetch" href="/assets/js/45.eab6bf9b.js"><link rel="prefetch" href="/assets/js/46.3ddc24a7.js"><link rel="prefetch" href="/assets/js/5.4c581b45.js"><link rel="prefetch" href="/assets/js/6.27888615.js"><link rel="prefetch" href="/assets/js/7.e23a1d77.js"><link rel="prefetch" href="/assets/js/8.928501ca.js"><link rel="prefetch" href="/assets/js/9.0b4be001.js">
    <link rel="stylesheet" href="/assets/css/0.styles.386f4818.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">suting-Blogs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  home
</a></div><div class="nav-item"><a href="https://javaguide.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaGuide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://home.code-nav.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  code-nav
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/sutinghu153" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://mp.weixin.qq.com/mp/profile_ext?action=home&amp;__biz=MzA5ODI3NTI1OA==&amp;scene=124#wechat_redirect" target="_blank" rel="noopener noreferrer" class="nav-link external">
  WK听潮
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/itdevbooks/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  book
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  湘ICP备2021013988号-1
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  home
</a></div><div class="nav-item"><a href="https://javaguide.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaGuide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://home.code-nav.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  code-nav
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/sutinghu153" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://mp.weixin.qq.com/mp/profile_ext?action=home&amp;__biz=MzA5ODI3NTI1OA==&amp;scene=124#wechat_redirect" target="_blank" rel="noopener noreferrer" class="nav-link external">
  WK听潮
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/itdevbooks/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  book
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  湘ICP备2021013988号-1
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>个人项目</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/collection/xm.html" aria-current="page" class="active sidebar-link">项目介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/collection/xm.html#微信公众号app阅读模式" class="sidebar-link">微信公众号App阅读模式</a></li><li class="sidebar-sub-header"><a href="/collection/xm.html#分布式博客云笔记" class="sidebar-link">分布式博客云笔记</a></li><li class="sidebar-sub-header"><a href="/collection/xm.html#开发一款maven插件" class="sidebar-link">开发一款Maven插件</a></li><li class="sidebar-sub-header"><a href="/collection/xm.html#模板填充组件" class="sidebar-link">模板填充组件</a></li><li class="sidebar-sub-header"><a href="/collection/xm.html#简易ftp服务设计与实现" class="sidebar-link">简易FTP服务设计与实现</a></li><li class="sidebar-sub-header"><a href="/collection/xm.html#shell监控脚本" class="sidebar-link">Shell监控脚本</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>C/C++/Java/Golang</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux内核</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux系统开发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux/Makefile/Shell</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>区块链</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机视觉</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中间件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>常用命令</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>系统部署</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 align="center">个人项目介绍</h1> <font face="华文行楷" size="5">本专题为个人项目介绍，目的是能够对项目快速浏览，有初步印象，如果对其感兴趣，可以进一步阅览。</font> <p>[TOC]</p> <h2 id="微信公众号app阅读模式"><a href="#微信公众号app阅读模式" class="header-anchor">#</a> 微信公众号App阅读模式</h2> <p><font face="华文宋体" size="3">假如公众号的阅读体验可以选择为图书App，你会喜欢吗？</font></p> <h3 align="center">思而不得、戛然而止</h3> <font face="华文宋体" size="3">**当我写作记录的时间越久的时候，越感觉在看公众号时会缺少一些东西——它一直无法让我沉浸和集中精神在内容中，无论是什么样的公众号，都有这种感觉。**</font> <p><font face="华文宋体" size="3"><strong>后来我才慢慢发现，这种感觉就是<code>思而不得、戛然而止</code>。比如当你看到一篇感兴趣的推文时，想了解它的姊妹篇或获取更系统详细的内容时，需要废一番心思去其他的平台，并且经过一系列关键词检索和肉眼筛选后才能继续过瘾。</strong></font></p> <h3 align="center">内容具有关联性</h3> <font face="华文宋体" size="3">**其实，对于公众号创作者来说，内容是具有关联性的，尤其像我一样将公众号作为记录载体的人。**</font> <p><font face="华文宋体" size="3"><strong>而<code>公众号的模式更适合碎片化、热点追踪式、观点输出式等内容的传播</code>。但是，公众号的模式兼容并包，对于如小说连载式的创作者来讲，一样能够作为传播的载体，只是形式上，缺少那种“感觉”。</strong></font></p> <h3 align="center">改进的方向</h3> <font face="华文宋体" size="3">**简单总结，公众号的内容有以下方面可以其他操作辅助改进：**</font> <ul><li><strong>内容的结构性差</strong></li></ul> <p><font face="华文宋体" size="3"><strong>公众号的内容无法一览知其详</strong></font></p> <ul><li><strong>沉浸式体验不高</strong></li></ul> <p><font face="华文宋体" size="3"><strong>一篇的内容不足以过读者的瘾</strong></font></p> <ul><li><strong>关联机制不明显</strong></li></ul> <p><font face="华文宋体" size="3"><strong>同一个系列的文章只能带话题</strong></font></p> <ul><li><strong>内容传播不通用</strong></li></ul> <p><font face="华文宋体" size="3"><strong>不适合小说创作者的内容传播</strong></font></p> <h3 align="center">做出改变</h3> <font face="华文宋体" size="3">**那么，如果公众号的内容能够提供一种App模式，这对于系列连载创作者，会不会更好呢？**</font> <blockquote><p>抱着这个想法为出发点，我为自己的公众号量身定做了一款产品：<strong>ShareApp，以小程序为载体，通过内容流通，以实现模式切换。</strong></p></blockquote> <p><font face="华文宋体" size="3"><strong>小程序设计以简约风打造用于不同个人服务的入口，通过<code>内容分类的选择来实现创作者的内容连载和提高内容相关性</code>。</strong></font></p> <p><font face="华文宋体" size="3"><strong>对于小程序的运维，只需要将每次更新的内容通过后台系统分组分模块插入对应的内容就好啦</strong></font></p> <h3 align="center">我的小程序</h3>
- <font face="华文宋体" size="3">后端：采用微信小程序云数据库，```后端0代码```</font> <ul><li><p><font face="华文宋体" size="3">前端：原生小程序开发</font></p></li> <li><p><font face="华文宋体" size="3">数据库：采用云数据库，关系型存储，读写限制<code>50000次/天</code>，费用<code>6.9RMB/月</code></font></p></li></ul> <blockquote><p>扫码查阅我的小程序</p></blockquote> <img src="/imags/xcx.png" alt="xcx"> <h2 id="分布式博客云笔记"><a href="#分布式博客云笔记" class="header-anchor">#</a> 分布式博客云笔记</h2> <p><font face="华文宋体" size="3">在工作的过程中，会被动、主动的学习很多的东西，而这个过程中产生的零散的知识点，如何记录、如何展示，对我个人产生了很大的影响，为了提高工作和学习的效率，我觉得，我需要一款安全的笔记软件。</font></p> <p><font face="华文宋体" size="3">我对它的最初设想，是这样的：<strong>安全、免费、高效、便携、可读性高</strong></font></p> <p><font face="华文宋体" size="3">我对这个还不存的笔记进行了一些梳理，我想它应该具备这些能力</font></p> <p><strong>在云上</strong></p> <p><font face="华文宋体" size="3">笔记具备<code>云</code>的能力后<strong>能够让我们随时随地，无论PC还是Mobile，都能够读写笔记</strong></font></p> <p><strong>分布式</strong></p> <p><font face="华文宋体" size="3">笔记具备<code>分布式</code>的能力后<strong>无论个人还是多人的协作，都能高效的完成团队的任务</strong></font></p> <p><strong>网站化</strong></p> <p><font face="华文宋体" size="3">笔记具备<code>网站</code>的能力可以<strong>让我们具有清晰、动态的交互式体验，能够实现随时联网访问的目的</strong></font></p> <p><strong>可速记</strong></p> <p><font face="华文宋体" size="3">笔记具备<code>速记</code>能力是<strong>笔记本身核心能力的体现，也是学习和工作效率的基本要求</strong></font></p> <p><font face="华文宋体" size="3">以上，是我对这款<code>笔记本</code>的能力需要，我搜遍了互联网，并没有发现一款集中以上所有优点的笔记软件，所以，我想集众家之所长，才能实现这款笔记。</font></p> <p><font face="华文宋体" size="3"><strong><code>Typroa</code></strong> 是一款高效的MarkDown编辑工具，熟练掌握它的快捷编写方式后对于实现速记的要求，基本没有任何问题，因此，<strong>我选择了它作为笔记的输入端</strong></font></p> <p><font face="华文宋体" size="3"><strong><code>Git</code></strong> 因为其分布式协助而诞生，闻名于其分布式协助和版本控制，因此，<strong>我选择git做为笔记的管理工具</strong></font></p> <p><font face="华文宋体" size="3"><strong><code>VuePress</code></strong> 是Vue 驱动的静态网站生成器，其内核将能够将markdown文件生成html文件，提供用户网站式的体验，因此，<strong>我选择它作为笔记的输出端</strong></font></p> <p><font face="华文宋体" size="3">所以，<strong>将Typroa+Git+VuePress长处集成</strong>，再通过github pages的统一访问，就<strong>诞生了这款<code>分布式博客云笔记</code></strong></font></p> <p><font face="华文宋体" size="3">现在的这款产品，搭建起来比较麻烦，我想，如果有一款产品，能够集众家之长，那应该是一款成功的产品。</font></p> <blockquote><p>最后，欢迎大家访问我的分布式博客云笔记</p> <p>www.滴咯哩个咚.com</p> <div class="language- extra-class"><pre class="language-text"><code>www.dglgd.com
</code></pre></div></blockquote> <h2 id="开发一款maven插件"><a href="#开发一款maven插件" class="header-anchor">#</a> 开发一款Maven插件</h2> <p><font face="华文宋体" size="3">开发了一款Maven插件</font></p> <p><font face="华文宋体" size="3">入职后，公司提出了“提质增效”的口号，一个衡量质量的标准之一是统计每个开发者增、删、改的代码，并统计最终的行数。</font></p> <p><font face="华文宋体" size="3">Git 提供了很多的命令行，用来查看需要的数据，比如</font></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">git</span> log --author<span class="token operator">=</span><span class="token string">&quot;sutinghu&quot;</span> --since<span class="token operator">=</span><span class="token string">'2021-09-20'</span> --until<span class="token operator">=</span><span class="token string">'2021-10-22'</span> --pretty<span class="token operator">=</span>tformat: --numstat <span class="token operator">|</span> <span class="token function">gawk</span> <span class="token string">'{ add += $1 ; subs += $2 ; loc += $1 + $2 } END { printf &quot;增加的行数:%s 删除的行数:%s 总行数: %s\n&quot;,add,subs,loc }'</span>
</code></pre></div><p><font face="华文宋体" size="3">这种查看的方式，对于习惯命令的开发者是友好的，但是也很麻烦</font></p> <p><font face="华文宋体" size="3">如果能够有一个程序，只要设置好统计的时间，点一下就可以得到结果，那不是更好吗</font></p> <p><font face="华文宋体" size="3">秉着作为一名程序员，要有改变生活方式的理念，我决定开发一个Maven插件，只要点点点就可以实现代码的统计。</font></p> <p><font face="华文宋体" size="3">世界上所有的程序都是为了增删改查，程序里所有的逻辑都是为了处理、转移数据。</font></p> <p><font face="华文宋体" size="3">maven 也不例外，只是它的增删改查的逻辑，与一般的业务实现方式有些区别。</font></p> <p><font face="华文宋体" size="3">即“约定优于配置”，maven通过插件体系与XML配置方式将程序封装在了自己的maven体系中，这个封装后的程序被称为maven插件。</font></p> <h3 id="动手实现"><a href="#动手实现" class="header-anchor">#</a> 动手实现</h3> <h4 id="用java和git交互"><a href="#用java和git交互" class="header-anchor">#</a> 用Java和Git交互</h4> <p><font face="华文宋体" size="3">为了获取Git中代码的统计情况，我们需要一个Api来获取maven仓库中代码的提交情况。通过搜索大法，我发现了一个被称为<strong>Jgit</strong>的Api程序包，其核心就是<strong>通过Java程序来实现git的一系统操作</strong>。</font></p> <h4 id="用java实现统计"><a href="#用java实现统计" class="header-anchor">#</a> 用Java实现统计</h4> <p><font face="华文宋体" size="3">前面通过GitBash统计代码的方式看起来很便携，那么代码里要如何统计呢？Git的提交是一个时间轴，也是一个栈。每次的提交都是一个入栈的过程，而时间就是每个栈元素的标签。</font></p> <p><font face="华文宋体" size="3">所以整个过程可以分为下面的几个步骤</font></p> <ol><li>查找所有的提交信息</li> <li>过滤掉时间范围外的提交信息</li> <li>遍历有效的提交信息
<ol><li>查找该提交信息的前一个提交信息</li> <li>对比两次提交信息的差异</li> <li>根据统计需要得出统计数据</li> <li>将所有的结果进行最终的统计</li></ol></li></ol> <h3 id="核心的代码"><a href="#核心的代码" class="header-anchor">#</a> 核心的代码</h3> <h4 id="获取所有的提交信息"><a href="#获取所有的提交信息" class="header-anchor">#</a> 获取所有的提交信息</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getLogs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">GitAPIException</span> <span class="token punctuation">{</span>

        <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RevCommit</span><span class="token punctuation">&gt;</span></span> commits <span class="token operator">=</span> git<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserCommitLog</span><span class="token punctuation">&gt;</span></span> commitLogs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">RevCommit</span> commit <span class="token operator">:</span> commits<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">UserCommitLog</span> userCommitLog  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserCommitLog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            userCommitLog<span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span>commit<span class="token punctuation">.</span><span class="token function">getAuthorIdent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            userCommitLog<span class="token punctuation">.</span><span class="token function">setCommitDate</span><span class="token punctuation">(</span>commit<span class="token punctuation">.</span><span class="token function">getAuthorIdent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getWhen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            userCommitLog<span class="token punctuation">.</span><span class="token function">setRevCommit</span><span class="token punctuation">(</span>commit<span class="token punctuation">)</span><span class="token punctuation">;</span>
            userCommitLog<span class="token punctuation">.</span><span class="token function">setShortMessage</span><span class="token punctuation">(</span>commit<span class="token punctuation">.</span><span class="token function">getShortMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            commitLogs<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>userCommitLog<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>commitLogs  <span class="token operator">=</span> commitLogs<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h4 id="获取仓库"><a href="#获取仓库" class="header-anchor">#</a> 获取仓库</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initGit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            repository <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileRepositoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">setGitDir</span><span class="token punctuation">(</span><span class="token class-name">Paths</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">FileUtils</span><span class="token punctuation">.</span><span class="token function">getDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;.git&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        git <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Git</span><span class="token punctuation">(</span>repository<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            branch <span class="token operator">=</span> git<span class="token punctuation">.</span><span class="token function">getRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBranch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
</code></pre></div><h4 id="获取用户信息"><a href="#获取用户信息" class="header-anchor">#</a> 获取用户信息</h4> <div class="language-java extra-class"><pre class="language-java"><code> <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StoredConfig</span> config <span class="token operator">=</span> git<span class="token punctuation">.</span><span class="token function">getRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> username <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> email <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">,</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> map<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h4 id="获取每次提交的详情"><a href="#获取每次提交的详情" class="header-anchor">#</a> 获取每次提交的详情</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DiffEntry</span><span class="token punctuation">&gt;</span></span> <span class="token function">getChangedFileList</span><span class="token punctuation">(</span><span class="token class-name">RevCommit</span> revCommit<span class="token punctuation">,</span> <span class="token class-name">Repository</span> repo<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DiffEntry</span><span class="token punctuation">&gt;</span></span> returnDiffs <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">RevCommit</span> previsouCommit<span class="token operator">=</span><span class="token function">getPrevHash</span><span class="token punctuation">(</span>revCommit<span class="token punctuation">,</span>repo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>previsouCommit<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token class-name">ObjectId</span> head<span class="token operator">=</span>revCommit<span class="token punctuation">.</span><span class="token function">getTree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">ObjectId</span> oldHead<span class="token operator">=</span>previsouCommit<span class="token punctuation">.</span><span class="token function">getTree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// prepare the two iterators to compute the diff between</span>
            <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">ObjectReader</span> reader <span class="token operator">=</span> repo<span class="token punctuation">.</span><span class="token function">newObjectReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">CanonicalTreeParser</span> oldTreeIter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CanonicalTreeParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                oldTreeIter<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span>reader<span class="token punctuation">,</span> oldHead<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">CanonicalTreeParser</span> newTreeIter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CanonicalTreeParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                newTreeIter<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span>reader<span class="token punctuation">,</span> head<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// finally get the list of changed files</span>
                <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">Git</span> git <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Git</span><span class="token punctuation">(</span>repo<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DiffEntry</span><span class="token punctuation">&gt;</span></span> diffs<span class="token operator">=</span> git<span class="token punctuation">.</span><span class="token function">diff</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">setNewTree</span><span class="token punctuation">(</span>newTreeIter<span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">setOldTree</span><span class="token punctuation">(</span>oldTreeIter<span class="token punctuation">)</span>
                            <span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    returnDiffs<span class="token operator">=</span>diffs<span class="token punctuation">;</span>

                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">GitAPIException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> returnDiffs<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h4 id="获取前一次提交"><a href="#获取前一次提交" class="header-anchor">#</a> 获取前一次提交</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">RevCommit</span> <span class="token function">getPrevHash</span><span class="token punctuation">(</span><span class="token class-name">RevCommit</span> commit<span class="token punctuation">,</span> <span class="token class-name">Repository</span> repo<span class="token punctuation">)</span>  <span class="token keyword">throws</span>  <span class="token class-name">IOException</span> <span class="token punctuation">{</span>

        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">RevWalk</span> walk <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RevWalk</span><span class="token punctuation">(</span>repo<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Starting point</span>
            walk<span class="token punctuation">.</span><span class="token function">markStart</span><span class="token punctuation">(</span>commit<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">RevCommit</span> rev <span class="token operator">:</span> walk<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// got the previous commit.</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> rev<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                count<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            walk<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//Reached end and no previous commits.</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h4 id="对差异做统计"><a href="#对差异做统计" class="header-anchor">#</a> 对差异做统计</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">countDiff</span><span class="token punctuation">(</span><span class="token class-name">RevCommit</span> commit<span class="token punctuation">,</span><span class="token class-name">UserCount</span> userCount<span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token class-name">String</span> versionTag<span class="token operator">=</span> commit<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            <span class="token class-name">RevWalk</span> walk <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RevWalk</span><span class="token punctuation">(</span>repository<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">ObjectId</span> versionId<span class="token operator">=</span>repository<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>versionTag<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">RevCommit</span> verCommit<span class="token operator">=</span>walk<span class="token punctuation">.</span><span class="token function">parseCommit</span><span class="token punctuation">(</span>versionId<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DiffEntry</span><span class="token punctuation">&gt;</span></span> diffFix<span class="token operator">=</span><span class="token function">getChangedFileList</span><span class="token punctuation">(</span>verCommit<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>repository<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">ByteArrayOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">DiffFormatter</span> df <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DiffFormatter</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>

            df<span class="token punctuation">.</span><span class="token function">setRepository</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>repository<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> addSize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> subSize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> allsize <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">DiffEntry</span> entry <span class="token operator">:</span> diffFix<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                df<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token class-name">FileHeader</span> fileHeader <span class="token operator">=</span> df<span class="token punctuation">.</span><span class="token function">toFileHeader</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HunkHeader</span><span class="token punctuation">&gt;</span></span> hunks <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HunkHeader</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> fileHeader<span class="token punctuation">.</span><span class="token function">getHunks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


                <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">HunkHeader</span> hunkHeader<span class="token operator">:</span>hunks<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token class-name">EditList</span> editList <span class="token operator">=</span> hunkHeader<span class="token punctuation">.</span><span class="token function">toEditList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Edit</span> edit <span class="token operator">:</span> editList<span class="token punctuation">)</span><span class="token punctuation">{</span>
                        subSize <span class="token operator">+=</span> edit<span class="token punctuation">.</span><span class="token function">getEndA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>edit<span class="token punctuation">.</span><span class="token function">getBeginA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        addSize <span class="token operator">+=</span> edit<span class="token punctuation">.</span><span class="token function">getEndB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>edit<span class="token punctuation">.</span><span class="token function">getBeginB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        allsize <span class="token operator">+=</span> edit<span class="token punctuation">.</span><span class="token function">getEndA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>edit<span class="token punctuation">.</span><span class="token function">getBeginA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> edit<span class="token punctuation">.</span><span class="token function">getEndB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>edit<span class="token punctuation">.</span><span class="token function">getBeginB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                out<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            userCount<span class="token punctuation">.</span><span class="token function">setAddSize</span><span class="token punctuation">(</span>addSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
            userCount<span class="token punctuation">.</span><span class="token function">setSubSize</span><span class="token punctuation">(</span>subSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
            userCount<span class="token punctuation">.</span><span class="token function">setAllSize</span><span class="token punctuation">(</span>allsize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="使用"><a href="#使用" class="header-anchor">#</a> 使用</h3> <p>最后，如果你想使用这个插件，只需要三个步骤</p> <ul><li>将插件程序包放入自己的仓库</li></ul> <div class="language-html extra-class"><pre class="language-html"><code>https://github.com/sutinghu153/maven-plugin-gitcodes-count
</code></pre></div><blockquote><p>以上是程序包的下载路径，只需要sutinghu.zip即可</p></blockquote> <ul><li>在项目的顶层POM文件中进行配置</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-plugin-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.5.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- 指定maven编译的jdk版本 --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.8.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>verbose</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>verbose</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fork</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fork</span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!--你的jdk地址--&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executable</span><span class="token punctuation">&gt;</span></span>C:/Program Files/Java/jdk1.8.0_20/bin/javac<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executable</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>sutinghu.tools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>countcodes-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>me<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>startTime</span><span class="token punctuation">&gt;</span></span>2020-02-01<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>startTime</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>endTime</span><span class="token punctuation">&gt;</span></span>2021-12-01<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>endTime</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>参数说明</p> <p><code>type</code> 用来选择查看哪些用户的代码统计结果，默认为 me</p> <ul><li>me 仅自己</li> <li>all 所有用户</li></ul> <p><code>startTime</code> 用来设置开始时间</p> <p><code>endTime</code> 用来设置结束时间</p></blockquote> <ul><li>在IDEA中的maven插件管理工具中运行 <code>count codes:count</code></li></ul> <h2 id="模板填充组件"><a href="#模板填充组件" class="header-anchor">#</a> 模板填充组件</h2> <h3 id="关于组件"><a href="#关于组件" class="header-anchor">#</a> 关于组件</h3> <h4 id="_01-业务场景"><a href="#_01-业务场景" class="header-anchor">#</a> 01 业务场景</h4> <p>在资规系统中，使用者对文件及格式规范具有严格要求，比如会议纪要生成的文件，各种事务的文件以及数据分析后的数据报表。</p> <img src="/imags/1647067037426.png" alt="1647067037426"> <h6 align="center">图（1）工作效率完成情况模板</h6> <img src="/imags/1647067066111.png" alt="1647067066111"> <h6 align="center">图（2）表格模板</h6>
#### 02 现行系统的模板开发及管理模式
<p>在之前的系统业务开发中，模板文件的开发和管理表现为以下特点：</p> <ol><li><p>模板管理混乱</p> <p>模板管理混乱表现为，有些模板的管理通过数据库缓存，有些模板直接打包在jar服务中，有些模板通过file服务调用。</p> <p>混乱的模板管理给系统的维护和实施人员带来了一些不必要的挑战和麻烦，比如对系统不熟悉时，可能忽视部分模板的管理，从而解决一些不必要的bug。</p></li> <li><p>对接流程繁杂</p> <p>当每一个具有使用模板的需求提出时，开发人员都需要经过以下的环节</p> <img src="/imags/1647068947194.png" alt="1647068947194"> <p>以上，每次具有模板填充相关的需求都是一次折腾，而这种折腾可以通过环节规范和统一来优化，缩小该过程的时间，提高对接的效率。</p></li> <li><p>不能立即响应</p> <p>在以上的方式中，每次同类需求的完成、验证和发布，都需要开发人员重新打包、实施人员重新发包，多余的环节有可能造成实施故障，并且笨拙的方式使得客户的需求不能立即响应。</p></li> <li><p>时间久内存消耗大</p> <p>我看了每个填充模板的代码逻辑，都使用了N多个内部循环，多条件循环，模板的生成因而影响系统的性能，消耗内存，且复杂模板的填充用时太久。</p></li></ol> <h4 id="_03-解决方案"><a href="#_03-解决方案" class="header-anchor">#</a> 03 解决方案</h4> <p>模板填充组件，是基于sql语句和规范对复杂的word或excel模板进行填充的一套通用代码，它在大监管工作效率月报及考核指标相关文件报表的展示及导出下载方面显示出重要的作用和极高的使用性。</p> <p>为了提高大监管开发效率，我设计了Word及excel的模板填充组件，该组件基于sql的查询和配置，能够极大减少代码内部循环，快速填充模板，组件支持word表格、word字段、word图表、excel数据的填充。</p> <p>核心逻辑如下：</p> <img src="/imags/1647072599483.png" alt="1647072599483"> <h3 id="组件的诞生历程"><a href="#组件的诞生历程" class="header-anchor">#</a> 组件的诞生历程</h3> <h4 id="_01-通过规范以动制静"><a href="#_01-通过规范以动制静" class="header-anchor">#</a> 01 通过规范以动制静</h4> <h5 id="目标"><a href="#目标" class="header-anchor">#</a> 目标</h5> <p>为了实现后期模板填充的基础代码的0改动，必须有一套实用的规范，实现数据动态插入。</p> <p>为了实现以上目标，将数据库查询结果直接插入模板中，SQL的配置设计了相关规范（规范及sql示例详见附录）。</p> <h5 id="核心逻辑"><a href="#核心逻辑" class="header-anchor">#</a> 核心逻辑</h5> <img src="/imags/1647073251087.png" alt="1647073251087"> <h5 id="核心代码"><a href="#核心代码" class="header-anchor">#</a> 核心代码</h5> <p>核心代码详见附录</p> <h5 id="结果"><a href="#结果" class="header-anchor">#</a> 结果</h5> <p>基于以上方法，当我们获取对应模板的sql语句后，只需要执行以下语句，即可得到模板需要的构造值。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 获取实体</span>
<span class="token class-name">JcTemplateConfig</span> jcTemplateConfig <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span>templateId<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 获取数据</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> mapData <span class="token operator">=</span> feildDataService<span class="token punctuation">.</span><span class="token function">buildTemplateData</span><span class="token punctuation">(</span>jcTemplateConfig<span class="token punctuation">.</span><span class="token function">getTemplateSql</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_02-文档表格多源支持"><a href="#_02-文档表格多源支持" class="header-anchor">#</a> 02 文档表格多源支持</h4> <h5 id="目标-2"><a href="#目标-2" class="header-anchor">#</a> 目标</h5> <p>为了使组件能够兼容word及excel等不同类型的文件填充，需要将对应模板进行分类，并在代码中实现分流。</p> <h5 id="核心代码-2"><a href="#核心代码-2" class="header-anchor">#</a> 核心代码</h5> <div class="language-Java extra-class"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>WORD<span class="token punctuation">,</span>wordOrExcel<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> 	<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getWordHistory</span><span class="token punctuation">(</span>templeteId<span class="token punctuation">,</span> fileType<span class="token punctuation">,</span> year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> day<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>EXCEL<span class="token punctuation">,</span>wordOrExcel<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getExcelHistory</span><span class="token punctuation">(</span>templeteId<span class="token punctuation">,</span> fileType<span class="token punctuation">,</span> year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> day<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">DeclareException</span><span class="token punctuation">(</span><span class="token string">&quot;不存在的类型&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre></div><h4 id="_03-图文表数应有尽有"><a href="#_03-图文表数应有尽有" class="header-anchor">#</a> 03 图文表数应有尽有</h4> <h5 id="目标-3"><a href="#目标-3" class="header-anchor">#</a> 目标</h5> <p>在word或excel的模板填充中，会涉及到图表如柱状图、饼图等的填充及excel表格的填充，在正确配置sql后，组件将在模板处理中，自动对对应的图表等进行填充。</p> <h5 id="核心代码-3"><a href="#核心代码-3" class="header-anchor">#</a> 核心代码</h5> <p>核心代码详见附录</p> <h4 id="_04-用资源池闭源节流"><a href="#_04-用资源池闭源节流" class="header-anchor">#</a> 04 用资源池闭源节流</h4> <h5 id="目标-4"><a href="#目标-4" class="header-anchor">#</a> 目标</h5> <p>复杂的模板，会在数据库查询多条sql，这会增大数据库的压力，因此设计资源池，使得研发人员通过接口调用可以实现每个模板按年、按月、按日获取唯一缓存数据，从而降低模板sql查询批次。</p> <h5 id="核心逻辑-2"><a href="#核心逻辑-2" class="header-anchor">#</a> 核心逻辑</h5> <img src="/imags/1647073956330.png" alt="1647073956330"> <h5 id="核心代码-4"><a href="#核心代码-4" class="header-anchor">#</a> 核心代码</h5> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 校验</span>
		historicWordsService<span class="token punctuation">.</span><span class="token function">checkDataAvailability</span><span class="token punctuation">(</span>templeteId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取历史缓存数据</span>
<span class="token class-name">JcHistoricWords</span> words <span class="token operator">=</span> historicWordsService<span class="token punctuation">.</span><span class="token function">getWordsByTemplateId</span><span class="token punctuation">(</span>templeteId<span class="token punctuation">,</span> fileType<span class="token punctuation">,</span> year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> day<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="推广使用的意义"><a href="#推广使用的意义" class="header-anchor">#</a> 推广使用的意义</h3> <ol><li>对模板进行统一管理，降低维护成本</li> <li>动态管理sql，快速响应用户需求</li> <li>减少对接环节，提高工作效率</li> <li>快速验证，不必打包发布</li> <li>规范使用接口，提高前后端对接效率</li></ol> <h3 id="组件后期的优化"><a href="#组件后期的优化" class="header-anchor">#</a> 组件后期的优化</h3> <h4 id="优化sql"><a href="#优化sql" class="header-anchor">#</a> 优化SQL</h4> <p>当前模板填充版本基于大量sql，有些sql复杂性较高，考虑以视图方式缓存数据，提高sql查询。</p> <h4 id="定制化配置"><a href="#定制化配置" class="header-anchor">#</a> 定制化配置</h4> <p>当用户只需要查询某具体时间段的数据时，需要配置<code>startTime</code>及<code>endTime</code>字段，而一些具有特殊需求的模板，也应该增加对应的配置项，这种配置项在后期的使用中将逐一完善。</p> <h3 id="附录"><a href="#附录" class="header-anchor">#</a> 附录</h3> <h4 id="sql规范"><a href="#sql规范" class="header-anchor">#</a> sql规范</h4> <table><thead><tr><th style="text-align:center;">符号</th> <th style="text-align:center;">作用</th> <th style="text-align:center;"></th></tr></thead> <tbody><tr><td style="text-align:center;">#</td> <td style="text-align:center;">用来分割每个完成的查询sql</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">[]</td> <td style="text-align:center;">如果你想生成图表，可以将你想展示的图表名用[]包裹</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">{}</td> <td style="text-align:center;">如果你想插入一个表格数据，可以用{}将对应数组的名称用{}包裹</td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">;</td> <td style="text-align:center;">用来分割每个可执行的sql</td> <td style="text-align:center;"></td></tr></tbody></table> <h4 id="sql示例"><a href="#sql示例" class="header-anchor">#</a> SQL示例</h4> <h5 id="普通sql"><a href="#普通sql" class="header-anchor">#</a> 普通SQL</h5> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> FWBJ <span class="token keyword">FROM</span> doc_entity <span class="token keyword">WHERE</span> doc_entity<span class="token punctuation">.</span>script_type <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">AND</span> doc_entity<span class="token punctuation">.</span>key_num_gather <span class="token operator">IS</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token operator">and</span> doc_entity<span class="token punctuation">.</span>op_state <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span><span class="token comment">#</span>
</code></pre></div><h5 id="表格sql"><a href="#表格sql" class="header-anchor">#</a> 表格SQL</h5> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
	city_assess_id <span class="token keyword">AS</span> <span class="token keyword">INDEX</span><span class="token punctuation">,</span>
	assess_project <span class="token keyword">AS</span> prj<span class="token punctuation">,</span>
	assess_indicative <span class="token keyword">AS</span> zhibiao<span class="token punctuation">,</span>
	indicative_nature <span class="token keyword">as</span> xinzhi<span class="token punctuation">,</span>
	score <span class="token keyword">as</span> fenzhi<span class="token punctuation">,</span>
	inspection_points <span class="token keyword">as</span> content<span class="token punctuation">,</span>
	duty_office_depart <span class="token keyword">as</span> depart<span class="token punctuation">,</span>
	match_office_depart <span class="token keyword">as</span> depart2<span class="token punctuation">,</span>
	duty_leader <span class="token keyword">as</span> leader<span class="token punctuation">,</span>
	assess_performance <span class="token keyword">as</span> state<span class="token punctuation">,</span>
	<span class="token string">'无'</span> <span class="token keyword">as</span> remark<span class="token punctuation">,</span>
	update_time <span class="token keyword">as</span> shijian
<span class="token keyword">FROM</span>
	jc_urban_assessment<span class="token punctuation">;</span>{<span class="token keyword">table</span>}<span class="token comment">#</span>
</code></pre></div><h5 id="图表sql"><a href="#图表sql" class="header-anchor">#</a> 图表SQL</h5> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span>
	city_assess_id <span class="token keyword">AS</span> <span class="token keyword">INDEX</span><span class="token punctuation">,</span>
	assess_project <span class="token keyword">AS</span> prj<span class="token punctuation">,</span>
	assess_indicative <span class="token keyword">AS</span> zhibiao<span class="token punctuation">,</span>
	indicative_nature <span class="token keyword">as</span> xinzhi<span class="token punctuation">,</span>
	score <span class="token keyword">as</span> fenzhi<span class="token punctuation">,</span>
	inspection_points <span class="token keyword">as</span> content<span class="token punctuation">,</span>
	duty_office_depart <span class="token keyword">as</span> depart<span class="token punctuation">,</span>
	match_office_depart <span class="token keyword">as</span> depart2<span class="token punctuation">,</span>
	duty_leader <span class="token keyword">as</span> leader<span class="token punctuation">,</span>
	assess_performance <span class="token keyword">as</span> state<span class="token punctuation">,</span>
	<span class="token string">'无'</span> <span class="token keyword">as</span> remark<span class="token punctuation">,</span>
	update_time <span class="token keyword">as</span> shijian
<span class="token keyword">FROM</span>
	jc_urban_assessment<span class="token punctuation">;</span><span class="token punctuation">[</span><span class="token keyword">table</span><span class="token punctuation">]</span><span class="token comment">#</span>
</code></pre></div><h3 id="核心代码-5"><a href="#核心代码-5" class="header-anchor">#</a> 核心代码</h3> <h4 id="数据填充核心代码"><a href="#数据填充核心代码" class="header-anchor">#</a> 数据填充核心代码</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;TYPE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">FeildTypeEnum</span><span class="token punctuation">.</span>ORDINARY<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;TYPE&quot;</span><span class="token punctuation">,</span><span class="token class-name">FeildTypeEnum</span><span class="token punctuation">.</span>ORDINARY<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;VALUE&quot;</span><span class="token punctuation">,</span>sqlByMapService<span class="token punctuation">.</span><span class="token function">getTemplateOrdinary</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;SQL&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>resultData<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;TYPE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">FeildTypeEnum</span><span class="token punctuation">.</span>ORDINARY<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;TYPE&quot;</span><span class="token punctuation">,</span><span class="token class-name">FeildTypeEnum</span><span class="token punctuation">.</span>ORDINARY<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;VALUE&quot;</span><span class="token punctuation">,</span>sqlByMapService<span class="token punctuation">.</span><span class="token function">getTemplateOrdinary</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;SQL&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>resultData<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;TYPE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">FeildTypeEnum</span><span class="token punctuation">.</span>ORDINARY<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;TYPE&quot;</span><span class="token punctuation">,</span><span class="token class-name">FeildTypeEnum</span><span class="token punctuation">.</span>ORDINARY<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;VALUE&quot;</span><span class="token punctuation">,</span>sqlByMapService<span class="token punctuation">.</span><span class="token function">getTemplateOrdinary</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;SQL&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
resultData<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="sql分割核心代码"><a href="#sql分割核心代码" class="header-anchor">#</a> sql分割核心代码</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 存在表中表结构</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token class-name">ConstantJiance</span><span class="token punctuation">.</span>CHECK_CUR_LEFT<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> string<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token class-name">ConstantJiance</span><span class="token punctuation">.</span>CHECK_CUR_RIGHT<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;TYPE&quot;</span><span class="token punctuation">,</span> <span class="token class-name">FeildTypeEnum</span><span class="token punctuation">.</span>TABLE<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sqls <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token class-name">ConstantJiance</span><span class="token punctuation">.</span>CUR_LEFT<span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;SQL&quot;</span><span class="token punctuation">,</span>sqls<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;TABLE_NAME&quot;</span><span class="token punctuation">,</span>sqls<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token class-name">ConstantJiance</span><span class="token punctuation">.</span>CUR_RIGHT<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 普通字段</span>
<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>string<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token class-name">ConstantJiance</span><span class="token punctuation">.</span>CHECK_CUR_LEFT<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>string<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token class-name">ConstantJiance</span><span class="token punctuation">.</span>CHECK_CUR_RIGHT<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;TYPE&quot;</span><span class="token punctuation">,</span> <span class="token class-name">FeildTypeEnum</span><span class="token punctuation">.</span>ORDINARY<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;SQL&quot;</span><span class="token punctuation">,</span>string<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>string<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token class-name">ConstantJiance</span><span class="token punctuation">.</span>CHECK_TABLE_CUR_LEFT<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> string<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token class-name">ConstantJiance</span><span class="token punctuation">.</span>CHECK_TABLE_CUR_RIGHT<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;TYPE&quot;</span><span class="token punctuation">,</span> <span class="token class-name">FeildTypeEnum</span><span class="token punctuation">.</span>CHART<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> sqls <span class="token operator">=</span> string<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token class-name">ConstantJiance</span><span class="token punctuation">.</span>CUR_TABLE_LEFT<span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;SQL&quot;</span><span class="token punctuation">,</span>sqls<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;CHART_NAME&quot;</span><span class="token punctuation">,</span>sqls<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token class-name">ConstantJiance</span><span class="token punctuation">.</span>CUR_TABLE_RIGHT<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">DeclareException</span><span class="token punctuation">(</span><span class="token string">&quot;异常SQL，请重新配置&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre></div><h4 id="图文填充核心代码"><a href="#图文填充核心代码" class="header-anchor">#</a> 图文填充核心代码</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
	 * 功能描述: 根据要填充的类型 对内容进行填充WORD
	 * @author sutinghu
	 * @date
	 * @param file
	 * @param list 参数
	 * @return byte[]
	 */</span>
	<span class="token annotation punctuation">@SneakyThrows</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">buildTemplateWord</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> file<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> file<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fileResult <span class="token operator">=</span> file<span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">String</span> type <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;TYPE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Object</span> value <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;VALUE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 填充的内容是普通字段</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">FeildTypeEnum</span><span class="token punctuation">.</span>ORDINARY<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">Map</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> valueOrdinaty <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> value<span class="token punctuation">;</span>fileResult <span class="token operator">=</span> <span class="token function">fillWordDataByMap</span><span class="token punctuation">(</span>fileResult<span class="token punctuation">,</span> valueOrdinaty<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token comment">// 填充的内容是普通表格</span>
<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">FeildTypeEnum</span><span class="token punctuation">.</span>TABLE<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token class-name">String</span> tableName <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;TABLE_NAME&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">List</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>fileResult <span class="token operator">=</span> <span class="token function">fillWordDataByMap</span><span class="token punctuation">(</span>fileResult<span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token function">put</span><span class="token punctuation">(</span>tableName<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// 填充的内容是普通图表</span>
<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">FeildTypeEnum</span><span class="token punctuation">.</span>CHART<span class="token punctuation">.</span><span class="token function">getDesc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token class-name">String</span> tableName <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;CHART_NAME&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token keyword">instanceof</span> <span class="token class-name">List</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> list1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> value<span class="token punctuation">;</span>
fileResult <span class="token operator">=</span> <span class="token function">fillWordChartByMap</span><span class="token punctuation">(</span>fileResult<span class="token punctuation">,</span>list1<span class="token punctuation">,</span>tableName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> fileResult<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="简易ftp服务设计与实现"><a href="#简易ftp服务设计与实现" class="header-anchor">#</a> 简易FTP服务设计与实现</h2> <h3 id="什么是ftp服务"><a href="#什么是ftp服务" class="header-anchor">#</a> 什么是FTP服务？</h3> <p>互联网上提供文件（存储）和访问服务的（计算机），它们依照<a href="https://baike.baidu.com/item/FTP%E5%8D%8F%E8%AE%AE" target="_blank" rel="noopener noreferrer">FTP协议<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>提供服务。 FTP是File Transfer Protocol（文件传输协议）。顾名思义，就是专门用来传输文件的协议。简单地说，支持FTP协议的服务器就是FTP服务器。</p> <p>FTP服务分为服务器（Server）和客户机（Client）两个角色。FTP服务器使用的端口是21端口和20端口，21端口用于服务器和客户机建立命令的链路，20端口用于服务器向客户机建立数据链路。</p> <h3 id="ftp的作用"><a href="#ftp的作用" class="header-anchor">#</a> FTP的作用</h3> <ol><li>用来在两台计算机之间传输文件</li> <li>具有跨平台的特性</li> <li>网络中经常采用的资源共享方式之一</li></ol> <h3 id="ftp协议"><a href="#ftp协议" class="header-anchor">#</a> FTP协议</h3> <p>FTP（File Transfer Protocol）即文件传输协议，是一种基于TCP的协议，采用客户/服务器模式。  通过FTP协议，用户可以在FTP服务器中进行文件的上传或下载等操作。</p> <h3 id="ftp的特点"><a href="#ftp的特点" class="header-anchor">#</a> FTP的特点</h3> <ul><li>FTP使用两个平行连接：控制连接和数据连接。控制连接在两主机间传送控制命令，如用户身份、口令、改变目录命令等。数据连接只用于传送数据。</li> <li>在一个会话期间，FTP服务器必须维持用户状态，也就是说，和某一个用户的控制连接不能断开。另外，当用户在目录树中活动时，服务器必须追踪用户的当前目录，这样，FTP就限制了并发用户数量。</li> <li>FTP支持文件沿任意方向传输。当用户与一远程计算机建立连接后，用户可以获得一个远程文件也可以将一本地文件传输至远程机器。</li></ul> <h3 id="ftp服务的传输模式"><a href="#ftp服务的传输模式" class="header-anchor">#</a> FTP服务的传输模式</h3> <p>FTP传输模式分别为主动模式和被动模式</p> <ul><li>主动模式是服务器主动连接客户机并建立数据链路</li> <li>被动模式是服务器等待客户机建立数据链路</li></ul> <img src="/imags/1652858950516.png" alt="1652858950516"> <img src="/imags/1652858933230.png" alt="1652858933230"> <h3 id="tcp-udp协议"><a href="#tcp-udp协议" class="header-anchor">#</a> TCP/UDP协议</h3> <blockquote><p><a href="https://zhuanlan.zhihu.com/p/260139078" target="_blank" rel="noopener noreferrer">用大白话解释什么是Socket <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h4 id="udp协议"><a href="#udp协议" class="header-anchor">#</a> UDP协议</h4> <h5 id="特征"><a href="#特征" class="header-anchor">#</a> 特征</h5> <ul><li><p>UDP是面向无连接的协议。</p></li> <li><p>UDP使用数据报套接字(Datagram Socket)进行通信，因为数据报有长度，所以传输的消息有记录边界。</p></li> <li><p>应用进程发送的消息被封装到UDP数据报，UDP数据报被封装到IP数据报，最终的数据报被发送到目的地。</p></li> <li><p>UDP缺乏可靠性，不能保证数据一定能送达，也不能保证数据被送达的频次和先后顺序。</p></li></ul> <h5 id="流程"><a href="#流程" class="header-anchor">#</a> 流程</h5> <blockquote><p>客户端：socket()-&gt;bind()-&gt;sendto()-&gt;recvfrom()-&gt;close() //客户端可以不用bind()</p> <p>服务器：socket()-&gt;bind()-&gt;recvfrom()-&gt;sendto()-&gt;close()</p></blockquote> <img src="/imags/1652859122698.png" alt="1652859122698"> <h4 id="tcp协议"><a href="#tcp协议" class="header-anchor">#</a> TCP协议</h4> <h5 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h5> <ul><li>TCP是面向连接的协议，建立连接的过程有三次握手和四次握手。</li> <li>TCP使用流套接字(Stream Socket)进行通信，因为流没有长度，所以传输的消息没有记录边界。</li> <li>客户端使用TCP协议与服务器进行通信时，需要先建立连接，然后才能进行数据交换。</li> <li>TCP提供了消息确认和重传机制，保证了传输的可靠性。</li> <li>TCP提供了流量控制，流量控制的大小取决于接收缓冲区可用空间的大小。客户端发送一次数据，接收缓冲区可用空间变小。服务器接收一次数据，接收缓冲区可用空间变大。</li> <li>TCP连接为全双工通信，而UDP既可以全双工通信，也可以使用别的通信模式。</li></ul> <h5 id="连接模式"><a href="#连接模式" class="header-anchor">#</a> 连接模式</h5> <p>通信的两种模式：SYN &amp; ACK</p> <p>SYN：用来发送新信号</p> <p>ACK：用来返回确认信号</p> <h5 id="建立连接"><a href="#建立连接" class="header-anchor">#</a> 建立连接</h5> <p>​	1.找个可以通话的手机(socket() )</p> <p>​	2.拨通对方号码并确定对方是自己要找的人（ connect() ）</p> <p>​	3.主动聊天（ send() 或 write() ）</p> <p>​	4.或者，接收对方的回话（ recv() 或read() ）</p> <p>​	5.通信结束后，双方说再见挂电话（close() ）</p> <h5 id="流程-2"><a href="#流程-2" class="header-anchor">#</a> 流程</h5> <ul><li>三次握手和四次握手主要发生在connect/accept阶段。</li></ul> <p>客户端：socket()-------------------&gt;connect()-&gt;I/O操作-&gt;close()</p> <p>服务器：socket()-&gt;bind()-&gt;listen()-&gt;accept()-&gt;I/O操作-&gt;close()</p> <img src="/imags/1652861088496.png" alt="1652861088496"> <h3 id="ftp-被动模式服务端设计"><a href="#ftp-被动模式服务端设计" class="header-anchor">#</a> FTP 被动模式服务端设计</h3> <h4 id="流程设计"><a href="#流程设计" class="header-anchor">#</a> 流程设计</h4> <img src="/imags/1652860841466.png" alt="1652860841466"> <h4 id="代码实现"><a href="#代码实现" class="header-anchor">#</a> 代码实现</h4> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;dirent.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">N</span> <span class="token expression"><span class="token number">256</span></span><span class="token comment">//文件名和命令名最长为256字节</span></span>

<span class="token comment">// 查看文件命令 </span>
<span class="token keyword">void</span> <span class="token function">commd_ls</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 下载文件 </span>
<span class="token keyword">void</span> <span class="token function">commd_get</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 上传文件 </span>
<span class="token keyword">void</span> <span class="token function">commd_put</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> arg<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	
    <span class="token keyword">int</span> ser_sockfd<span class="token punctuation">,</span>cli_sockfd<span class="token punctuation">;</span><span class="token comment">// 服务端和客户端的套接字文件描述符 </span>
    <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> ser_addr<span class="token punctuation">,</span>cli_addr<span class="token punctuation">;</span><span class="token comment">// 服务端和客户端的套接字文件结构体 </span>
    <span class="token keyword">int</span> ser_len<span class="token punctuation">,</span> cli_len<span class="token punctuation">;</span><span class="token comment">//  结构体长度 </span>
    <span class="token keyword">char</span> commd <span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">bzero</span><span class="token punctuation">(</span>commd<span class="token punctuation">,</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将commd所指向的字符串的前N个字节置为0，包括'\0'</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ser_sockfd<span class="token operator">=</span><span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Sokcet Error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">bzero</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>ser_addr<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>ser_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ser_addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>
    ser_addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">htonl</span><span class="token punctuation">(</span>INADDR_ANY<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//本地ip地址</span>
    ser_addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span> <span class="token punctuation">(</span><span class="token number">8989</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//转换成网络字节</span>
    ser_len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>ser_addr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//将ip地址与套接字绑定</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">bind</span><span class="token punctuation">(</span>ser_sockfd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>ser_addr<span class="token punctuation">,</span> ser_len<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Bind Error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//服务器端监听</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">listen</span><span class="token punctuation">(</span>ser_sockfd<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Linsten Error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">bzero</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>cli_addr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>cli_addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ser_len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>cli_addr<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;server&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//服务器端接受来自客户端的连接，返回一个套接字，此套接字为新建的一个，并将客户端的地址等信息存入cli_addr中</span>
        <span class="token comment">//原来的套接字仍处于监听中</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>cli_sockfd<span class="token operator">=</span><span class="token function">accept</span><span class="token punctuation">(</span>ser_sockfd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>cli_addr<span class="token punctuation">,</span> <span class="token operator">&amp;</span>cli_len<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Accept Error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//由套接字接收数据时，套接字把接收的数据放在套接字缓冲区，再由用户程序把它们复制到用户缓冲区，然后由read函数读取</span>
        <span class="token comment">//write函数同理</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">read</span><span class="token punctuation">(</span>cli_sockfd<span class="token punctuation">,</span> commd<span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">//read函数从cli_sockfd中读取N个字节数据放入commd中</span>
        <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Read Error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;recvd [ %s ]\n&quot;</span><span class="token punctuation">,</span>commd<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strncmp</span><span class="token punctuation">(</span>commd<span class="token punctuation">,</span><span class="token string">&quot;ls&quot;</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">commd_ls</span><span class="token punctuation">(</span>cli_sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strncmp</span><span class="token punctuation">(</span>commd<span class="token punctuation">,</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">commd_get</span><span class="token punctuation">(</span>cli_sockfd<span class="token punctuation">,</span> commd<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strncmp</span><span class="token punctuation">(</span>commd<span class="token punctuation">,</span> <span class="token string">&quot;put&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">commd_put</span><span class="token punctuation">(</span>cli_sockfd<span class="token punctuation">,</span> commd<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Error!Command Error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
**显示文件列表
*/</span>
<span class="token keyword">void</span> <span class="token function">commd_ls</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    DIR <span class="token operator">*</span> mydir <span class="token operator">=</span><span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">dirent</span> <span class="token operator">*</span>myitem <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> commd<span class="token punctuation">[</span>N<span class="token punctuation">]</span> <span class="token punctuation">;</span>
    <span class="token function">bzero</span><span class="token punctuation">(</span>commd<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//opendir为用来打开参数name 指定的目录, 并返回DIR*形态的目录流</span>
    <span class="token comment">//mydir中存有相关目录的信息</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mydir<span class="token operator">=</span><span class="token function">opendir</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;OpenDir Error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>myitem <span class="token operator">=</span> <span class="token function">readdir</span><span class="token punctuation">(</span>mydir<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token comment">//用来读取目录,返回是dirent结构体指针</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sprintf</span><span class="token punctuation">(</span>commd<span class="token punctuation">,</span> myitem<span class="token operator">-&gt;</span>d_name<span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//把文件名写入commd指向的缓冲区</span>
        <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Sprintf Error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">write</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> commd<span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span><span class="token comment">//将commd缓冲区的内容发送会client</span>
        <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Write Error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">closedir</span><span class="token punctuation">(</span>mydir<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//关闭目录流</span>
    <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
**实现文件的下载                            
*/</span>
<span class="token keyword">void</span> <span class="token function">commd_get</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> fd<span class="token punctuation">,</span> nbytes<span class="token punctuation">;</span>
    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">bzero</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;get filename : [ %s ]\n&quot;</span><span class="token punctuation">,</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fd<span class="token operator">=</span><span class="token function">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//以只读的方式打开client要下载的文件</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Open file Error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        buffer<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'N'</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">write</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Write Error!At commd_get 1\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    buffer<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Y'</span><span class="token punctuation">;</span>    <span class="token comment">//此处标示出文件读取成功</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">write</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Write Error! At commd_get 2!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>nbytes<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//将文件内容读到buffer中</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">write</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> nbytes<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//将buffer发送回client</span>
        <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Write Error! At commd_get 3!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
**实现文件的上传                            
*/</span>
<span class="token keyword">void</span> <span class="token function">commd_put</span><span class="token punctuation">(</span><span class="token keyword">int</span> sockfd<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>filename<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> fd<span class="token punctuation">,</span> nbytes<span class="token punctuation">;</span>
    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">bzero</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;get filename : [ %s ]\n&quot;</span><span class="token punctuation">,</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fd<span class="token operator">=</span><span class="token function">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> O_WRONLY<span class="token operator">|</span>O_CREAT<span class="token operator">|</span>O_TRUNC<span class="token punctuation">,</span> <span class="token number">0644</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//以只写的方式打开文件，若文件存在则清空，若文件不存在则新建文件</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Open file Error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>nbytes<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//将client发送的文件写入buffer</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> nbytes<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//将buffer中的内容写到文件中</span>
        <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Write Error! At commd_put 1!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="ftp被动模式客户端设计"><a href="#ftp被动模式客户端设计" class="header-anchor">#</a> FTP被动模式客户端设计</h3> <h4 id="流程设计-2"><a href="#流程设计-2" class="header-anchor">#</a> 流程设计</h4> <img src="/imags/1652862681358.png" alt="1652862681358"> <h4 id="代码实现-2"><a href="#代码实现-2" class="header-anchor">#</a> 代码实现</h4> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;netinet/in.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">N</span> <span class="token expression"><span class="token number">256</span></span></span>

<span class="token keyword">void</span> <span class="token function">commd_help</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">commd_exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">commd_ls</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span><span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">commd_get</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> <span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">commd_put</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> <span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span> commd<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> addr<span class="token punctuation">;</span>
    <span class="token keyword">int</span> len<span class="token punctuation">;</span>
    <span class="token function">bzero</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>addr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">//将＆addr中的前sizeof（addr）字节置为0，包括'\0'</span>
    addr<span class="token punctuation">.</span>sin_family <span class="token operator">=</span> AF_INET<span class="token punctuation">;</span>      <span class="token comment">//AF_INET代表TCP／IP协议</span>
    addr<span class="token punctuation">.</span>sin_addr<span class="token punctuation">.</span>s_addr <span class="token operator">=</span> <span class="token function">inet_addr</span><span class="token punctuation">(</span><span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将点间隔地址转换为网络字节顺序</span>
    addr<span class="token punctuation">.</span>sin_port <span class="token operator">=</span> <span class="token function">htons</span><span class="token punctuation">(</span><span class="token number">8989</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//转换为网络字节顺序</span>
    len <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;ftp&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">bzero</span><span class="token punctuation">(</span>commd<span class="token punctuation">,</span>N<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//fgets函数从stdin流中读取N-1个字符放入commd中</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">fgets</span><span class="token punctuation">(</span>commd<span class="token punctuation">,</span>N<span class="token punctuation">,</span><span class="token constant">stdin</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Fgets Error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        commd<span class="token punctuation">[</span><span class="token function">strlen</span><span class="token punctuation">(</span>commd<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'\0'</span><span class="token punctuation">;</span>    <span class="token comment">//fgets函数读取的最后一个字符为换行符，此处将其替换为'\0'</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Input Command Is [ %s ]\n&quot;</span><span class="token punctuation">,</span>commd<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strncmp</span><span class="token punctuation">(</span>commd<span class="token punctuation">,</span><span class="token string">&quot;help&quot;</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//比较两个字符串前4个字节，若相等则返回0</span>
        <span class="token punctuation">{</span>
            <span class="token function">commd_help</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strncmp</span><span class="token punctuation">(</span>commd<span class="token punctuation">,</span> <span class="token string">&quot;exit&quot;</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">commd_exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//结束进程</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strncmp</span><span class="token punctuation">(</span>commd<span class="token punctuation">,</span> <span class="token string">&quot;ls&quot;</span> <span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">commd_ls</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> commd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strncmp</span><span class="token punctuation">(</span>commd<span class="token punctuation">,</span> <span class="token string">&quot;get&quot;</span> <span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">commd_get</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> commd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strncmp</span><span class="token punctuation">(</span>commd<span class="token punctuation">,</span> <span class="token string">&quot;put&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">==</span><span class="token number">0</span> <span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">commd_put</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> commd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span>
        <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Command Is Error!Please Try Again!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
**帮助信息
*/</span>
<span class="token keyword">void</span> <span class="token function">commd_help</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n=---------------------欢迎使用FTP--------------------------|\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;|                                                            |\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;|            help:View all commands                          |\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;|                                                            |\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;|            exit:Disconnect                                 |\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;|                                                            |\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;|            ls : Displays a list of files for the FTP server|\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;|                                                            |\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;|            get &lt;file&gt;：Download files from FTP server      |\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;|                                                            |\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;|            put &lt;file&gt;:Transfer files to FTP server         |\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;|                                                            |\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;|------------------------------------------------------------|\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
**退出FTP服务器
*/</span>
<span class="token keyword">void</span> <span class="token function">commd_exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Bye!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
**显示文件列表
*/</span>
<span class="token keyword">void</span> <span class="token function">commd_ls</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> addr<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>commd<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> sockfd<span class="token punctuation">;</span>
    <span class="token comment">//创建套接字</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sockfd<span class="token operator">=</span><span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Socket Error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">connect</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>addr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Connect Error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//将commd指向的内容写入到sockfd所指的文件中，此处即指套接字</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">write</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> commd<span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Write Error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token function">read</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> commd<span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">//从sockfd中读取N字节内容放入commd中，</span>
    <span class="token punctuation">{</span>                                   <span class="token comment">//返回值为读取的字节数</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot; %s &quot;</span><span class="token punctuation">,</span>commd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
**实现文件的下载                            
*/</span>
<span class="token keyword">void</span> <span class="token function">commd_get</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> addr<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>commd<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> fd<span class="token punctuation">;</span>
    <span class="token keyword">int</span> sockfd<span class="token punctuation">;</span>
    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> nbytes<span class="token punctuation">;</span>
    <span class="token comment">//创建套接字，并进行错误检测</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sockfd<span class="token operator">=</span><span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Socket Error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//connect函数用于实现客户端与服务端的连接,此处还进行了错误检测</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">connect</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>addr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Connect Error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//通过write函数向服务端发送数据</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">write</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> commd<span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Write Error!At commd_get 1\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//利用read函数来接受服务器发来的数据</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">read</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> N<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Read Error!At commd_get 1\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//用于检测服务器端文件是否打开成功</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>buffer<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span><span class="token string">'N'</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Can't Open The File!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//open函数创建一个文件，文件地址为(commd+4)，该地址从命令行输入获取</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fd<span class="token operator">=</span><span class="token function">open</span><span class="token punctuation">(</span>commd<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">,</span> O_WRONLY<span class="token operator">|</span>O_CREAT<span class="token operator">|</span>O_TRUNC<span class="token punctuation">,</span> <span class="token number">0644</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Open Error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//read函数从套接字中获取N字节数据放入buffer中，返回值为读取的字节数</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>nbytes<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//write函数将buffer中的内容读取出来写入fd所指向的文件，返回值为实际写入的字节数</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> nbytes<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Write Error!At commd_get 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token comment">/*
**实现文件的上传                            
*/</span>
<span class="token keyword">void</span> <span class="token function">commd_put</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span> addr<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>commd<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> fd<span class="token punctuation">;</span>
    <span class="token keyword">int</span> sockfd<span class="token punctuation">;</span>
    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> nbytes<span class="token punctuation">;</span>
    <span class="token comment">//创建套接字</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sockfd<span class="token operator">=</span><span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span> SOCK_STREAM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Socket Error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//客户端与服务端连接</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">connect</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>addr<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Connect Error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//从commd中读取N字节数据，写入套接字中</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">write</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> commd<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Wrtie Error!At commd_put 1\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//open函数从(commd+4)中，读取文件路径，以只读的方式打开</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fd<span class="token operator">=</span><span class="token function">open</span><span class="token punctuation">(</span>commd<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">,</span> O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Open Error!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//从fd指向的文件中读取N个字节数据</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>nbytes<span class="token operator">=</span><span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">//从buffer中读取nbytes字节数据，写入套接字中</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">write</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> nbytes<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Write Error!At commd_put 2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">close</span><span class="token punctuation">(</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="结果-2"><a href="#结果-2" class="header-anchor">#</a> 结果</h3> <h4 id="执行help命令"><a href="#执行help命令" class="header-anchor">#</a> 执行help命令</h4> <img src="/imags/1652862363744.png" alt="1652862363744"> <h4 id="执行ls命令"><a href="#执行ls命令" class="header-anchor">#</a> 执行ls命令</h4> <img src="/imags/1652862384118.png" alt="1652862384118"> <h2 id="shell监控脚本"><a href="#shell监控脚本" class="header-anchor">#</a> Shell监控脚本</h2> <h3 id="引入"><a href="#引入" class="header-anchor">#</a> 引入</h3> <p>平时在进行服务端开发时，常常会因为Linux服务器内存等信息出问题而导致服务不可用，因此监控服务器系统信息至关重要。</p> <h3 id="代码"><a href="#代码" class="header-anchor">#</a> 代码</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token comment"># 获取要监控的本地服务器IP地址</span>
<span class="token assign-left variable">IP</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">ifconfig</span> <span class="token operator">|</span> <span class="token function">grep</span> inet <span class="token operator">|</span> <span class="token function">grep</span> -vE <span class="token string">'inet6|127.0.0.1'</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $2}'</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;IP地址：&quot;</span><span class="token variable">$IP</span>
 
<span class="token comment"># 获取cpu总核数</span>
<span class="token assign-left variable">cpu_num</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">grep</span> -c <span class="token string">&quot;model name&quot;</span> /proc/cpuinfo<span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;cpu总核数：&quot;</span><span class="token variable">$cpu_num</span>
 
<span class="token comment"># 1、获取CPU利用率</span>
<span class="token comment"># 获取用户空间占用CPU百分比</span>
<span class="token assign-left variable">cpu_user</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">top</span> -b -n <span class="token number">1</span> <span class="token operator">|</span> <span class="token function">grep</span> Cpu <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $2}'</span> <span class="token operator">|</span> <span class="token function">cut</span> -f <span class="token number">1</span> -d <span class="token string">&quot;%&quot;</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;用户空间占用CPU百分比：&quot;</span><span class="token variable">$cpu_user</span>
 
<span class="token comment"># 获取内核空间占用CPU百分比</span>
<span class="token assign-left variable">cpu_system</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">top</span> -b -n <span class="token number">1</span> <span class="token operator">|</span> <span class="token function">grep</span> Cpu <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $4}'</span> <span class="token operator">|</span> <span class="token function">cut</span> -f <span class="token number">1</span> -d <span class="token string">&quot;%&quot;</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;内核空间占用CPU百分比：&quot;</span><span class="token variable">$cpu_system</span>
 
<span class="token comment"># 获取空闲CPU百分比</span>
<span class="token assign-left variable">cpu_idle</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">top</span> -b -n <span class="token number">1</span> <span class="token operator">|</span> <span class="token function">grep</span> Cpu <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $8}'</span> <span class="token operator">|</span> <span class="token function">cut</span> -f <span class="token number">1</span> -d <span class="token string">&quot;%&quot;</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;空闲CPU百分比：&quot;</span><span class="token variable">$cpu_idle</span>
 
<span class="token comment"># 获取等待输入输出占CPU百分比</span>
<span class="token assign-left variable">cpu_iowait</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">top</span> -b -n <span class="token number">1</span> <span class="token operator">|</span> <span class="token function">grep</span> Cpu <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $10}'</span> <span class="token operator">|</span> <span class="token function">cut</span> -f <span class="token number">1</span> -d <span class="token string">&quot;%&quot;</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;等待输入输出占CPU百分比：&quot;</span><span class="token variable">$cpu_iowait</span>
 
<span class="token comment">#2、获取CPU上下文切换和中断次数</span>
<span class="token comment"># 获取CPU中断次数</span>
<span class="token assign-left variable">cpu_interrupt</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">vmstat</span> -n <span class="token number">1</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token function">sed</span> -n 3p <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $11}'</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;CPU中断次数：&quot;</span><span class="token variable">$cpu_interrupt</span>
 
<span class="token comment"># 获取CPU上下文切换次数</span>
<span class="token assign-left variable">cpu_context_switch</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">vmstat</span> -n <span class="token number">1</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token function">sed</span> -n 3p <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $12}'</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;CPU上下文切换次数：&quot;</span><span class="token variable">$cpu_context_switch</span>
 
<span class="token comment">#3、获取CPU负载信息</span>
<span class="token comment"># 获取CPU15分钟前到现在的负载平均值</span>
<span class="token assign-left variable">cpu_load_15min</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">uptime</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $11}'</span> <span class="token operator">|</span> <span class="token function">cut</span> -f <span class="token number">1</span> -d <span class="token string">','</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;CPU 15分钟前到现在的负载平均值：&quot;</span><span class="token variable">$cpu_load_15min</span>
 
<span class="token comment"># 获取CPU5分钟前到现在的负载平均值</span>
<span class="token assign-left variable">cpu_load_5min</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">uptime</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $10}'</span> <span class="token operator">|</span> <span class="token function">cut</span> -f <span class="token number">1</span> -d <span class="token string">','</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;CPU 5分钟前到现在的负载平均值：&quot;</span><span class="token variable">$cpu_load_5min</span>
 
<span class="token comment"># 获取CPU1分钟前到现在的负载平均值</span>
<span class="token assign-left variable">cpu_load_1min</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">uptime</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $9}'</span> <span class="token operator">|</span> <span class="token function">cut</span> -f <span class="token number">1</span> -d <span class="token string">','</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;CPU 1分钟前到现在的负载平均值：&quot;</span><span class="token variable">$cpu_load_1min</span>
 
<span class="token comment"># 获取任务队列(就绪状态等待的进程数)</span>
<span class="token assign-left variable">cpu_task_length</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">vmstat</span> -n <span class="token number">1</span> <span class="token number">1</span> <span class="token operator">|</span> <span class="token function">sed</span> -n 3p <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $1}'</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;CPU任务队列长度：&quot;</span><span class="token variable">$cpu_task_length</span>
 
<span class="token comment">#4、获取内存信息</span>
<span class="token comment"># 获取物理内存总量</span>
<span class="token assign-left variable">mem_total</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">free</span> <span class="token operator">|</span> <span class="token function">grep</span> Mem <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $2}'</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;物理内存总量：&quot;</span><span class="token variable">$mem_total</span>
 
<span class="token comment"># 获取操作系统已使用内存总量</span>
<span class="token assign-left variable">mem_sys_used</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">free</span> <span class="token operator">|</span> <span class="token function">grep</span> Mem <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $3}'</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;已使用内存总量(操作系统)：&quot;</span><span class="token variable">$mem_sys_used</span>
 
<span class="token comment"># 获取操作系统未使用内存总量</span>
<span class="token assign-left variable">mem_sys_free</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">free</span> <span class="token operator">|</span> <span class="token function">grep</span> Mem <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $4}'</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;剩余内存总量(操作系统)：&quot;</span><span class="token variable">$mem_sys_free</span>
 
<span class="token comment"># 获取应用程序已使用的内存总量</span>
<span class="token assign-left variable">mem_user_used</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">free</span> <span class="token operator">|</span> <span class="token function">sed</span> -n 3p <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $3}'</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;已使用内存总量(应用程序)：&quot;</span><span class="token variable">$mem_user_used</span>
 
<span class="token comment"># 获取应用程序未使用内存总量</span>
<span class="token assign-left variable">mem_user_free</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">free</span> <span class="token operator">|</span> <span class="token function">sed</span> -n 3p <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $4}'</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;剩余内存总量(应用程序)：&quot;</span><span class="token variable">$mem_user_free</span>
 
 
<span class="token comment"># 获取交换分区总大小</span>
<span class="token assign-left variable">mem_swap_total</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">free</span> <span class="token operator">|</span> <span class="token function">grep</span> Swap <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $2}'</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;交换分区总大小：&quot;</span><span class="token variable">$mem_swap_total</span>
 
<span class="token comment"># 获取已使用交换分区大小</span>
<span class="token assign-left variable">mem_swap_used</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">free</span> <span class="token operator">|</span> <span class="token function">grep</span> Swap <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $3}'</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;已使用交换分区大小：&quot;</span><span class="token variable">$mem_swap_used</span>
 
<span class="token comment"># 获取剩余交换分区大小</span>
<span class="token assign-left variable">mem_swap_free</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">free</span> <span class="token operator">|</span> <span class="token function">grep</span> Swap <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $4}'</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;剩余交换分区大小：&quot;</span><span class="token variable">$mem_swap_free</span>
 

<span class="token comment">#5、获取磁盘I/O统计信息</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;指定设备(/dev/sda)的统计信息&quot;</span>
<span class="token comment"># 每秒向设备发起的读请求次数</span>
<span class="token assign-left variable">disk_sda_rs</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>iostat -kx <span class="token operator">|</span> <span class="token function">grep</span> sda<span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $4}'</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;每秒向设备发起的读请求次数：&quot;</span><span class="token variable">$disk_sda_rs</span>
 
<span class="token comment"># 每秒向设备发起的写请求次数</span>
<span class="token assign-left variable">disk_sda_ws</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>iostat -kx <span class="token operator">|</span> <span class="token function">grep</span> sda<span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $5}'</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;每秒向设备发起的写请求次数：&quot;</span><span class="token variable">$disk_sda_ws</span>
 
<span class="token comment"># 向设备发起的I/O请求队列长度平均值</span>
<span class="token assign-left variable">disk_sda_avgqu_sz</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>iostat -kx <span class="token operator">|</span> <span class="token function">grep</span> sda<span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $9}'</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;向设备发起的I/O请求队列长度平均值&quot;</span><span class="token variable">$disk_sda_avgqu_sz</span>
 
<span class="token comment"># 每次向设备发起的I/O请求平均时间</span>
<span class="token assign-left variable">disk_sda_await</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>iostat -kx <span class="token operator">|</span> <span class="token function">grep</span> sda<span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $10}'</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;每次向设备发起的I/O请求平均时间：&quot;</span><span class="token variable">$disk_sda_await</span>
 
<span class="token comment"># 向设备发起的I/O服务时间均值</span>
<span class="token assign-left variable">disk_sda_svctm</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>iostat -kx <span class="token operator">|</span> <span class="token function">grep</span> sda<span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $11}'</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;向设备发起的I/O服务时间均值：&quot;</span><span class="token variable">$disk_sda_svctm</span>
 
<span class="token comment"># 向设备发起I/O请求的CPU时间百分占比</span>
<span class="token assign-left variable">disk_sda_util</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>iostat -kx <span class="token operator">|</span> <span class="token function">grep</span> sda<span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $12}'</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;向设备发起I/O请求的CPU时间百分占比：&quot;</span><span class="token variable">$disk_sda_util</span>
</code></pre></div><h3 id="运行结果"><a href="#运行结果" class="header-anchor">#</a> 运行结果</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>IP地址：172.17.0.1 <span class="token number">10.14</span>.2.214
cpu总核数：4
用户空间占用CPU百分比：4.2
内核空间占用CPU百分比：6.2
空闲CPU百分比：90.3
等待输入输出占CPU百分比：0.0
CPU中断次数：0
CPU上下文切换次数：1
CPU <span class="token number">15</span>分钟前到现在的负载平均值：1.70
CPU <span class="token number">5</span>分钟前到现在的负载平均值：2.71
CPU <span class="token number">1</span>分钟前到现在的负载平均值：average:
CPU任务队列长度：9
物理内存总量：24484376
已使用内存总量<span class="token punctuation">(</span>操作系统<span class="token punctuation">)</span>：13464504
剩余内存总量<span class="token punctuation">(</span>操作系统<span class="token punctuation">)</span>：8667688
已使用内存总量<span class="token punctuation">(</span>应用程序<span class="token punctuation">)</span>：4482500
剩余内存总量<span class="token punctuation">(</span>应用程序<span class="token punctuation">)</span>：3775032
交换分区总大小：8257532
已使用交换分区大小：4482500
剩余交换分区大小：3775032
指定设备<span class="token punctuation">(</span>/dev/sda<span class="token punctuation">)</span>的统计信息
sut.sh: line <span class="token number">91</span>: iostat: <span class="token builtin class-name">command</span> not found
每秒向设备发起的读请求次数：
sut.sh: line <span class="token number">95</span>: iostat: <span class="token builtin class-name">command</span> not found
每秒向设备发起的写请求次数：
sut.sh: line <span class="token number">99</span>: iostat: <span class="token builtin class-name">command</span> not found
向设备发起的I/O请求队列长度平均值
sut.sh: line <span class="token number">103</span>: iostat: <span class="token builtin class-name">command</span> not found
每次向设备发起的I/O请求平均时间：
sut.sh: line <span class="token number">107</span>: iostat: <span class="token builtin class-name">command</span> not found
向设备发起的I/O服务时间均值：
sut.sh: line <span class="token number">111</span>: iostat: <span class="token builtin class-name">command</span> not found
向设备发起I/O请求的CPU时间百分占比：
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/collection/languagec.html">
        C
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e2ddde8e.js" defer></script><script src="/assets/js/2.e74445cb.js" defer></script><script src="/assets/js/44.633f2e2b.js" defer></script>
  </body>
</html>
