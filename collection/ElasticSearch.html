<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>suting-Blogs</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="分布式博客云笔记">
    
    <link rel="preload" href="/assets/css/0.styles.386f4818.css" as="style"><link rel="preload" href="/assets/js/app.e2ddde8e.js" as="script"><link rel="preload" href="/assets/js/2.e74445cb.js" as="script"><link rel="preload" href="/assets/js/9.0b4be001.js" as="script"><link rel="prefetch" href="/assets/js/10.383382f2.js"><link rel="prefetch" href="/assets/js/11.79913c72.js"><link rel="prefetch" href="/assets/js/12.18e85316.js"><link rel="prefetch" href="/assets/js/13.78e33ed3.js"><link rel="prefetch" href="/assets/js/14.92269bd7.js"><link rel="prefetch" href="/assets/js/15.acc92b96.js"><link rel="prefetch" href="/assets/js/16.d8716382.js"><link rel="prefetch" href="/assets/js/17.fa6a1da4.js"><link rel="prefetch" href="/assets/js/18.c5024350.js"><link rel="prefetch" href="/assets/js/19.c3e206a7.js"><link rel="prefetch" href="/assets/js/20.6a00e35f.js"><link rel="prefetch" href="/assets/js/21.37c42ff6.js"><link rel="prefetch" href="/assets/js/22.abd1537f.js"><link rel="prefetch" href="/assets/js/23.6a041ee1.js"><link rel="prefetch" href="/assets/js/24.ab067683.js"><link rel="prefetch" href="/assets/js/25.a2de42cd.js"><link rel="prefetch" href="/assets/js/26.efa7caf3.js"><link rel="prefetch" href="/assets/js/27.1520ec85.js"><link rel="prefetch" href="/assets/js/28.be40ede1.js"><link rel="prefetch" href="/assets/js/29.5e42d4f2.js"><link rel="prefetch" href="/assets/js/3.fbcd2674.js"><link rel="prefetch" href="/assets/js/30.eae39a3c.js"><link rel="prefetch" href="/assets/js/31.63618f89.js"><link rel="prefetch" href="/assets/js/32.43b53339.js"><link rel="prefetch" href="/assets/js/33.931d2183.js"><link rel="prefetch" href="/assets/js/34.e7f37503.js"><link rel="prefetch" href="/assets/js/35.6302af3d.js"><link rel="prefetch" href="/assets/js/36.7aec4478.js"><link rel="prefetch" href="/assets/js/37.58461b9d.js"><link rel="prefetch" href="/assets/js/38.811a26e0.js"><link rel="prefetch" href="/assets/js/39.c3d07ac9.js"><link rel="prefetch" href="/assets/js/4.23df146b.js"><link rel="prefetch" href="/assets/js/40.b2c32317.js"><link rel="prefetch" href="/assets/js/41.368ac455.js"><link rel="prefetch" href="/assets/js/42.d68c9491.js"><link rel="prefetch" href="/assets/js/43.74a44b32.js"><link rel="prefetch" href="/assets/js/44.633f2e2b.js"><link rel="prefetch" href="/assets/js/45.eab6bf9b.js"><link rel="prefetch" href="/assets/js/46.3ddc24a7.js"><link rel="prefetch" href="/assets/js/5.4c581b45.js"><link rel="prefetch" href="/assets/js/6.27888615.js"><link rel="prefetch" href="/assets/js/7.e23a1d77.js"><link rel="prefetch" href="/assets/js/8.928501ca.js">
    <link rel="stylesheet" href="/assets/css/0.styles.386f4818.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">suting-Blogs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  home
</a></div><div class="nav-item"><a href="https://javaguide.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaGuide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://home.code-nav.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  code-nav
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/sutinghu153" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://mp.weixin.qq.com/mp/profile_ext?action=home&amp;__biz=MzA5ODI3NTI1OA==&amp;scene=124#wechat_redirect" target="_blank" rel="noopener noreferrer" class="nav-link external">
  WK听潮
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/itdevbooks/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  book
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  湘ICP备2021013988号-1
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  home
</a></div><div class="nav-item"><a href="https://javaguide.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaGuide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://home.code-nav.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  code-nav
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/sutinghu153" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://mp.weixin.qq.com/mp/profile_ext?action=home&amp;__biz=MzA5ODI3NTI1OA==&amp;scene=124#wechat_redirect" target="_blank" rel="noopener noreferrer" class="nav-link external">
  WK听潮
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/itdevbooks/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  book
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  湘ICP备2021013988号-1
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>个人项目</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>C/C++/Java/Golang</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux内核</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux系统开发</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux/Makefile/Shell</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>区块链</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机视觉</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>中间件</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/collection/mvn.html" class="sidebar-link">Maven</a></li><li><a href="/collection/kafka.html" class="sidebar-link">Kafka</a></li><li><a href="/collection/Rediss.html" class="sidebar-link">Redis</a></li><li><a href="/collection/ElasticSearch.html" aria-current="page" class="active sidebar-link">ElasticSearch</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/collection/ElasticSearch.html#_01-大数据" class="sidebar-link">01 大数据</a></li><li class="sidebar-sub-header"><a href="/collection/ElasticSearch.html#_02-关于es" class="sidebar-link">02 关于ES</a></li><li class="sidebar-sub-header"><a href="/collection/ElasticSearch.html#_03-安装es" class="sidebar-link">03 安装ES</a></li><li class="sidebar-sub-header"><a href="/collection/ElasticSearch.html#_04-交互es" class="sidebar-link">04 交互ES</a></li><li class="sidebar-sub-header"><a href="/collection/ElasticSearch.html#_05-es集群" class="sidebar-link">05 ES集群</a></li><li class="sidebar-sub-header"><a href="/collection/ElasticSearch.html#_06-数据out-in" class="sidebar-link">06 数据out/in</a></li><li class="sidebar-sub-header"><a href="/collection/ElasticSearch.html#_07-分布式的实现" class="sidebar-link">07  分布式的实现</a></li><li class="sidebar-sub-header"><a href="/collection/ElasticSearch.html#_08-用es搜索" class="sidebar-link">08 用ES搜索</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>常用命令</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>系统部署</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 align="center">Elastic-Search</h1> <p>关于ealstic-search的原理与实践。参考：<a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/distributed-cluster.html" target="_blank" rel="noopener noreferrer">集群内的原理 | Elasticsearch: 权威指南 | Elastic<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="_01-大数据"><a href="#_01-大数据" class="header-anchor">#</a> 01 大数据</h2> <h3 id="_1-1-大数据的检索问题"><a href="#_1-1-大数据的检索问题" class="header-anchor">#</a> 1-1 大数据的检索问题</h3> <p>当系统中的数据量达到上亿规模时，数据量会达到PB级别，这个时候，对于数据的架构设计，会存在相当多的问题，比如</p> <ol><li>哪个数据库更适合做大数据的处理</li> <li>大数据的单点故障如何解决</li> <li>数据的安全性怎么保证</li> <li>如何实现高效的大数据检索</li> <li>大数据下统计分析如何进行</li></ol> <h3 id="_1-2-大数据下的传统方案"><a href="#_1-2-大数据下的传统方案" class="header-anchor">#</a> 1-2 大数据下的传统方案</h3> <p><strong>关系型数据库</strong></p> <p>1）通过主从备份解决数据安全性问题；
2）通过数据库代理中间件心跳监测，解决单点故障问题；
3）通过代理中间件将查询语句分发到各个slave节点进行查询，并汇总结果</p> <p><strong>非关系型数据库</strong></p> <p>1）通过副本备份保证数据安全性；
2）通过节点竞选机制解决单点问题；
3）先从配置库检索分片信息，然后将请求分发到各个节点，最后由路由节点合并汇总结果</p> <h2 id="_02-关于es"><a href="#_02-关于es" class="header-anchor">#</a> 02 关于ES</h2> <p>elastic-search 是一个分布式、可拓展、实时的搜索与数据分析引擎。它可以从项目一开始就让我们能够获得数据的搜索、分析和探索的能力。</p> <p>能够满足的需求</p> <ul><li>全文检索</li> <li>结构化搜索</li> <li>分析</li> <li>...</li></ul> <h2 id="_03-安装es"><a href="#_03-安装es" class="header-anchor">#</a> 03 安装ES</h2> <h3 id="_3-1-下载和安装"><a href="#_3-1-下载和安装" class="header-anchor">#</a> 3-1 下载和安装</h3> <blockquote><p>下载 ES</p> <p><a href="https://www.elastic.co/cn/downloads/elasticsearch" target="_blank" rel="noopener noreferrer">Download Elasticsearch | Elastic<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <blockquote><p>安装 ES</p> <p>[Installation | Elasticsearch Reference <a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.6/_installation.html" target="_blank" rel="noopener noreferrer">5.6] | Elastic<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="_3-2-启动和检测"><a href="#_3-2-启动和检测" class="header-anchor">#</a> 3-2 启动和检测</h3> <h4 id="启动"><a href="#启动" class="header-anchor">#</a> 启动</h4> <div class="language- extra-class"><pre class="language-text"><code>cd elasticsearch-&lt;version&gt;
./bin/elasticsearch  【A】
</code></pre></div><blockquote><p>注： 如果想将Elasticsearch 作为一个守护进程在后台运行，则需要在后面添加参数 -d [A]</p> <p>如果是在windows上面运行elastic search，需要运行bin\elasticsearch.bat 而不是bin\elasticsearch</p></blockquote> <h4 id="检测"><a href="#检测" class="header-anchor">#</a> 检测</h4> <p>方案一</p> <div class="language- extra-class"><pre class="language-text"><code>执行 jps
检查是否存在 es进程：Elasticsearch
</code></pre></div><p>方案二</p> <div class="language- extra-class"><pre class="language-text"><code>curl 'http://localhost:9200/?pretty'
</code></pre></div><p>在另一个终端访问该地址，如果访问成功，会得到一个类似的结果</p> <div class="language- extra-class"><pre class="language-text"><code>{
  &quot;name&quot; : &quot;Tom Foster&quot;,
  &quot;cluster_name&quot; : &quot;elasticsearch&quot;,
  &quot;version&quot; : {
    &quot;number&quot; : &quot;2.1.0&quot;,
    &quot;build_hash&quot; : &quot;72cd1f1a3eee09505e036106146dc1949dc5dc87&quot;,
    &quot;build_timestamp&quot; : &quot;2015-11-18T22:40:03Z&quot;,
    &quot;build_snapshot&quot; : false,
    &quot;lucene_version&quot; : &quot;5.3.1&quot;
  },
  &quot;tagline&quot; : &quot;You Know, for Search&quot;
}
</code></pre></div><blockquote><p>以上json格式返回的结果表示当前已启动并运行了一个ElasticSearch节点</p> <p>单个节点可以作为一个运行中的ES实例，而一个集群是一组拥有相同 <code>cluster_name</code> 的节点，集群中的节点可以一起工作并共享数据，还提供容错与可伸缩性。</p></blockquote> <h2 id="_04-交互es"><a href="#_04-交互es" class="header-anchor">#</a> 04 交互ES</h2> <h3 id="_4-1-客户端"><a href="#_4-1-客户端" class="header-anchor">#</a> 4-1 客户端</h3> <p>Java 与ES的交互可以使用ES内置的两个客户端。</p> <ul><li><p>节点客户端（Node client）</p> <p>节点客户端作为一个非数据节点加入到本地集群中。节点客户端本身不保存任何数据，但是它知道数据在集群的哪个节点中，并且可以把请求转发到准确的节点。</p></li> <li><p>传输客户端（Transport client）</p> <p>轻量级的传输客户端可以将请求发送到远程集群，本身不加入集群，但是可以将请求转发到集群的节点上。</p></li></ul> <blockquote><p>两个Java客户端都是通过  9300 端口并使用 ES 的原生传输协议和集群交互。集群中的节点通过 9300 彼此通信，如果该端口没有打开，节点将无法形成一个集群。</p></blockquote> <h3 id="_4-2-访问"><a href="#_4-2-访问" class="header-anchor">#</a> 4-2 访问</h3> <ol><li><p>Java之外的其它语言都可以使用 RESTful API 通过端口9200 和 ES 进行通信。</p></li> <li><p>使用<code>curl</code> 命令进行交互</p> <ol><li><p>交互的路径</p> <div class="language- extra-class"><pre class="language-text"><code>curl -X&lt;VERB&gt; '&lt;PROTOCOL&gt;://&lt;HOST&gt;:&lt;PORT&gt;/&lt;PATH&gt;?&lt;QUERY_STRING&gt;' -d '&lt;BODY&gt;'
</code></pre></div></li> <li><p>参数的说明</p> <table><thead><tr><th style="text-align:center;">部件</th> <th style="text-align:center;">解释</th></tr></thead> <tbody><tr><td style="text-align:center;">VERB</td> <td style="text-align:center;">HTTP方法或GET POST PUT HEAD DELETE 等谓词</td></tr> <tr><td style="text-align:center;">PROTOCOL</td> <td style="text-align:center;">http或https</td></tr> <tr><td style="text-align:center;">HOST</td> <td style="text-align:center;">ES集群中的主机名</td></tr> <tr><td style="text-align:center;">PORT</td> <td style="text-align:center;">端口号，默认 9200</td></tr> <tr><td style="text-align:center;">PATH</td> <td style="text-align:center;">API的终端路径</td></tr> <tr><td style="text-align:center;">QUERY_STRING</td> <td style="text-align:center;">任意可选的查询字符串</td></tr> <tr><td style="text-align:center;">BODY</td> <td style="text-align:center;">一个 JSON 格式的请求体 (如果请求需要的话)</td></tr></tbody></table></li> <li><p>例子</p> <div class="language- extra-class"><pre class="language-text"><code>curl -XGET 'http://localhost:9200/_count?pretty' -d '
{
    &quot;query&quot;: {
        &quot;match_all&quot;: {}
    }
}
'
</code></pre></div></li> <li><p>返回值</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;count&quot; : 0,
    &quot;_shards&quot; : {
        &quot;total&quot; : 5,
        &quot;successful&quot; : 5,
        &quot;failed&quot; : 0
    }
}
</code></pre></div></li></ol></li></ol> <h3 id="_4-3-面向文档"><a href="#_4-3-面向文档" class="header-anchor">#</a> 4-3 面向文档</h3> <p>在应用程序中很少只是一个简单的键值对的列表。通常，它们拥有更复杂的数据结构，可能包括日期、地理信息、其它对象或者数组等。</p> <p>ElasticSearch 是面向文档的，意味着它存储整个对象或文档。elastic search不仅存储文档，而且索引每个文档的内容，使之可以被检索。</p> <p>在ES中，我们对文档进行索引、检索、排序和过滤而不是对行列数据进行处理。这是一种完全不同的思考数据的方式，也是ES能支持复杂全文检索的原因。</p> <p>ES对文档的序列化格式是JSON。</p> <h3 id="_4-4-关于索引"><a href="#_4-4-关于索引" class="header-anchor">#</a> 4-4 关于索引</h3> <p>存储数据到ES的行为叫索引，因此索引有两个方面的含义</p> <ol><li><p><strong>名词</strong>——文档</p> <p>一个索引类似于传统关系数据库中的一个库，是一个存储关系型文档的地方。</p></li> <li><p><strong>动词</strong>——保存数据</p> <p>索引一个文档就是存储一个文档到一个索引（名词）中以便被检索和查询。</p></li> <li><p><strong>倒排索引</strong>——检索的方式</p> <p>关系型数据库通过增加一个索引，比如B-tree索引到指定的列上，以便提升数据检索速度。</p> <p>ES中的每一个文档的每一个属性都是被索引的（有一个倒排索引）和可搜索的，没有倒排索引的属性是不能被搜索到的。</p></li></ol> <h3 id="_4-5-管理文档"><a href="#_4-5-管理文档" class="header-anchor">#</a> 4-5 管理文档</h3> <h4 id="索引文档"><a href="#索引文档" class="header-anchor">#</a> 索引文档</h4> <div class="language-json extra-class"><pre class="language-json"><code>PUT /megacorp/employee/<span class="token number">1</span>
<span class="token punctuation">{</span>
    <span class="token property">&quot;first_name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;last_name&quot;</span> <span class="token operator">:</span>  <span class="token string">&quot;Smith&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;age&quot;</span> <span class="token operator">:</span>        <span class="token number">25</span><span class="token punctuation">,</span>
    <span class="token property">&quot;about&quot;</span> <span class="token operator">:</span>      <span class="token string">&quot;I love to go rock climbing&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;interests&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;sports&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;music&quot;</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>**<code>megacorp</code>**索引名称</p> <p>**<code>employee</code>**类型名称</p> <p>**<code>1</code>**特定雇员的ID</p></blockquote> <h4 id="检索文档"><a href="#检索文档" class="header-anchor">#</a> 检索文档</h4> <div class="language-json extra-class"><pre class="language-json"><code>GET /megacorp/employee/<span class="token number">1</span>
</code></pre></div><blockquote><p>将 HTTP 命令由 <code>PUT</code> 改为 <code>GET</code> 可以用来检索文档，同样的，可以使用 <code>DELETE</code> 命令来删除文档，以及使用 <code>HEAD</code> 指令来检查文档是否存在。如果想更新已存在的文档，只需再次 <code>PUT</code> 。</p></blockquote> <p>返回结构如下</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;_index&quot;</span> <span class="token operator">:</span>   <span class="token string">&quot;megacorp&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;_type&quot;</span> <span class="token operator">:</span>    <span class="token string">&quot;employee&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;_id&quot;</span> <span class="token operator">:</span>      <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;_version&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token property">&quot;found&quot;</span> <span class="token operator">:</span>    <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;_source&quot;</span> <span class="token operator">:</span>  <span class="token punctuation">{</span>
      <span class="token property">&quot;first_name&quot;</span> <span class="token operator">:</span>  <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;last_name&quot;</span> <span class="token operator">:</span>   <span class="token string">&quot;Smith&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;age&quot;</span> <span class="token operator">:</span>         <span class="token number">25</span><span class="token punctuation">,</span>
      <span class="token property">&quot;about&quot;</span> <span class="token operator">:</span>       <span class="token string">&quot;I love to go rock climbing&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;interests&quot;</span><span class="token operator">:</span>  <span class="token punctuation">[</span> <span class="token string">&quot;sports&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;music&quot;</span> <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><table><thead><tr><th style="text-align:center;">key</th> <th style="text-align:center;">value</th></tr></thead> <tbody><tr><td style="text-align:center;">_index</td> <td style="text-align:center;">索引名</td></tr> <tr><td style="text-align:center;">_type</td> <td style="text-align:center;">类型名称</td></tr> <tr><td style="text-align:center;">_id</td> <td style="text-align:center;">编号</td></tr> <tr><td style="text-align:center;">_version</td> <td style="text-align:center;">索引版本</td></tr> <tr><td style="text-align:center;">found</td> <td style="text-align:center;">是否查到</td></tr> <tr><td style="text-align:center;">_source</td> <td style="text-align:center;">查询结果</td></tr></tbody></table> <h4 id="轻量搜索"><a href="#轻量搜索" class="header-anchor">#</a> 轻量搜索</h4> <p><strong>基础搜索</strong>: 搜索位于索引megacorp中的类型为employee的所有雇员的信息</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /megacorp/employee/_search
</code></pre></div><p>​			<code>_search</code> 默认返回10条信息</p> <p><strong>关键字段搜索</strong>：搜索指定姓名的雇员信息</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /megacorp/employee/_search?q=last_name<span class="token operator">:</span>Smith
</code></pre></div><h4 id="表达式搜索"><a href="#表达式搜索" class="header-anchor">#</a> 表达式搜索</h4> <div class="language-json extra-class"><pre class="language-json"><code>GET /megacorp/employee/_search
<span class="token punctuation">{</span>
    <span class="token property">&quot;query&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;match&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;last_name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;Smith&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="表达式搜索2"><a href="#表达式搜索2" class="header-anchor">#</a> 表达式搜索2</h4> <div class="language-json extra-class"><pre class="language-json"><code>GET /megacorp/employee/_search
<span class="token punctuation">{</span>
    <span class="token property">&quot;query&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;bool&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;must&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;match&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;last_name&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;smith&quot;</span> 
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token property">&quot;filter&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token property">&quot;range&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
                    <span class="token property">&quot;age&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;gt&quot;</span> <span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span> 
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>以上是查询姓名 last_name 为smith，年龄大于30</p></blockquote> <h4 id="全文搜索"><a href="#全文搜索" class="header-anchor">#</a> 全文搜索</h4> <div class="language-json extra-class"><pre class="language-json"><code>GET /megacorp/employee/_search
<span class="token punctuation">{</span>
    <span class="token property">&quot;query&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;match&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;about&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;rock climbing&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>使用 match 查询在’about‘属性 上搜索某个参数，得到匹配的文档如下</p></blockquote> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
   ...
   <span class="token property">&quot;hits&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;total&quot;</span><span class="token operator">:</span>      <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token property">&quot;max_score&quot;</span><span class="token operator">:</span>  <span class="token number">0.16273327</span><span class="token punctuation">,</span>
      <span class="token property">&quot;hits&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
         <span class="token punctuation">{</span>
            ...
            <span class="token property">&quot;_score&quot;</span><span class="token operator">:</span>         <span class="token number">0.16273327</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;_source&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
               <span class="token property">&quot;first_name&quot;</span><span class="token operator">:</span>  <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span>
               <span class="token property">&quot;last_name&quot;</span><span class="token operator">:</span>   <span class="token string">&quot;Smith&quot;</span><span class="token punctuation">,</span>
               <span class="token property">&quot;age&quot;</span><span class="token operator">:</span>         <span class="token number">25</span><span class="token punctuation">,</span>
               <span class="token property">&quot;about&quot;</span><span class="token operator">:</span>       <span class="token string">&quot;I love to go rock climbing&quot;</span><span class="token punctuation">,</span>
               <span class="token property">&quot;interests&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;sports&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;music&quot;</span> <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span><span class="token punctuation">,</span>
         <span class="token punctuation">{</span>
            ...
            <span class="token property">&quot;_score&quot;</span><span class="token operator">:</span>         <span class="token number">0.016878016</span><span class="token punctuation">,</span> 
            <span class="token property">&quot;_source&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
               <span class="token property">&quot;first_name&quot;</span><span class="token operator">:</span>  <span class="token string">&quot;Jane&quot;</span><span class="token punctuation">,</span>
               <span class="token property">&quot;last_name&quot;</span><span class="token operator">:</span>   <span class="token string">&quot;Smith&quot;</span><span class="token punctuation">,</span>
               <span class="token property">&quot;age&quot;</span><span class="token operator">:</span>         <span class="token number">32</span><span class="token punctuation">,</span>
               <span class="token property">&quot;about&quot;</span><span class="token operator">:</span>       <span class="token string">&quot;I like to collect rock albums&quot;</span><span class="token punctuation">,</span>
               <span class="token property">&quot;interests&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">&quot;music&quot;</span> <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>ES 会默认按照相关性得分排序，即每个文档跟查询的匹配程度</p> <p>&quot;_score&quot;:        得分</p></blockquote> <h4 id="短语搜索"><a href="#短语搜索" class="header-anchor">#</a> 短语搜索</h4> <p>为此对 <code>match</code> 查询稍作调整，使用一个叫做 <code>match_phrase</code> 的查询：</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /megacorp/employee/_search
<span class="token punctuation">{</span>
    <span class="token property">&quot;query&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;match_phrase&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;about&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;rock climbing&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="高亮搜索"><a href="#高亮搜索" class="header-anchor">#</a> 高亮搜索</h4> <p>许多应用都倾向于在每个搜索结果中 <em>高亮</em> 部分文本片段，以便让用户知道为何该文档符合查询条件。在 Elasticsearch 中检索出高亮片段也很容易。</p> <p>再次执行前面的查询，并增加一个新的 <code>highlight</code> 参数：</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /megacorp/employee/_search
<span class="token punctuation">{</span>
    <span class="token property">&quot;query&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;match_phrase&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;about&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;rock climbing&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;highlight&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;fields&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token property">&quot;about&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="聚合分析"><a href="#聚合分析" class="header-anchor">#</a> 聚合分析</h4> <blockquote><p>终于到了最后一个业务需求：支持管理者对员工目录做分析。 Elasticsearch 有一个功能叫聚合（aggregations），允许我们基于数据生成一些精细的分析结果。聚合与 SQL 中的 <code>GROUP BY</code> 类似但更强大。</p></blockquote> <p>如挖掘员工中最受欢迎的兴趣爱好</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /megacorp/employee/_search
<span class="token punctuation">{</span>
  <span class="token property">&quot;aggs&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;all_interests&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;terms&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;interests&quot;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-6-分布式特性"><a href="#_4-6-分布式特性" class="header-anchor">#</a> 4-6 分布式特性</h3> <p>ES 可以横向扩展至数百、数千的服务器节点，同时可以处理PB级的数据。</p> <ul><li>分配文档到不同的容器或分片中，文档可以存储在一个或多个节点中</li> <li>按集群节点来均衡分配这些分片，从而对索引和搜索过程进行负载均衡</li> <li>复制每个分片以支持数据冗余，从而防止硬件故障导致的数据丢失</li> <li>将集群中任一节点的请求路由到存有相关数据的节点</li> <li>集群扩容时无缝整合新节点，重新分配分片以便从离群节点恢复</li></ul> <h2 id="_05-es集群"><a href="#_05-es集群" class="header-anchor">#</a> 05 ES集群</h2> <p>ElasticSearch的主旨是随时可用和按需扩容，而扩容可以通过改用性能更好（垂直扩容、纵向扩容）或数量更多的服务器来（水平扩容、横向扩容）实现。</p> <p><strong>真正的扩容是水平扩容，因为硬件的限制。即为集群添加更多的节点，将负载压力和稳定性分散到这些节点中。</strong></p> <h3 id="_5-1-空集群"><a href="#_5-1-空集群" class="header-anchor">#</a> 5-1 空集群</h3> <p>如果我们启动了一个单独的节点，里面不包含任何的数据和索引，那我们的集群就是一个空集群。</p> <p><code>空集群</code> 包含空内容节点的集群</p> <p><code>节点</code> 一个运行中的Elasticsearch实例称为一个节点。</p> <p><code>cluster.name</code>  集群是由一个或多个拥有相同 <code>cluster.name</code> 配置的节点组成，它们共同承担数据和负载的压力。</p> <blockquote><p>当一个节点被选举为主节点时，它将负责管理集群范围内的所有变更、例如增加、删除索引，或者增加、删除节点等。</p> <p>主节点并不需要涉及到文档级别的变更和搜索等操作，所以当集群只拥有一个主节点的情况下，流量增加时并不会影响性能。</p> <p>任何节点都可以成为主节点。</p> <p>用户可以将请求发送到集群中的任何节点，包括主节点。</p> <p>每个节点都能知道任意文档所处的位置，并且能够将我们的请求直接转发到存储所需文档的节点。</p></blockquote> <h3 id="_5-2-集群健康"><a href="#_5-2-集群健康" class="header-anchor">#</a> 5-2 集群健康</h3> <p>Elasticsearch 的集群监控信息中包含了许多的统计数据，其中最为重要的一项就是 <em>集群健康</em> ， 它在 <code>status</code> 字段中展示为 <code>green</code> 、 <code>yellow</code> 或者 <code>red</code> 。</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /_cluster/health
</code></pre></div><table><thead><tr><th style="text-align:center;">status</th> <th style="text-align:center;">description</th></tr></thead> <tbody><tr><td style="text-align:center;">green</td> <td style="text-align:center;">所有主分片和副分片都正常运行</td></tr> <tr><td style="text-align:center;">yellow</td> <td style="text-align:center;">所有主分片都正常运行，但不是所有副分片都正常运行</td></tr> <tr><td style="text-align:center;">red</td> <td style="text-align:center;">有主分片没能正常运行</td></tr></tbody></table> <h3 id="_5-3-添加索引"><a href="#_5-3-添加索引" class="header-anchor">#</a> 5-3 添加索引</h3> <p>索引实际上是指向一个或多个物理分片的逻辑命名空间。</p> <p>一个分片是一个底层的工作单元，仅保存全部数据的一部分。其中，一个分片是一个Lucene的实例，以及它本身就是一个完整的搜索引擎。文档被存储和索引到分片内，但是应用程序是直接与索引而不是分片进行交互。</p> <p>elastic search是利用分片将数据分发到集群内各处的。分片是数据的容器，文档保存在分片内，分片又被分配到集群内的各个节点里。当集群的规模扩大或缩小时，ES会自动在各节点中迁移分片，使数据仍然均匀分布在集群里。</p> <p>一个分片可以是主分片或者副本分片，索引内任意一个文档都归属于一个主分片，所以主分片的数目决定索引能够保存的最大数据量。</p> <div class="language-json extra-class"><pre class="language-json"><code>PUT /blogs
<span class="token punctuation">{</span>
   <span class="token property">&quot;settings&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;number_of_shards&quot;</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      <span class="token property">&quot;number_of_replicas&quot;</span> <span class="token operator">:</span> <span class="token number">1</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>添加索引示例</p> <p>number_of_shards ： 分片数</p> <p>number_of_replicas：副本数</p></blockquote> <h3 id="_5-4-故障转移"><a href="#_5-4-故障转移" class="header-anchor">#</a> 5-4 故障转移</h3> <p>当集群只有一个节点在运行时，意味着会有一个单点故障问题——没有冗余。当我们启动第二个节点时，可防止数据丢失。</p> <p>多个节点可以共享目录，因此只需要让所有的节点都又相同的<code>cluster.name</code>配置，就会自动发现集群并加入。</p> <h3 id="_5-5-水平扩容"><a href="#_5-5-水平扩容" class="header-anchor">#</a> 5-5 水平扩容</h3> <p>主分片的数目在索引创建时就已经确定了下来。</p> <p>这个数目定义了这个索引能够 <em>存储</em> 的最大数据量。（实际大小取决于你的数据、硬件和使用场景。） 但是，读操作——搜索和返回数据——可以同时被主分片 <em>或</em> 副本分片所处理，所以当你拥有越多的副本分片时，也将拥有越高的吞吐量。</p> <p>在运行中的集群上是可以动态调整副本分片数目的，我们可以按需伸缩集群。让我们把副本数从默认的 <code>1</code> 增加到 <code>2</code> ：</p> <div class="language-json extra-class"><pre class="language-json"><code>PUT /blogs/_settings
<span class="token punctuation">{</span>
   <span class="token property">&quot;number_of_replicas&quot;</span> <span class="token operator">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_5-6-应对故障"><a href="#_5-6-应对故障" class="header-anchor">#</a> 5-6 应对故障</h3> <p>当集群的主节点被干掉时，会自动推举产生新的主节点。</p> <p>而被干掉的节点的数据会被转移到正常的节点。</p> <h2 id="_06-数据out-in"><a href="#_06-数据out-in" class="header-anchor">#</a> 06 数据out/in</h2> <h3 id="_6-1-json-文档"><a href="#_6-1-json-文档" class="header-anchor">#</a> 6-1 Json 文档</h3> <p>将数据按对象的方式来存储。专注于使用数据，而不是根据电子表格对数据建模。有效的提高了使用对象的灵活性。</p> <p>对象，基于特定语言的内存的数据结构。为了通过网络发送或存储它。我们需要将它表示成某种标准的格式。</p> <p>JSON 是一种以人可读的文本表示对象的方法。它已经变成NoSQL世界交换数据的标准。</p> <p>当一个对象被序列化成为JSON，它被称为一个JSON文档。</p> <p>ES是分布式的文档存储，它能存储和检索复杂的数据结构，实时的将数据序列化为JSON文档。JSON文档中的数据能够被集群中的任意节点检索。</p> <p>在ES中，每个字段的所有数据都是默认被索引的，即每个字段都有快速检索设置的专用倒排索引。</p> <h3 id="_6-2-es文档"><a href="#_6-2-es文档" class="header-anchor">#</a> 6-2 ES文档</h3> <p>大多数应用中，多数实体或对象可以被序列化为包含键值对的JSON对象。</p> <p>一个键可以是一个字段或字段的名称。</p> <p>一个值可以是字符串、数字、另一个对象...</p> <ul><li>对象：仅仅是类似于hash、hashmap、字典或关联数组的JSON对象，对象中可以嵌套其它对象。</li> <li>文档：指最顶层的根对象，这个对象被序列化成了JSON格式并被存储在ES中，指定了唯一的标识。</li></ul> <h4 id="文档元数据"><a href="#文档元数据" class="header-anchor">#</a> 文档元数据</h4> <p>一个文档不仅仅包含它的数据，它也包含元数据——有关文档的信息。</p> <table><thead><tr><th style="text-align:center;">元数据</th> <th style="text-align:center;">描述</th></tr></thead> <tbody><tr><td style="text-align:center;">_index</td> <td style="text-align:center;">文档存放在哪里</td></tr> <tr><td style="text-align:center;">_type</td> <td style="text-align:center;">文档表示的对象类别</td></tr> <tr><td style="text-align:center;">_id</td> <td style="text-align:center;">文档唯一标记</td></tr></tbody></table> <ul><li>_index：数据被存储和索引在分片中，而一个索引仅仅是逻辑上的命名空间，这个空间由一个或多个分片组合而成。对于应用程序而言，只需要知道。</li> <li>_type：用对象的类别为文档进行二次分类，标记具体的对象</li> <li>_id：是一个字符串，表示文档的位置索引</li></ul> <blockquote><p>_index,_type,_id 三者加在一起可以唯一确定elasticsearch中一个文档的具体实例。</p></blockquote> <h4 id="其它元数据"><a href="#其它元数据" class="header-anchor">#</a> 其它元数据</h4> <p>除了以上的三个元数据外，文档中还有很多描述文档属性、ES属性的元数据。</p> <h3 id="_6-3-索引一个文档"><a href="#_6-3-索引一个文档" class="header-anchor">#</a> 6-3 索引一个文档</h3> <p>我们在进行数据处理的过程中，需要对某个具体的文档进行处理，因此我们需要对文档进行索引。</p> <h4 id="使用自定义id索引"><a href="#使用自定义id索引" class="header-anchor">#</a> 使用自定义ID索引</h4> <div class="language-json extra-class"><pre class="language-json"><code>PUT /<span class="token punctuation">{</span>index<span class="token punctuation">}</span>/<span class="token punctuation">{</span>type<span class="token punctuation">}</span>/<span class="token punctuation">{</span>id<span class="token punctuation">}</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;field&quot;</span><span class="token operator">:</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span>
  ...
<span class="token punctuation">}</span>
</code></pre></div><div class="language-json extra-class"><pre class="language-json"><code>PUT /website/blog/<span class="token number">123</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;My first blog entry&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;text&quot;</span><span class="token operator">:</span>  <span class="token string">&quot;Just trying this out...&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;date&quot;</span><span class="token operator">:</span>  <span class="token string">&quot;2014/01/01&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="使用es定义id索引"><a href="#使用es定义id索引" class="header-anchor">#</a> 使用ES定义ID索引</h4> <div class="language- extra-class"><pre class="language-text"><code>POST /{index}/{type}/
{
  &quot;field&quot;: &quot;value&quot;,
  ...
}
</code></pre></div><div class="language-json extra-class"><pre class="language-json"><code>POST /website/blog/
<span class="token punctuation">{</span>
  <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;My second blog entry&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;text&quot;</span><span class="token operator">:</span>  <span class="token string">&quot;Still trying this out...&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;date&quot;</span><span class="token operator">:</span>  <span class="token string">&quot;2014/01/01&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_6-4-取回一个文档"><a href="#_6-4-取回一个文档" class="header-anchor">#</a> 6-4 取回一个文档</h3> <h4 id="简单取回"><a href="#简单取回" class="header-anchor">#</a> 简单取回</h4> <p>从ES中取回一个文档时，需要使用同样的 index、type、id，其中的区别只在于HTTP的不同。</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /website/blog/<span class="token number">123</span>?pretty
</code></pre></div><p><code>GET</code> 请求的响应体包括 <code>{&quot;found&quot;: true}</code> ，这证实了文档已经被找到。 如果我们请求一个不存在的文档，我们仍旧会得到一个 JSON 响应体，但是 <code>found</code> 将会是 <code>false</code> 。 此外， HTTP 响应码将会是 <code>404 Not Found</code> ，而不是 <code>200 OK</code> 。</p> <h4 id="响应式取回"><a href="#响应式取回" class="header-anchor">#</a> 响应式取回</h4> <p>我们可以通过传递 <code>-i</code> 参数给 <code>curl</code> 命令，该参数能够显示响应的头部：</p> <div class="language-json extra-class"><pre class="language-json"><code>curl -i -XGET http<span class="token operator">:</span><span class="token comment">//localhost:9200/website/blog/124?pretty</span>
</code></pre></div><h4 id="根据需要取回"><a href="#根据需要取回" class="header-anchor">#</a> 根据需要取回</h4> <p>默认情况下， <code>GET</code> 请求会返回整个文档，这个文档正如存储在 <code>_source</code> 字段中的一样。但是也许你只对其中的 <code>title</code> 字段感兴趣。单个字段能用 <code>_source</code> 参数请求得到，多个字段也能使用逗号分隔的列表来指定。</p> <div class="language-json extra-class"><pre class="language-json"><code>GET /website/blog/<span class="token number">123</span>?_source=title<span class="token punctuation">,</span>text
</code></pre></div><h3 id="_6-5-检查文档状态"><a href="#_6-5-检查文档状态" class="header-anchor">#</a> 6-5 检查文档状态</h3> <p>如果只想检查一个文档是否存在--根本不想关心内容—那么用 <code>HEAD</code> 方法来代替 <code>GET</code> 方法。 <code>HEAD</code> 请求没有返回体，只返回一个 HTTP 请求报头：</p> <div class="language-json extra-class"><pre class="language-json"><code>curl -i -XHEAD http<span class="token operator">:</span><span class="token comment">//localhost:9200/website/blog/123</span>
</code></pre></div><p>存在则返回</p> <div class="language-json extra-class"><pre class="language-json"><code>HTTP/<span class="token number">1.1</span> <span class="token number">200</span> OK
Content-Type<span class="token operator">:</span> text/plain; charset=UTF<span class="token number">-8</span>
Content-Length<span class="token operator">:</span> <span class="token number">0</span>
</code></pre></div><p>否则</p> <div class="language-json extra-class"><pre class="language-json"><code>HTTP/<span class="token number">1.1</span> <span class="token number">404</span> Not Found
Content-Type<span class="token operator">:</span> text/plain; charset=UTF<span class="token number">-8</span>
Content-Length<span class="token operator">:</span> <span class="token number">0</span>
</code></pre></div><h3 id="_6-6-更新一个文档"><a href="#_6-6-更新一个文档" class="header-anchor">#</a> 6-6 更新一个文档</h3> <p>在内部，Elasticsearch 已将旧文档标记为已删除，并增加一个全新的文档。 尽管你不能再对旧版本的文档进行访问，但它并不会立即消失。当继续索引更多的数据，Elasticsearch 会在后台清理这些已删除文档。</p> <p>Elasticsearch 按前述完全相同方式执行以下过程：</p> <ol><li>从旧文档构建 JSON</li> <li>更改该 JSON</li> <li>删除旧文档</li> <li>索引一个新文档</li></ol> <p>不同的地方是对于更新的文档，响应体的某个字段将会改变</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;_index&quot;</span> <span class="token operator">:</span>   <span class="token string">&quot;website&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;_type&quot;</span> <span class="token operator">:</span>    <span class="token string">&quot;blog&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;_id&quot;</span> <span class="token operator">:</span>      <span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;_version&quot;</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token string">&quot;created&quot;</span><span class="token operator">:</span>   <span class="token boolean">false</span> 
<span class="token punctuation">}</span>
</code></pre></div><p><code>created</code> 标志设置成 <code>false</code> ，是因为相同的索引、类型和 ID 的文档已经存在。</p> <h3 id="_6-7-创建一个文档"><a href="#_6-7-创建一个文档" class="header-anchor">#</a> 6-7 创建一个文档</h3> <h4 id="直接创建一个文档"><a href="#直接创建一个文档" class="header-anchor">#</a> 直接创建一个文档</h4> <p>_index<code>、</code>_type<code>和</code>_id<code>的组合可以唯一标识一个文档。所以，确保创建一个新文档的最简单办法是，使用索引请求的</code>POST<code>形式让 Elasticsearch 自动生成唯一</code>_id</p> <div class="language- extra-class"><pre class="language-text"><code>POST /website/blog/
{ ... }
</code></pre></div><h4 id="创建不存在的文档"><a href="#创建不存在的文档" class="header-anchor">#</a> 创建不存在的文档</h4> <p>只有当一个文档不存在时才创建</p> <div class="language-json extra-class"><pre class="language-json"><code>方法一：
PUT /website/blog/<span class="token number">123</span>?op_type=create
<span class="token punctuation">{</span> ... <span class="token punctuation">}</span>
方法二：
PUT /website/blog/<span class="token number">123</span>/_create
<span class="token punctuation">{</span> ... <span class="token punctuation">}</span>
</code></pre></div><h3 id="_6-8-删除一个文档"><a href="#_6-8-删除一个文档" class="header-anchor">#</a> 6-8 删除一个文档</h3> <div class="language-sense extra-class"><pre class="language-text"><code>DELETE /website/blog/123
</code></pre></div><h3 id="_6-9-批量操作文档"><a href="#_6-9-批量操作文档" class="header-anchor">#</a> 6-9 批量操作文档</h3> <p>bulk API 操作方式</p> <div class="language- extra-class"><pre class="language-text"><code>{ action: { metadata }}\n
{ request body        }\n
{ action: { metadata }}\n
{ request body        }\n
...
</code></pre></div><p><code>action/metadata</code> 行指定 <em>哪一个文档</em> 做 <em>什么操作</em> 。</p> <p><code>action</code> 必须是以下选项之一:</p> <ul><li><p><strong><code>create</code></strong></p> <p>如果文档不存在，那么就创建它。详情请见 <a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/create-doc.html" target="_blank" rel="noopener noreferrer">创建新文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></li> <li><p><strong><code>index</code></strong></p> <p>创建一个新文档或者替换一个现有的文档。详情请见 <a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/index-doc.html" target="_blank" rel="noopener noreferrer">索引文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/update-doc.html" target="_blank" rel="noopener noreferrer">更新整个文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></li> <li><p><strong><code>update</code></strong></p> <p>部分更新一个文档。详情请见 <a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/partial-updates.html" target="_blank" rel="noopener noreferrer">文档的部分更新<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></li> <li><p><strong><code>delete</code></strong></p> <p>删除一个文档。详情请见 <a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/delete-doc.html" target="_blank" rel="noopener noreferrer">删除文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></li></ul> <p><code>metadata</code> 应该指定被索引、创建、更新或者删除的文档的 <code>_index</code> 、 <code>_type</code> 和 <code>_id</code> 。</p> <p>删除一个文档</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span> <span class="token property">&quot;delete&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;_index&quot;</span><span class="token operator">:</span> <span class="token string">&quot;website&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;blog&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;123&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre></div><p>组合操作</p> <div class="language-json extra-class"><pre class="language-json"><code>POST /_bulk
<span class="token punctuation">{</span> <span class="token property">&quot;delete&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;_index&quot;</span><span class="token operator">:</span> <span class="token string">&quot;website&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;blog&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;123&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span> 
<span class="token punctuation">{</span> <span class="token property">&quot;create&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;_index&quot;</span><span class="token operator">:</span> <span class="token string">&quot;website&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;blog&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;123&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token property">&quot;title&quot;</span><span class="token operator">:</span>    <span class="token string">&quot;My first blog post&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token property">&quot;index&quot;</span><span class="token operator">:</span>  <span class="token punctuation">{</span> <span class="token property">&quot;_index&quot;</span><span class="token operator">:</span> <span class="token string">&quot;website&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;blog&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token property">&quot;title&quot;</span><span class="token operator">:</span>    <span class="token string">&quot;My second blog post&quot;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token property">&quot;update&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">&quot;_index&quot;</span><span class="token operator">:</span> <span class="token string">&quot;website&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;_type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;blog&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> <span class="token string">&quot;123&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;_retry_on_conflict&quot;</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token property">&quot;doc&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">&quot;title&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;My updated blog post&quot;</span><span class="token punctuation">}</span> <span class="token punctuation">}</span> 
</code></pre></div><h2 id="_07-分布式的实现"><a href="#_07-分布式的实现" class="header-anchor">#</a> 07  分布式的实现</h2> <h3 id="分布式文档存储"><a href="#分布式文档存储" class="header-anchor">#</a> 分布式文档存储</h3> <p>ES中有很多分布式的概念，如文件分布到集群、集群包含多个节点、节点又有分片，而这些是分布式的基础，所以了解文档的分布是很有必要的。</p> <h3 id="es如何记录文档存储的位置"><a href="#es如何记录文档存储的位置" class="header-anchor">#</a> ES如何记录文档存储的位置</h3> <p>当索引一个文档的时候，文档会被存储到一个分片中。</p> <p><strong>所以有个问题：创建文档的时候，如何确定文档被存储在哪个分片中？</strong></p> <div class="language- extra-class"><pre class="language-text"><code>shard = hash(routing) % number_of_primary_shards
</code></pre></div><p>根据以上公式进行的。</p> <ol><li>routing 一个可变值，默认是文档的_id，通过hash函数生成一个数字，然后数字再除以number_of_primary_shards</li> <li>number_of_primary_shards 主分片的数量</li> <li>为什么我们要在创建索引的时候就确定好主分片的数量 并且永远不会改变这个数量：因为如果数量变化了，那么所有之前路由的值都会无效，文档也再也找不到了。</li></ol> <h3 id="es如何使得所有分片共享文档"><a href="#es如何使得所有分片共享文档" class="header-anchor">#</a> ES如何使得所有分片共享文档</h3> <p><strong>轮查所有的分片，有利于扩展扩容、负载均衡</strong></p> <h2 id="_08-用es搜索"><a href="#_08-用es搜索" class="header-anchor">#</a> 08 用ES搜索</h2> <p><strong>映射（Mapping）</strong></p> <p>描述数据在每个字段内如何存储</p> <p><strong>分析（Analysis）</strong></p> <p>全文是如何处理使之可以被搜索的</p> <p><strong>领域特定查询语言（Query DSL）</strong></p> <p>Elasticsearch 中强大灵活的查询语言</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/collection/Rediss.html" class="prev">
        Redis
      </a></span> <span class="next"><a href="/collection/math.html">
        算法分析
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e2ddde8e.js" defer></script><script src="/assets/js/2.e74445cb.js" defer></script><script src="/assets/js/9.0b4be001.js" defer></script>
  </body>
</html>
