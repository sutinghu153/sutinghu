<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Linux网络编程 | suting-Blogs</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="分布式博客云笔记">
    
    <link rel="preload" href="/assets/css/0.styles.386f4818.css" as="style"><link rel="preload" href="/assets/js/app.e2ddde8e.js" as="script"><link rel="preload" href="/assets/js/2.e74445cb.js" as="script"><link rel="preload" href="/assets/js/35.6302af3d.js" as="script"><link rel="prefetch" href="/assets/js/10.383382f2.js"><link rel="prefetch" href="/assets/js/11.79913c72.js"><link rel="prefetch" href="/assets/js/12.18e85316.js"><link rel="prefetch" href="/assets/js/13.78e33ed3.js"><link rel="prefetch" href="/assets/js/14.92269bd7.js"><link rel="prefetch" href="/assets/js/15.acc92b96.js"><link rel="prefetch" href="/assets/js/16.d8716382.js"><link rel="prefetch" href="/assets/js/17.fa6a1da4.js"><link rel="prefetch" href="/assets/js/18.c5024350.js"><link rel="prefetch" href="/assets/js/19.c3e206a7.js"><link rel="prefetch" href="/assets/js/20.6a00e35f.js"><link rel="prefetch" href="/assets/js/21.37c42ff6.js"><link rel="prefetch" href="/assets/js/22.abd1537f.js"><link rel="prefetch" href="/assets/js/23.6a041ee1.js"><link rel="prefetch" href="/assets/js/24.ab067683.js"><link rel="prefetch" href="/assets/js/25.a2de42cd.js"><link rel="prefetch" href="/assets/js/26.efa7caf3.js"><link rel="prefetch" href="/assets/js/27.1520ec85.js"><link rel="prefetch" href="/assets/js/28.be40ede1.js"><link rel="prefetch" href="/assets/js/29.5e42d4f2.js"><link rel="prefetch" href="/assets/js/3.fbcd2674.js"><link rel="prefetch" href="/assets/js/30.eae39a3c.js"><link rel="prefetch" href="/assets/js/31.63618f89.js"><link rel="prefetch" href="/assets/js/32.43b53339.js"><link rel="prefetch" href="/assets/js/33.931d2183.js"><link rel="prefetch" href="/assets/js/34.e7f37503.js"><link rel="prefetch" href="/assets/js/36.7aec4478.js"><link rel="prefetch" href="/assets/js/37.58461b9d.js"><link rel="prefetch" href="/assets/js/38.811a26e0.js"><link rel="prefetch" href="/assets/js/39.c3d07ac9.js"><link rel="prefetch" href="/assets/js/4.23df146b.js"><link rel="prefetch" href="/assets/js/40.b2c32317.js"><link rel="prefetch" href="/assets/js/41.368ac455.js"><link rel="prefetch" href="/assets/js/42.d68c9491.js"><link rel="prefetch" href="/assets/js/43.74a44b32.js"><link rel="prefetch" href="/assets/js/44.633f2e2b.js"><link rel="prefetch" href="/assets/js/45.eab6bf9b.js"><link rel="prefetch" href="/assets/js/46.3ddc24a7.js"><link rel="prefetch" href="/assets/js/5.4c581b45.js"><link rel="prefetch" href="/assets/js/6.27888615.js"><link rel="prefetch" href="/assets/js/7.e23a1d77.js"><link rel="prefetch" href="/assets/js/8.928501ca.js"><link rel="prefetch" href="/assets/js/9.0b4be001.js">
    <link rel="stylesheet" href="/assets/css/0.styles.386f4818.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">suting-Blogs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  home
</a></div><div class="nav-item"><a href="https://javaguide.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaGuide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://home.code-nav.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  code-nav
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/sutinghu153" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://mp.weixin.qq.com/mp/profile_ext?action=home&amp;__biz=MzA5ODI3NTI1OA==&amp;scene=124#wechat_redirect" target="_blank" rel="noopener noreferrer" class="nav-link external">
  WK听潮
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/itdevbooks/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  book
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  湘ICP备2021013988号-1
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  home
</a></div><div class="nav-item"><a href="https://javaguide.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaGuide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://home.code-nav.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  code-nav
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/sutinghu153" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://mp.weixin.qq.com/mp/profile_ext?action=home&amp;__biz=MzA5ODI3NTI1OA==&amp;scene=124#wechat_redirect" target="_blank" rel="noopener noreferrer" class="nav-link external">
  WK听潮
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/itdevbooks/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  book
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  湘ICP备2021013988号-1
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>个人项目</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>C/C++/Java/Golang</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux内核</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Linux系统开发</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/collection/xtkf.html" class="sidebar-link">IO-系统开发</a></li><li><a href="/collection/jcjtx.html" class="sidebar-link">进程间通信</a></li><li><a href="/collection/dxctx.html" class="sidebar-link">Linux多线程</a></li><li><a href="/collection/netcode.html" aria-current="page" class="active sidebar-link">网络编程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/collection/netcode.html#网络传输模型" class="sidebar-link">网络传输模型</a></li><li class="sidebar-sub-header"><a href="/collection/netcode.html#osi模型" class="sidebar-link">OSI模型</a></li><li class="sidebar-sub-header"><a href="/collection/netcode.html#发现网络拓扑" class="sidebar-link">发现网络拓扑</a></li><li class="sidebar-sub-header"><a href="/collection/netcode.html#传输层有哪些协议" class="sidebar-link">传输层有哪些协议？</a></li><li class="sidebar-sub-header"><a href="/collection/netcode.html#tcp-ip协议族" class="sidebar-link">TCP/IP协议族</a></li><li class="sidebar-sub-header"><a href="/collection/netcode.html#tcp三次握手创建连接" class="sidebar-link">TCP三次握手创建连接</a></li><li class="sidebar-sub-header"><a href="/collection/netcode.html#tcp-协议选项" class="sidebar-link">TCP 协议选项</a></li><li class="sidebar-sub-header"><a href="/collection/netcode.html#tcp四次挥手终止连接" class="sidebar-link">TCP四次挥手终止连接</a></li><li class="sidebar-sub-header"><a href="/collection/netcode.html#tcp-状态转换图" class="sidebar-link">TCP 状态转换图</a></li><li class="sidebar-sub-header"><a href="/collection/netcode.html#什么是端口号" class="sidebar-link">什么是端口号</a></li><li class="sidebar-sub-header"><a href="/collection/netcode.html#什么是套接字" class="sidebar-link">什么是套接字</a></li><li class="sidebar-sub-header"><a href="/collection/netcode.html#并发服务器如何处理请求" class="sidebar-link">并发服务器如何处理请求</a></li><li class="sidebar-sub-header"><a href="/collection/netcode.html#套接字缓冲区及限制" class="sidebar-link">套接字缓冲区及限制</a></li><li class="sidebar-sub-header"><a href="/collection/netcode.html#tcp-缓冲区及数据输出" class="sidebar-link">TCP 缓冲区及数据输出</a></li><li class="sidebar-sub-header"><a href="/collection/netcode.html#udp缓冲区及数据输出" class="sidebar-link">UDP缓冲区及数据输出</a></li><li class="sidebar-sub-header"><a href="/collection/netcode.html#套接字的地址结构" class="sidebar-link">套接字的地址结构</a></li><li class="sidebar-sub-header"><a href="/collection/netcode.html#进程和内核的结果传递" class="sidebar-link">进程和内核的结果传递</a></li><li class="sidebar-sub-header"><a href="/collection/netcode.html#网络中的基本系统调用函数" class="sidebar-link">网络中的基本系统调用函数</a></li><li class="sidebar-sub-header"><a href="/collection/netcode.html#io模型-阻塞、非阻塞、多路复用、异步" class="sidebar-link">IO模型-阻塞、非阻塞、多路复用、异步</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux/Makefile/Shell</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>区块链</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机视觉</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中间件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>常用命令</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>系统部署</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="linux网络编程"><a href="#linux网络编程" class="header-anchor">#</a> Linux网络编程</h1> <blockquote><p><a href="https://mp.weixin.qq.com/s/4EqKdrqVmD92HsFkpaOOiA" target="_blank" rel="noopener noreferrer">网络协议与套接字编程 <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h3 id="互联网链接"><a href="#互联网链接" class="header-anchor">#</a> 互联网链接</h3> <p>客户端-服务器端建立通信链接，可以建立多对一的链接。</p> <p>端与端之间进行通信。</p> <ol><li>网络采用的是分而治之的策略设计，将网络的功能划分为不同的模块，以分层的形式有机的组合在一起</li> <li>每层实现不同的功能，内部实现方法对外部其它层次来说是透明的，每层向上提供服务，同时使用下层提供的服务</li> <li>网络体系结构指网络的层次结构和每层使用协议的集合</li> <li>体系结构中有两类是最基本的
<ol><li>OSI</li> <li>TCP/IP</li></ol></li> <li>通信五要素
<ol><li>本地地址</li> <li>本地端口</li> <li>远程地址</li> <li>远程端口</li></ol></li></ol> <h3 id="网络拓扑"><a href="#网络拓扑" class="header-anchor">#</a> 网络拓扑</h3> <h4 id="局域网"><a href="#局域网" class="header-anchor">#</a> 局域网</h4> <img src="/imags/1652425466883.png" alt="652425466883"> <h4 id="广域网拓扑"><a href="#广域网拓扑" class="header-anchor">#</a> 广域网拓扑</h4> <img src="/imags/1652425595535.png" alt="1652425595535"> <h2 id="网络传输模型"><a href="#网络传输模型" class="header-anchor">#</a> 网络传输模型</h2> <h3 id="网络模型分层"><a href="#网络模型分层" class="header-anchor">#</a> 网络模型分层</h3> <ul><li><p>OSI七层模型：物、数、网、传、会、表、应</p></li> <li><p>TCP/IP 4层模型：网（链路层/网络接口层）、网、传、应</p></li> <li><ul><li>应用层：http、ftp、nfs、ssh、Telnet。。。</li> <li>传输层：TCP、UDP</li> <li>网络层：IP、ICMP、IGMP</li> <li>链路层：以太网帧协议、ARP</li></ul></li></ul> <h4 id="iso模型模块化分层"><a href="#iso模型模块化分层" class="header-anchor">#</a> ISO模型模块化分层</h4> <img src="/imags/qgcsc.png" alt="qgcsc"> <h4 id="iso7层模型的功能"><a href="#iso7层模型的功能" class="header-anchor">#</a> ISO7层模型的功能</h4> <img src="/imags/tcp_3.png" alt="tcp_3"> <h4 id="tcp-ip-各层的传输协议"><a href="#tcp-ip-各层的传输协议" class="header-anchor">#</a> TCP/IP 各层的传输协议</h4> <img src="/imags/tcp.png" alt="tcp"> <h4 id="tcp-ip-端到端的过程"><a href="#tcp-ip-端到端的过程" class="header-anchor">#</a> TCP/IP 端到端的过程</h4> <img src="/imags/tcp_4.png" alt="tcp_4"> <h4 id="数据的封装和传递过程"><a href="#数据的封装和传递过程" class="header-anchor">#</a> 数据的封装和传递过程</h4> <img src="/imags/tcp_5.png" alt="tcp_5"> <h4 id="什么是tcp"><a href="#什么是tcp" class="header-anchor">#</a> 什么是TCP</h4> <ul><li>传输控制协议</li> <li>向用户进程提高可靠的全双工字节流</li> <li>数据可靠性要求高、传输量大的需求</li></ul> <h4 id="什么是udp"><a href="#什么是udp" class="header-anchor">#</a> 什么是UDP</h4> <p>User DataGram Protocol 用户数据报协议</p> <h5 id="特点"><a href="#特点" class="header-anchor">#</a> 特点</h5> <ul><li>用户数据报协议</li> <li>无连接的不可靠的</li> <li>协议用于实时性高、对可靠性要求低</li></ul> <h4 id="进行通信"><a href="#进行通信" class="header-anchor">#</a> 进行通信</h4> <ul><li><p>c-s模型</p> <ul><li><p>client server模型</p> <table><thead><tr><th>server</th> <th>解释</th> <th>client</th> <th>解释</th></tr></thead> <tbody><tr><td>socket</td> <td>链接网络</td> <td>socket</td> <td>链接网络</td></tr> <tr><td>bind</td> <td>绑定请求</td> <td>connect</td> <td>发送请求</td></tr> <tr><td>recvfrom</td> <td>阻塞数据（处理）</td> <td>sendto</td> <td>发送数据</td></tr> <tr><td>accept</td> <td>接收请求</td> <td></td> <td></td></tr> <tr><td>sendto</td> <td>返回数据（服务应答）</td> <td>recvfrom</td> <td>服务应答接收</td></tr> <tr><td>close</td> <td>关闭</td> <td>close</td> <td>关闭</td></tr></tbody></table></li></ul></li> <li><p>socket</p> <ul><li>函数</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;sys/types.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;sys/socket.h&quot;</span></span>

<span class="token keyword">int</span> <span class="token function">socket</span><span class="token punctuation">(</span><span class="token keyword">int</span> domain<span class="token punctuation">,</span><span class="token keyword">int</span> type<span class="token punctuation">,</span> <span class="token keyword">int</span> protocol<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>功能
<ul><li>创建套接字</li></ul></li> <li>参数
<ul><li>int domain 地址族 网际协议版本 IPV4/IPV6
<ul><li>AF_INEF    IPV4</li> <li>AF_INET6  IPV6</li></ul></li> <li>int type  套接字类型
<ul><li>SOCK_STREAM 字节流 ，流式套接字 TCP</li> <li>SOCK_DGRAM 数据报流，数据报套接字 UDP</li></ul></li> <li>int protocol 协议编号
<ul><li>0 表示默认，系统根据参数2 自动查找协议号</li></ul></li> <li>返回值
<ul><li>成功返回 套接字的描述符，用来定义唯一的标识</li> <li>失败返回 -1</li></ul></li></ul></li> <li>test</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;stdlib.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;stdio.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;sys/types.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;sys/socket.h&quot;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> sockfd <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>AF_INET<span class="token punctuation">,</span>SOCK_DGRAM<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>sockfd<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;socket&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;succeed sockfd = %d\n&quot;</span><span class="token punctuation">,</span>sockfd<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>connect() (bind)</p> <ul><li><p>函数</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">int</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">int</span> sock<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">sockaddr</span> <span class="token operator">*</span>serv_addr<span class="token punctuation">,</span> <span class="token class-name">socklen_t</span> addrlen<span class="token punctuation">)</span><span class="token punctuation">;</span>  
</code></pre></div></li> <li><p>参数</p> <ul><li><p>sock socket文件描述符</p></li> <li><p>addr sockaddr结构体变量指针</p> <ul><li><p>结构体</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span><span class="token punctuation">{</span>
    <span class="token class-name">sa_family_t</span>     sin_family<span class="token punctuation">;</span>   <span class="token comment">//地址族（Address Family），也就是地址类型</span>
    <span class="token class-name">uint16_t</span>        sin_port<span class="token punctuation">;</span>     <span class="token comment">//16位的端口号</span>
    <span class="token keyword">struct</span> <span class="token class-name">in_addr</span>  sin_addr<span class="token punctuation">;</span>     <span class="token comment">//32位IP地址</span>
    <span class="token keyword">char</span>            sin_zero<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//不使用，一般用0填充</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></li> <li><p>addrlen  结构体变量的大小</p></li></ul></li> <li><p>返回值</p> <ul><li>成功 1</li> <li>失败 -1</li></ul></li></ul></li></ul> <h2 id="osi模型"><a href="#osi模型" class="header-anchor">#</a> OSI模型</h2> <p>ISO（International Organization for Standardization）即国际标准化组织为计算机的通信开发系统互连设计的模型，即OSI模型，全称计算机通信开发系统互联模型（open systems interconnection）。</p> <p>该模型采用分层方式进行架构，架构如下：</p> <h3 id="osi网络架构"><a href="#osi网络架构" class="header-anchor">#</a> OSI网络架构</h3> <img src="/imags/1654069971926.png" alt="1654069971926"> <h3 id="osi层次介绍"><a href="#osi层次介绍" class="header-anchor">#</a> OSI层次介绍</h3> <table><thead><tr><th style="text-align:center;">层级</th> <th style="text-align:center;">名称</th> <th style="text-align:center;">描述</th></tr></thead> <tbody><tr><td style="text-align:center;">1</td> <td style="text-align:center;">物理层</td> <td style="text-align:center;">进行网络链接的硬件</td></tr> <tr><td style="text-align:center;">2</td> <td style="text-align:center;">数据链路层</td> <td style="text-align:center;">转发网络请求的硬件</td></tr> <tr><td style="text-align:center;">3</td> <td style="text-align:center;">网络层</td> <td style="text-align:center;">IPv4&amp;IPv6协议处理进行路由和寻址，决定数据的游走路径</td></tr> <tr><td style="text-align:center;">4</td> <td style="text-align:center;">传输层</td> <td style="text-align:center;">TCP/UDP 确定两个主机间进程通信的网络传输服务</td></tr> <tr><td style="text-align:center;">5</td> <td style="text-align:center;">会话层</td> <td style="text-align:center;">进行主机进程间的通信的会话管理</td></tr> <tr><td style="text-align:center;">6</td> <td style="text-align:center;">表示层</td> <td style="text-align:center;">数据处理层（编码、解码、压缩、解压）</td></tr> <tr><td style="text-align:center;">7</td> <td style="text-align:center;">应用层</td> <td style="text-align:center;">为计算机用户提供服务</td></tr></tbody></table> <h3 id="套接字为什么只提供了上三层进入传输层的接口"><a href="#套接字为什么只提供了上三层进入传输层的接口" class="header-anchor">#</a> 套接字为什么只提供了上三层进入传输层的接口</h3> <ol><li>顶上三层处理具体的网络应用（FTP,HTTP)的所有细节，对通信细节了解很少，底下四层对具体网络应用了解很少，在处理通信的细节。</li> <li>因为Linux系统分为用户空间和内核空间，内核空间通常已经封装了下四层的操作，而对于大多数的应用程序，均是通过用户进程实现，因此API被构建在了传输层和会话层。</li></ol> <h2 id="发现网络拓扑"><a href="#发现网络拓扑" class="header-anchor">#</a> 发现网络拓扑</h2> <p><code>netstat -i</code>  提供网络接口的信息</p> <div class="language-shell extra-class"><pre class="language-shell"><code>Kernel Interface table
// 
Iface             MTU    RX-OK RX-ERR RX-DRP RX-OVR    TX-OK TX-ERR TX-DRP TX-OVR Flg

docker0          <span class="token number">1500</span>        <span class="token number">0</span>      <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0</span>             <span class="token number">3</span>      <span class="token number">0</span>      <span class="token number">0</span>      <span class="token number">0</span> BMU
// 以太网接口
eth0             <span class="token number">1500</span> <span class="token number">272441368</span>      <span class="token number">0</span> <span class="token number">143712</span> <span class="token number">0</span>      <span class="token number">28478500</span>      <span class="token number">0</span>      <span class="token number">0</span>      <span class="token number">0</span> BMRU
// 环回接口
lo              <span class="token number">65536</span> <span class="token number">5281851012</span>      <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0</span>      <span class="token number">5281851012</span>      <span class="token number">0</span>      <span class="token number">0</span>      <span class="token number">0</span> LRU
</code></pre></div><p><code>netstat -r</code>   展示路由表</p> <div class="language-shell extra-class"><pre class="language-shell"><code>Kernel IP routing table
Destination     Gateway         Genmask         Flags   MSS Window  irtt Iface

default         gateway         <span class="token number">0.0</span>.0.0         UG        <span class="token number">0</span> <span class="token number">0</span>          <span class="token number">0</span> eth0
<span class="token number">10.14</span>.2.0       <span class="token number">0.0</span>.0.0         <span class="token number">255.255</span>.255.0   U         <span class="token number">0</span> <span class="token number">0</span>          <span class="token number">0</span> eth0
<span class="token number">172.17</span>.0.0      <span class="token number">0.0</span>.0.0         <span class="token number">255.255</span>.0.0     U         <span class="token number">0</span> <span class="token number">0</span>          <span class="token number">0</span> docker0
</code></pre></div><p><code>ifconfig+网络接口名称</code> 获取接口详细信息</p> <p><code>ifconfig eth0</code></p> <div class="language-shell extra-class"><pre class="language-shell"><code>eth0: <span class="token assign-left variable">flags</span><span class="token operator">=</span><span class="token number">416</span><span class="token operator"><span class="token file-descriptor important">3</span>&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class="token operator">&gt;</span>  mtu <span class="token number">1500</span>
        inet <span class="token number">10.14</span>.2.214  netmask <span class="token number">255.255</span>.255.0  broadcast <span class="token number">10.14</span>.2.255
        inet6 fe80::2a6e:d4ff:fe8a:2eda  prefixlen <span class="token number">64</span>  scopeid 0x2<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>link<span class="token operator">&gt;</span>
        ether <span class="token number">28</span>:6e:d4:8a:2e:da  txqueuelen <span class="token number">1000</span>  <span class="token punctuation">(</span>Ethernet<span class="token punctuation">)</span>
        RX packets <span class="token number">272451869</span>  bytes <span class="token number">168057163491</span> <span class="token punctuation">(</span><span class="token number">156.5</span> GiB<span class="token punctuation">)</span>
        RX errors <span class="token number">0</span>  dropped <span class="token number">143727</span>  overruns <span class="token number">0</span>  frame <span class="token number">0</span>
        TX packets <span class="token number">28478593</span>  bytes <span class="token number">16473596749</span> <span class="token punctuation">(</span><span class="token number">15.3</span> GiB<span class="token punctuation">)</span>
        TX errors <span class="token number">0</span>  dropped <span class="token number">0</span> overruns <span class="token number">0</span>  carrier <span class="token number">0</span>  collisions <span class="token number">0</span>
</code></pre></div><p><code>ping</code>  查看本地网络中IP地址的命令</p> <h2 id="传输层有哪些协议"><a href="#传输层有哪些协议" class="header-anchor">#</a> 传输层有哪些协议？</h2> <p>传输层包括TCP、UDP、SCTP协议。其中，TCP和UDP是常见的，用途广泛的协议，但是SCTP是一个比较新的协议，这些网络传输协议都通过网络层IP协议进行转发。</p> <ul><li>UDP协议
<ul><li>是简单的不可靠的数据报协议</li></ul></li> <li>TCP协议
<ul><li>复杂的可靠的字节流协议</li></ul></li> <li>SCTP协议
<ul><li>SCTP协议与TCP协议相似，是一个可靠的传输协议，并且提供消息边界</li></ul></li></ul> <h2 id="tcp-ip协议族"><a href="#tcp-ip协议族" class="header-anchor">#</a> TCP/IP协议族</h2> <h3 id="关于协议族"><a href="#关于协议族" class="header-anchor">#</a> 关于协议族</h3> <ul><li><p>协议是指网络通信过程中的约定或协议，通信的双方必须遵守一样的协议才能建立连接。</p></li> <li><p>TCP/IP 模型包含了 TCP、IP、UDP、Telnet、FTP、SMTP 等上百个互为关联的协议，其中 TCP 和 IP 是最常用的两种底层协议，所以把它们统称为“TCP/IP 协议族”。</p></li></ul> <h3 id="协议族架构图"><a href="#协议族架构图" class="header-anchor">#</a> 协议族架构图</h3> <img src="/imags/1654072807990.png" alt="1654072807990"> <h3 id="各协议作用"><a href="#各协议作用" class="header-anchor">#</a> 各协议作用</h3> <table><thead><tr><th>协议</th> <th>协议名称</th> <th>协议作用</th></tr></thead> <tbody><tr><td>IPv4</td> <td>网际协议4版本</td> <td>使用32位地址，为TCP UDP SCTP ICMP IGMP提供分组递送服务</td></tr> <tr><td>IPv6</td> <td>网际协议6版本</td> <td>使用128位地址 为 TCP UDP SCTP ICMPv6提供分组递送服务</td></tr> <tr><td>TCP</td> <td>传输控制协议</td> <td>TCP是一个面向链接的协议，为用户进程提供可靠的全双工字节流</td></tr> <tr><td>UDP</td> <td>用户数据报协议</td> <td>UDP是无连接协议，不能保证最终到达它们的目的地</td></tr> <tr><td>SCTP</td> <td>流控制传输协议</td> <td>提供可靠的全双工关联的面向连接的协议</td></tr> <tr><td>ICMP</td> <td>网际控制消息协议</td> <td>处理在路由器和主机之间流通的错误和控制消息</td></tr> <tr><td>IGMP</td> <td>网际组管理协议</td> <td>用于多播</td></tr> <tr><td>ARP</td> <td>地址解析协议</td> <td>把一个IPv4地址映射为硬件地址</td></tr> <tr><td>RARP</td> <td>反向地址解析协议</td> <td>把硬件地址映射为IPv4</td></tr> <tr><td>BPE</td> <td>BSD分组过滤</td> <td>提供对数据链路层的访问能力</td></tr></tbody></table> <h3 id="关于udp协议"><a href="#关于udp协议" class="header-anchor">#</a> 关于UDP协议</h3> <ul><li>属于传输层协议</li> <li>用户进程使用UDP套接字写入一个消息，该消息随后被封装到一个UDP数据报，进而被封装到一个IP数据报</li> <li>UDP 不保证数据报送到的目的地，也不保证数据报的先后顺序</li> <li>UDP提供无连接的服务，因为UDP和服务器之间没有长期存在的关系</li></ul> <h3 id="关于tcp协议"><a href="#关于tcp协议" class="header-anchor">#</a> 关于TCP协议</h3> <ul><li>TCP提供了可靠的连接和数据发送服务</li> <li>其首先与某个服务器建立连接，再跨连接与服务器交换数据，最后终止该连接</li> <li>TCP并不能提供可靠的端对端的数据传输服务，但是内部建立了一套可靠的数据传递机制</li> <li>TCP协议传输数据是有序的、基于字节流的，这是因为它为每个数据报提供了一个顺序位</li> <li>TCP通过通告窗口实现流量控制，以实现通信的可靠性</li> <li>TCP是双全工模式，即能够同时进行信号数据的双向传输</li></ul> <h3 id="关于sctp协议"><a href="#关于sctp协议" class="header-anchor">#</a> 关于SCTP协议</h3> <ul><li>SCTP协议在客户端和服务端之间提供关联关系，并像TCP那样为应用进程提供可靠性、排序、流量控制及双全工的数据传送</li> <li>SCTP是面向消息的传送，它提供各个记录的按序递送服务</li> <li>能够在建立的端点间提供多个流，每个流各自可靠的按序递送消息，消息消失不会阻塞其它消息的投递</li></ul> <h2 id="tcp三次握手创建连接"><a href="#tcp三次握手创建连接" class="header-anchor">#</a> TCP三次握手创建连接</h2> <p>我们在建立TCP的连接时，必须做好以下准备</p> <ul><li>服务器必须准备好接受外来的连接，即能够被动打开</li> <li>客户通过调用connect发起主动打开，客户机将发送一个SYN分节连接中发送的数据的初始序列号</li> <li>服务器必须确认客户机的消息即SYN分节，本身将会发送ACK确认信号，同时发送一个SYN，将返回初始序列号</li> <li>客户机再次确认服务器SYN</li></ul> <img src="/imags/1654075001924.png" alt="1654075001924"> <h2 id="tcp-协议选项"><a href="#tcp-协议选项" class="header-anchor">#</a> TCP 协议选项</h2> <p>TCP选项中的参数及含有</p> <img src="/imags/1654075158460.png" alt="1654075158460"> <h3 id="mss最大段大小选项"><a href="#mss最大段大小选项" class="header-anchor">#</a> MSS最大段大小选项</h3> <p>最大段大小是指TCP协议所允许的从对方接收到的最大报文段，最大段大小只记录TCP数据的字节数而不包括其他相关的TCP与IP头部。当建立一条TCP连接时, 通信的每一方都要在<strong>SYN</strong>报文段的<strong>MSS</strong>选项中说明自已允许的最大段大小。</p> <h3 id="sack选择确认选项"><a href="#sack选择确认选项" class="header-anchor">#</a> SACK选择确认选项</h3> <p>TCP “<strong>选择确认</strong>”（<strong>SACK</strong>）能在报文段丢失或被接收方遗漏时更好地进行重传工作。通过接收SYN (或者SYN+ACK)报文段中的“允许选择确认”选项, TCP通信方会了解到自身具有了发布SACK信息的能力。当接收到乱序的数据时, 它就能提供一个SACK选项来描述这些乱序的数据, 从而帮助对方有效地进行重传。</p> <h3 id="wsopt窗口缩放选项"><a href="#wsopt窗口缩放选项" class="header-anchor">#</a> WSOPT窗口缩放选项</h3> <p>窗口缩放选项(表示为WSCALE或WSOPT)能够有效地将TCP窗口广告字段的范围从16位增加至30位。TCP头部不需要改变窗口广告字段的大小, 仍然维持16位的数值。</p> <h3 id="uto用户超时选项"><a href="#uto用户超时选项" class="header-anchor">#</a> UTO用户超时选项</h3> <p>用户超时(<strong>UTO</strong>)选项是一个相对较新的TCP的功能。用户超时数值(也被称为<strong>USER_TIMEOUT</strong>)指明了TCP发送者在确认对方未能成功接收数据之前愿意等待该数据ACK确认的时间。</p> <h3 id="认证选项"><a href="#认证选项" class="header-anchor">#</a> 认证选项</h3> <p>TCP设置了一个选项用于增强连接的安全性，当发送数据时, TCP会根据共享的密钥生成一个通信密钥, 并根据一个特殊的加密算法计算散列值。接收者装配有相同的<strong>密钥</strong>, 同样也能够生成<strong>通信密钥</strong>。</p> <blockquote><p><a href="https://blog.csdn.net/weixin_42923076/article/details/120087088" target="_blank" rel="noopener noreferrer">(63条消息) TCP的连接与断开_zkccpro的博客-CSDN博客_tcp连接断开<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h2 id="tcp四次挥手终止连接"><a href="#tcp四次挥手终止连接" class="header-anchor">#</a> TCP四次挥手终止连接</h2> <ul><li>应用进程首先调用close，执行主动关闭，TCP发送一个FIN分节，表示数据发送完毕</li> <li>接收到FIN的对端执行被动关闭，这个FIN由TCP确认，它的接收也作为一个文件结束符传递给接收端应用程序</li> <li>接收该文件结束符的应用将调用close关闭套接字，并发送FIN</li> <li>接收这个最终FIN的原发送端TCP确认这个FIN</li></ul> <img src="/imags/1654079255729.png" alt="1654079255729"> <h2 id="tcp-状态转换图"><a href="#tcp-状态转换图" class="header-anchor">#</a> TCP 状态转换图</h2> <img src="/imags/1654130489526.png" alt="1654130489526"> <h2 id="什么是端口号"><a href="#什么是端口号" class="header-anchor">#</a> 什么是端口号</h2> <p>端口号的主要作用是表示一台计算机中的特定进程所提供的服务。网络中的计算机是通过IP地址来代表其身份的，它只能表示某台特定的计算机，但是一台计算机上可以同时提供很多个服务，如数据库服务、FTP服务、Web服务等，我们就通过端口号来区别相同计算机所提供的这些不同的服务，如常见的端口号21表示的是FTP服务，端口号23表示的是Telnet服务端口号25指的是SMTP服务等。</p> <ul><li>TCP/UDP是16位字节的端口，因此端口号16位整数</li> <li>端口号小于256定义为常用端口，服务器一般通过常用端口识别</li> <li>端口号只需保证端口号在本机唯一就可以了</li> <li>客户端端口号因为存在时间太短被称为临时端口</li> <li>大多数TCP/IP分配了1024-49151之间的端口，即用户端口</li> <li>私用端口是49152-65535</li> <li>任何TCP/IP实现的提供服务都用1-1023之间的端口</li></ul> <img src="/imags/1654131805283.png" alt="1654131805283"> <p>如图，为LANA和BSD规范的不同的端口使用，目前以LANA为主</p> <h2 id="什么是套接字"><a href="#什么是套接字" class="header-anchor">#</a> 什么是套接字</h2> <h3 id="套接字"><a href="#套接字" class="header-anchor">#</a> 套接字</h3> <p>标识每个端点的两个值（IP和端口号）通常称为一个套接字。</p> <h3 id="套接字对"><a href="#套接字对" class="header-anchor">#</a> 套接字对</h3> <p>套接字对，则标识为连接两个端点的四元组：本地IP地址、本地TCP端口号、外地IP地址、外地TCP端口号。</p> <h3 id="套接字的记号"><a href="#套接字的记号" class="header-anchor">#</a> 套接字的记号</h3> <p><code>{*:21,*:*}</code></p> <p><code>*</code> 是通配符，用来指定本地IP的地址</p> <p><code>:</code> 用来将IP地址和端口号进行连接，即某个IP的某个端口连接服务器</p> <h2 id="并发服务器如何处理请求"><a href="#并发服务器如何处理请求" class="header-anchor">#</a> 并发服务器如何处理请求</h2> <p>并发服务器中主服务器循环通过派生一个子进程来处理每个新的连接。</p> <p>并发服务器在处理客户连接时，fork一个自身的副本，让子进程来处理客户的请求。</p> <img src="/imags/1654132754166.png" alt="1654132754166"> <h2 id="套接字缓冲区及限制"><a href="#套接字缓冲区及限制" class="header-anchor">#</a> 套接字缓冲区及限制</h2> <h3 id="mtu-最大传输单元"><a href="#mtu-最大传输单元" class="header-anchor">#</a> MTU 最大传输单元</h3> <ul><li>最大传输单元，在<a href="https://so.csdn.net/so/search?q=%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">数据链路层<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中，往往规定了MTU大小</li> <li>IP层的数据包通过数据链路层如果大于MTU，将被分片，到达接收端IP层后再被重组</li> <li>以太网的MTU为1500字节</li></ul> <h3 id="mss-最大报文段"><a href="#mss-最大报文段" class="header-anchor">#</a> MSS  最大报文段</h3> <ul><li>最大报文段，是TCP协议的一个选项。</li> <li>MSS选项用于在TCP建立连接时，收发双方协商一个TCP报文段所能承载的最大数据长度。</li> <li>MSS选项只在初始化连接请求(SYN=1)的报文段中使用。</li> <li>选择合适的MSS很重要。如果MSS小了，网络利用率低。如果MSS大了，由于在网络层需要分片，也会影响网络性能。</li> <li>一般MSS的长度为MTU(1500)-IP首部(20)-TCP首部(20)=1460字节。</li></ul> <h2 id="tcp-缓冲区及数据输出"><a href="#tcp-缓冲区及数据输出" class="header-anchor">#</a> TCP 缓冲区及数据输出</h2> <img src="/imags/1654134895613.png" alt="1654134895613"> <ol><li>应用程序调用write函数将数据写入内核缓冲区</li> <li>内核从缓冲区中将数据复制到套接字的发送缓冲区
<ol><li>发送缓冲区无法容纳应用程序的数据时，应用程序进入睡眠</li> <li>TCP中提供了 SO_SNDBUF套接字更改缓冲区大小</li></ol></li> <li>TCP在进行数据发送时，往往在本地留有副本，直到确认对端收到副本为止</li> <li>本端TCP以MSS大小或更小的字节块将数据传递给IP，同时每个字节块被做了标记</li> <li>IP为每个块新增IP标记，构成IP数据报，根据目标IP地址查找路由表选项以确定外出接口，然后数据被传递给相应的数据链路</li></ol> <h2 id="udp缓冲区及数据输出"><a href="#udp缓冲区及数据输出" class="header-anchor">#</a> UDP缓冲区及数据输出</h2> <img src="/imags/1654135121893.png" alt="1654135121893"> <ul><li>UDP因为并不可靠，因此并没有缓冲区进行数据的留存和观察</li></ul> <h2 id="套接字的地址结构"><a href="#套接字的地址结构" class="header-anchor">#</a> 套接字的地址结构</h2> <ul><li>套接字是网络通信的主要手段，每个套接字都需要一个参数，即套接字地址。</li> <li>套接字用来进行目标机和本机的判别，因此主要包含IP地址和端口号</li> <li>每个协议族都有自己的套接字地址结构 <code>sockaddr</code> 为套接字的起始</li></ul> <h3 id="posix数据类型"><a href="#posix数据类型" class="header-anchor">#</a> POSIX数据类型</h3> <p>Unix的理念是可移植性操作系统，因此，我们在进行底层开发时，必须遵守POSIX的规范，这种规范要求我们在进行网络编程时，定义的结构必须符合一些要求，如必须有至少三个字段， <strong>sin_family、sin_addr和sin_port</strong> 。</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token class-name">int8_t</span>			带符号<span class="token number">8</span>位整数			<span class="token operator">&lt;</span>sys<span class="token operator">/</span>types<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
<span class="token class-name">uint8_t</span>			无符号<span class="token number">8</span>位整数			<span class="token operator">&lt;</span>sys<span class="token operator">/</span>types<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
<span class="token class-name">int16_t</span>			带符号				  <span class="token operator">&lt;</span>sys<span class="token operator">/</span>types<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
<span class="token class-name">uint16_t</span>		无				   <span class="token operator">&lt;</span>sys<span class="token operator">/</span>types<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
<span class="token class-name">int32_t</span>			带					<span class="token operator">&lt;</span>sys<span class="token operator">/</span>types<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
<span class="token class-name">uint32_t</span>		无					<span class="token operator">&lt;</span>sys<span class="token operator">/</span>types<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
<span class="token class-name">sa_family_t</span>		套接字地址结构的地址族	<span class="token operator">&lt;</span>sys<span class="token operator">/</span>socket<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
<span class="token class-name">socklen_t</span>		套接字地址结构的长度，一般为<span class="token class-name">uint32_t</span>			<span class="token operator">&lt;</span>sys<span class="token operator">/</span>socket<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
<span class="token class-name">in_addr_t</span>		IPv4地址，一般为<span class="token class-name">uint32_t</span>		<span class="token operator">&lt;</span>netinet<span class="token operator">/</span>in<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
<span class="token class-name">in_port_t</span>		TCP或UDP端口，一般为<span class="token class-name">uint16_t</span>	<span class="token operator">&lt;</span>netinet<span class="token operator">/</span>in<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
</code></pre></div><h3 id="ipv4-套接字地址结构"><a href="#ipv4-套接字地址结构" class="header-anchor">#</a> IPv4 套接字地址结构</h3> <blockquote><p><em>定义在&lt;netinet/in.h&gt;头文件中</em></p> <div class="language-c extra-class"><pre class="language-c"><code>sockaddr_in     
		<span class="token keyword">struct</span> <span class="token class-name">in_addr</span><span class="token punctuation">{</span>							<span class="token comment">//定义该结构来表示IPv4地址</span>
		<span class="token class-name">in_addr_t</span>  	s_addr<span class="token punctuation">;</span>				        <span class="token comment">//32位IPv4的地址			</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in</span><span class="token punctuation">{</span>		<span class="token comment">//套接字地址结构</span>
		<span class="token class-name">uint8_t</span>		sin_len<span class="token punctuation">;</span>					<span class="token comment">//1字节，表示整个结构的长度=16字节</span>
		<span class="token class-name">sa_family_t</span>	sin_family<span class="token punctuation">;</span>		 		    <span class="token comment">//1字节AF_INET，表示是IPv4地址族</span>
		<span class="token class-name">in_port_t</span>	sin_port<span class="token punctuation">;</span>					<span class="token comment">//2字节，uint16_t，16位的端口号，0～65535</span>
		<span class="token keyword">struct</span> <span class="token class-name">in_addr</span>	sin_addr<span class="token punctuation">;</span>				<span class="token comment">//4字节，32位IPv4地址</span>
		<span class="token keyword">char</span>		sin_zero<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>				<span class="token comment">//8字节，unused，用来补充位数，一般为0</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><em><strong>struct in_addr_t可以指明为通配地址，此时sin_addr=INADDR_ANY</strong></em></p> <p><em><strong>为什么要定义结构in_addr来表示IPv4地址：因为早期这个结构中还存储了其他类型，用于给IPv4地址进行A、B、C类的分类。先在随着子网划分技术的来临，这些分类逐渐被废除。现在的in_addr中仅仅有一个in_addr_t字段。</strong></em></p></blockquote> <h3 id="通用套接字地址结构-ipv4"><a href="#通用套接字地址结构-ipv4" class="header-anchor">#</a> 通用套接字地址结构（IPv4）</h3> <blockquote><p>在任何套接字函数中，需要传递进一个指向套接字地址结构的指针作为参数。为了适用于任意的协议族的不同套接字地质结构，因此定义了通用套接字地址结构。</p> <p>通用套接字地址结构定义在&lt;sys/socket.h&gt;</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">sockaddr</span><span class="token punctuation">{</span>
		<span class="token class-name">uint8_t</span>		sa_len<span class="token punctuation">;</span>
		sa_family 	sa_family<span class="token punctuation">;</span>
		<span class="token keyword">char</span>		sa_data<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <h3 id="ipv6-套接字地址结构"><a href="#ipv6-套接字地址结构" class="header-anchor">#</a> IPv6 套接字地址结构</h3> <blockquote><p>头文件定义在&lt;netinet/in.h&gt;</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">in6_addr</span><span class="token punctuation">{</span>						
		<span class="token class-name">uint8_t</span>		sa_addr<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>		<span class="token comment">//128位IPv6地址，IPv4为32位in_addr_t(uint32)</span>
	<span class="token punctuation">}</span>
<span class="token keyword">struct</span> <span class="token class-name">sockaddr_in6</span><span class="token punctuation">{</span>
		<span class="token class-name">uint8_t</span>		sin6_len<span class="token punctuation">;</span>		<span class="token comment">//1字节，表示整个结构的长度=28字节</span>
		<span class="token class-name">sa_family_t</span>	sin6_family<span class="token punctuation">;</span>		<span class="token comment">//1字节，AF_INET6，表示是IPv6地址族，IPv4为AF_INET</span>
		<span class="token class-name">in_port_t</span>	sin6_port<span class="token punctuation">;</span>		<span class="token comment">//2字节，端口号</span>
		<span class="token class-name">uint32_t</span>		sin6_flowinfo<span class="token punctuation">;</span>		<span class="token comment">//4字节，流量窗口信息，未定义，IPv4没有</span>
		<span class="token keyword">struct</span> <span class="token class-name">in6_addr</span>	sin6_addr<span class="token punctuation">;</span>		<span class="token comment">//16字节，IPv6地址，IPv4为in_addr</span>
		<span class="token class-name">uint32_t</span>		sin6_scpor_id<span class="token punctuation">;</span>		<span class="token comment">//4字节，用来标识地址所在范围的接口，IPv4没有</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>struct in6_addr可以指明为通配地址，此时sin6_addr=in6addr_any（在该头文件中定义了）</strong></em></p></blockquote> <h3 id="通用套接字地址结构-ipv6"><a href="#通用套接字地址结构-ipv6" class="header-anchor">#</a> 通用套接字地址结构（IPv6）</h3> <blockquote><div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">sockaddr_storage</span><span class="token punctuation">{</span>
		<span class="token class-name">uint8_t</span>		ss_len<span class="token punctuation">;</span>		<span class="token comment">//本结构长度</span>
		sa_family_s	sa_family<span class="token punctuation">;</span>	<span class="token comment">//地址族，AF_xxx。</span>
<span class="token punctuation">}</span>
</code></pre></div><p>定义在头文件&lt;netinet/in.h&gt;</p></blockquote> <img src="/imags/1654150881129.png" alt="1654150881129"> <h2 id="进程和内核的结果传递"><a href="#进程和内核的结果传递" class="header-anchor">#</a> 进程和内核的结果传递</h2> <h3 id="从进程到内核传递套接字地址结构的函数-传递值"><a href="#从进程到内核传递套接字地址结构的函数-传递值" class="header-anchor">#</a> 从进程到内核传递套接字地址结构的函数：传递值</h3> <p><code>bind</code></p> <p><code>connect</code></p> <p><code>sendto</code></p> <h3 id="从内核到进程传递套接字地址结构的函数-传递指针"><a href="#从内核到进程传递套接字地址结构的函数-传递指针" class="header-anchor">#</a> 从内核到进程传递套接字地址结构的函数：传递指针</h3> <p><code>accept</code></p> <p><code>recvfrom</code></p> <p><code>getsockname</code></p> <p><code>getpeername</code></p> <h2 id="网络中的基本系统调用函数"><a href="#网络中的基本系统调用函数" class="header-anchor">#</a> 网络中的基本系统调用函数</h2> <table><thead><tr><th>函数名</th> <th>功能</th></tr></thead> <tbody><tr><td>socket()</td> <td>根据指定的地址族、数据类型和协议来分配一个套接口的描述字及其所用的资源。</td></tr> <tr><td>bind()</td> <td>当用socket()创建套接口后，它便存在于一个名字空间（地址族）中，但并未赋名。bind()函数通过给一个未命名套接口分配一个本地名字来为套接口建立本地捆绑（主机地址/端口号）。</td></tr> <tr><td>listen()</td> <td>创建一个套接口并<a href="https://baike.baidu.com/item/%E7%9B%91%E5%90%AC/17293" target="_blank" rel="noopener noreferrer">监听<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>申请的连接.</td></tr> <tr><td>accept()</td> <td>是在一个套接口接受的一个连接</td></tr> <tr><td>connect()</td> <td>用于建立与指定socket的连接</td></tr> <tr><td>recvfrom()</td> <td>接收一个数据报并保存源地址。</td></tr> <tr><td>close()</td> <td>用来关闭套接字，并终止TCP连接</td></tr></tbody></table> <h2 id="io模型-阻塞、非阻塞、多路复用、异步"><a href="#io模型-阻塞、非阻塞、多路复用、异步" class="header-anchor">#</a> IO模型-阻塞、非阻塞、多路复用、异步</h2> <p>网络IO数据传输，在进行端到端的传输过程中，一般分两个阶段</p> <ol><li>客户端向服务端发送请求——数据进行网络传输——数据传输完成</li> <li>数据从内核空间复制到进程空间</li></ol> <img src="/imags/1654154016432.png" alt="1654154016432"> <p>几种IO模型均是基于以上阶段进行传输，不同的模型采用了不同的策略。</p> <h3 id="阻塞式io模型"><a href="#阻塞式io模型" class="header-anchor">#</a> 阻塞式IO模型</h3> <img src="/imags/1654154101242.png" alt="1654154101242"> <ol><li>应用发出请求，执行recvfrom系统调用，以获取数据</li> <li>由于数据还没准备好，当前请求线程被阻塞，只能等待</li> <li>直到数据可读或者抛出异常
<ol><li>如果是单线程应用，主线程挂起，CPU空置</li> <li>如果是多线程，当前线程挂起，CPU切换时间片去执行其他线程</li></ol></li></ol> <h3 id="非阻塞式io模型"><a href="#非阻塞式io模型" class="header-anchor">#</a> 非阻塞式IO模型</h3> <img src="/imags/1654154327680.png" alt="1654154327680"> <blockquote><p>一般的Socket对象都会有一个  setblocking(False)  或者  ConfigureBlocing(false)  之类的方法，将当前IO线程设置成非阻塞模式</p></blockquote> <ol><li>当socket设置为nonblocking时，在一阶段（数据准备阶段）线程会不断的发起recvfrom轮询</li> <li>如果还没有准备好数据，会得到一个EWouldBLOCK错误信号</li> <li>数据准备好之后，开始真正执行recvfrom拉取数据
<ol><li>轮询会极大的消耗CPU时间，所以这种模型极少用到</li></ol></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/collection/dxctx.html" class="prev">
        Linux多线程
      </a></span> <span class="next"><a href="/collection/linux.html">
        Linux
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e2ddde8e.js" defer></script><script src="/assets/js/2.e74445cb.js" defer></script><script src="/assets/js/35.6302af3d.js" defer></script>
  </body>
</html>
