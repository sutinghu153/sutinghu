<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>进程间通信 | suting-Blogs</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="分布式博客云笔记">
    
    <link rel="preload" href="/assets/css/0.styles.386f4818.css" as="style"><link rel="preload" href="/assets/js/app.e2ddde8e.js" as="script"><link rel="preload" href="/assets/js/2.e74445cb.js" as="script"><link rel="preload" href="/assets/js/22.abd1537f.js" as="script"><link rel="prefetch" href="/assets/js/10.383382f2.js"><link rel="prefetch" href="/assets/js/11.79913c72.js"><link rel="prefetch" href="/assets/js/12.18e85316.js"><link rel="prefetch" href="/assets/js/13.78e33ed3.js"><link rel="prefetch" href="/assets/js/14.92269bd7.js"><link rel="prefetch" href="/assets/js/15.acc92b96.js"><link rel="prefetch" href="/assets/js/16.d8716382.js"><link rel="prefetch" href="/assets/js/17.fa6a1da4.js"><link rel="prefetch" href="/assets/js/18.c5024350.js"><link rel="prefetch" href="/assets/js/19.c3e206a7.js"><link rel="prefetch" href="/assets/js/20.6a00e35f.js"><link rel="prefetch" href="/assets/js/21.37c42ff6.js"><link rel="prefetch" href="/assets/js/23.6a041ee1.js"><link rel="prefetch" href="/assets/js/24.ab067683.js"><link rel="prefetch" href="/assets/js/25.a2de42cd.js"><link rel="prefetch" href="/assets/js/26.efa7caf3.js"><link rel="prefetch" href="/assets/js/27.1520ec85.js"><link rel="prefetch" href="/assets/js/28.be40ede1.js"><link rel="prefetch" href="/assets/js/29.5e42d4f2.js"><link rel="prefetch" href="/assets/js/3.fbcd2674.js"><link rel="prefetch" href="/assets/js/30.eae39a3c.js"><link rel="prefetch" href="/assets/js/31.63618f89.js"><link rel="prefetch" href="/assets/js/32.43b53339.js"><link rel="prefetch" href="/assets/js/33.931d2183.js"><link rel="prefetch" href="/assets/js/34.e7f37503.js"><link rel="prefetch" href="/assets/js/35.6302af3d.js"><link rel="prefetch" href="/assets/js/36.7aec4478.js"><link rel="prefetch" href="/assets/js/37.58461b9d.js"><link rel="prefetch" href="/assets/js/38.811a26e0.js"><link rel="prefetch" href="/assets/js/39.c3d07ac9.js"><link rel="prefetch" href="/assets/js/4.23df146b.js"><link rel="prefetch" href="/assets/js/40.b2c32317.js"><link rel="prefetch" href="/assets/js/41.368ac455.js"><link rel="prefetch" href="/assets/js/42.d68c9491.js"><link rel="prefetch" href="/assets/js/43.74a44b32.js"><link rel="prefetch" href="/assets/js/44.633f2e2b.js"><link rel="prefetch" href="/assets/js/45.eab6bf9b.js"><link rel="prefetch" href="/assets/js/46.3ddc24a7.js"><link rel="prefetch" href="/assets/js/5.4c581b45.js"><link rel="prefetch" href="/assets/js/6.27888615.js"><link rel="prefetch" href="/assets/js/7.e23a1d77.js"><link rel="prefetch" href="/assets/js/8.928501ca.js"><link rel="prefetch" href="/assets/js/9.0b4be001.js">
    <link rel="stylesheet" href="/assets/css/0.styles.386f4818.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">suting-Blogs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  home
</a></div><div class="nav-item"><a href="https://javaguide.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaGuide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://home.code-nav.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  code-nav
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/sutinghu153" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://mp.weixin.qq.com/mp/profile_ext?action=home&amp;__biz=MzA5ODI3NTI1OA==&amp;scene=124#wechat_redirect" target="_blank" rel="noopener noreferrer" class="nav-link external">
  WK听潮
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/itdevbooks/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  book
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  湘ICP备2021013988号-1
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  home
</a></div><div class="nav-item"><a href="https://javaguide.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  JavaGuide
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://home.code-nav.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  code-nav
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/sutinghu153" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://mp.weixin.qq.com/mp/profile_ext?action=home&amp;__biz=MzA5ODI3NTI1OA==&amp;scene=124#wechat_redirect" target="_blank" rel="noopener noreferrer" class="nav-link external">
  WK听潮
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/itdevbooks/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  book
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  湘ICP备2021013988号-1
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>个人项目</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>C/C++/Java/Golang</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux内核</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Linux系统开发</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/collection/xtkf.html" class="sidebar-link">IO-系统开发</a></li><li><a href="/collection/jcjtx.html" aria-current="page" class="active sidebar-link">进程间通信</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/collection/jcjtx.html#关于进程" class="sidebar-link">关于进程</a></li><li class="sidebar-sub-header"><a href="/collection/jcjtx.html#管道通信" class="sidebar-link">管道通信</a></li><li class="sidebar-sub-header"><a href="/collection/jcjtx.html#信号通信" class="sidebar-link">信号通信</a></li><li class="sidebar-sub-header"><a href="/collection/jcjtx.html#ipc通信" class="sidebar-link">IPC通信</a></li></ul></li><li><a href="/collection/dxctx.html" class="sidebar-link">Linux多线程</a></li><li><a href="/collection/netcode.html" class="sidebar-link">网络编程</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux/Makefile/Shell</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>区块链</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机视觉</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中间件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>常用命令</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>系统部署</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="进程间通信"><a href="#进程间通信" class="header-anchor">#</a> 进程间通信</h1> <h2 id="关于进程"><a href="#关于进程" class="header-anchor">#</a> 关于进程</h2> <h3 id="什么是进程间通信"><a href="#什么是进程间通信" class="header-anchor">#</a> 什么是进程间通信？</h3> <p>两个进程借助内核空间进行通信。</p> <p>进程与进程之间是相互独立的，各自运行在自己的<a href="https://so.csdn.net/so/search?q=%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">虚拟内存<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中。</p> <p>要想在进程与进程间建立联系，需要通过内核，在内核中开辟一块缓冲区，两个进程的信息在缓冲区中进行交换或者传递。</p> <ul><li>在用户空间实现进程通信不可能</li> <li>实现进程通信需要借助Linux内核空间</li> <li>通信方式（单击模式，仅一个Linux内核的通信模式）
<ul><li>管道通信
<ul><li>无名管道</li> <li>有名管道（文件系统中有名）</li></ul></li> <li>信号通信
<ul><li>信号的发送</li> <li>信号的接收</li> <li>信号的处理</li></ul></li> <li>IPC通信
<ul><li>共享内存</li> <li>消息队列</li> <li>信号灯</li></ul></li> <li>Socket通信
<ul><li>存在于一个网络中两个进程间的通信</li></ul></li></ul></li> <li>进程间通信方式的实现是基于文件IO的思想</li></ul> <h3 id="什么是线程间通信"><a href="#什么是线程间通信" class="header-anchor">#</a> 什么是线程间通信？</h3> <ul><li>可以在用户空间就实现</li> <li>可以通过全局变量通信</li></ul> <h2 id="管道通信"><a href="#管道通信" class="header-anchor">#</a> 管道通信</h2> <h3 id="什么是管道通信"><a href="#什么是管道通信" class="header-anchor">#</a> 什么是管道通信</h3> <ol><li><p>管道的实质是队列，先进先出，入队是写，出队是读</p></li> <li><p>管道文件是特殊的文件，不能用open函数创建</p></li> <li><p>管道创建的方式是pipe函数</p> <ol><li>int pipe(int fd[2])</li> <li>创建管道，为系统调用</li></ol> <blockquote><p>pipe()函数用于在内核中创建一个管道，该管道一端用于读取管道中的数据，另一端用于将数据写入管道。在创建一个管道后，会获得一对文件描述符，用于读取和写入，然后将参数数组filedes中的两个值传递给获取到的两个文件描述符，filedes[0]指向管道的读端，filedes[1]指向写端。</p> <p>pipe()函数调用成功，返回值为0；否则返回-1，并且设置了适当的错误返回信息。此函数只是创建了管道，要想从管道中读取数据或者向管道中写入数据，需要使用read()和write()函数来完成。当管道通信结束后，需要使用close()函数关闭管道的读写端。</p></blockquote></li> <li><p>管道是创建在内存中的，进程结束，空间释放，管道就不存在了</p></li> <li><p>管道中的东西，读完就不存在了</p></li> <li><p>如果管道中没有东西可读，就会阻塞</p></li></ol> <h3 id="管道通信的分类"><a href="#管道通信的分类" class="header-anchor">#</a> 管道通信的分类</h3> <h4 id="无名管道"><a href="#无名管道" class="header-anchor">#</a> 无名管道</h4> <h5 id="无名管道创建函数"><a href="#无名管道创建函数" class="header-anchor">#</a> 无名管道创建函数</h5> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">pipe</span><span class="token punctuation">(</span><span class="token keyword">int</span> filedes<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="无名管道如何实现进程间通信-框架"><a href="#无名管道如何实现进程间通信-框架" class="header-anchor">#</a> <strong>无名管道如何实现进程间通信——框架</strong></h5> <ol><li>只能用于具有共同祖先的进程（具有亲缘关系的进程）之间进行通信；通常，一个管道由一个进程创建，然后该进程调用fork()，此后父子进程之间就可以应用该管道。因为子进程在创建时，是被复制了父进程的所有的数据。</li> <li>一般而言，进程退出，管道释放，所以管道的生命周期跟随进程。</li> <li>管道要实现通信，两个进程必须操作同一个管道</li> <li>一般而言，内核会对管道操作进行同步与互斥</li> <li>管道是半双工的，数据只能向一个方向流动；需要双方通信时，需要建立起两个管道。</li> <li>无名管道写阻塞时，是管道队列数据塞满时，阻塞值5400*（hello linux）--&gt;5500*(hello linux)</li> <li>无名管道读阻塞时，是管道队列为空时</li></ol> <h5 id="无名管道如何实现进程间通信-内核"><a href="#无名管道如何实现进程间通信-内核" class="header-anchor">#</a> <strong>无名管道如何实现进程间通信——内核</strong></h5> <ol><li>在父进程中调用pipe()函数创建一个管道，产生一个文件描述符filedes[0]指向管道的读端和另一个文件描述符filedes[1]指向管道的写端。</li> <li>在父进程中调用fork()函数创建一个一模一样的新进程，也就是所谓的子进程。父进程的文件描述符一个指向读端，一个指向写端。子进程同理。</li> <li>在父进程关闭指向管道写端的文件描述符filedes[1]，在子进程中，关闭指向管道读端的文件描述符filedes[0]。此时，就可以将子进程中的某个数据写入到管道，然后在父进程中，将此数据读出来。</li></ol> <h5 id="通信实例"><a href="#通信实例" class="header-anchor">#</a> <strong>通信实例</strong></h5> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAXSIZE</span> <span class="token expression"><span class="token number">100</span></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> fd<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pid<span class="token punctuation">,</span> line<span class="token punctuation">;</span>
    <span class="token keyword">char</span> message<span class="token punctuation">[</span>MAXSIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">/*创建管道*/</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">pipe</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
	<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;create pipe failed!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/*创建新进程*/</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>pid <span class="token operator">=</span> <span class="token function">vfork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
	<span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">&quot;not create a new process!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/*子进程*/</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>pid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
	<span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;child process SEND message!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello Linux!&quot;</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*向文件中写入数据*/</span> 
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
	<span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;parent process RECEIVE message is:\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	line <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span> MAXSIZE<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*读取消息，返回消息长度*/</span>
	<span class="token function">write</span><span class="token punctuation">(</span>STDOUT_FILENO<span class="token punctuation">,</span>message<span class="token punctuation">,</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/*将消息写入终端*/</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">wait</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">_exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="有名管道"><a href="#有名管道" class="header-anchor">#</a> 有名管道</h4> <blockquote><blockquote><p>所谓有名管道，是对无名管道进行改进，使之能够在非亲缘进程间进行通信的方式。</p> <p>所谓的有名，即文件系统中存在这个文件节点，每一个文件节点都有一个inode号，而且是一个特殊的文件类型：p管道类型。</p> <blockquote><p>普通文件：—，open函数创建</p> <p>目录文件：d，mkdir函数创建</p> <p>链接文件：l，in -s方式创建</p> <p>管道文件：p，mkfifo函数创建</p> <p>S-C-B文件</p></blockquote></blockquote></blockquote> <h5 id="有名管道的创建函数"><a href="#有名管道的创建函数" class="header-anchor">#</a> 有名管道的创建函数</h5> <p>int mkfifo(const char *filename,mode_t mode);</p> <ul><li>功能，创建管道文件</li> <li>参数，管道文件名，权限</li> <li>创建的文件的权限依旧与umask掩码有关系</li> <li>返回值，创建成功返回0，创建失败返回-1</li> <li>不会在内核中创建管道</li></ul> <h5 id="不占磁盘空间的文件类型"><a href="#不占磁盘空间的文件类型" class="header-anchor">#</a> 不占磁盘空间的文件类型</h5> <ol><li>有名管道</li> <li>字符设备</li> <li>块设备</li> <li>套接字</li></ol> <p>以上文件不占磁盘空间，只有文件节点</p> <h5 id="有名管道实现进程通信-框架"><a href="#有名管道实现进程通信-框架" class="header-anchor">#</a> 有名管道实现进程通信——框架</h5> <ol><li>进程调用了mkfifo，会通知内核创建P文件</li> <li>内核会在用户空间生成文件名</li> <li>open打开用户空间生成的文件时，会在内核生成对应的管道</li></ol> <h5 id="有名管道实现进程通信-实例"><a href="#有名管道实现进程通信-实例" class="header-anchor">#</a> 有名管道实现进程通信——实例</h5> <p>创建管道</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;stdio.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;unistd.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;stdlib.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;fcntl.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;sys/types.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;sys/stat.h&quot;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
        <span class="token keyword">int</span> ret<span class="token punctuation">;</span>
        ret <span class="token operator">=</span> <span class="token function">mkfifo</span><span class="token punctuation">(</span><span class="token string">&quot;myp&quot;</span><span class="token punctuation">,</span><span class="token number">0777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;creat myfifo failure\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;creat myfifo sucess\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

</code></pre></div><p>读写通信</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;stdio.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;unistd.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;stdlib.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;sys/types.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;fcntl.h&quot;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> fd<span class="token punctuation">;</span>
	
	<span class="token keyword">char</span> process_inter<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	
	fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;./myfifo&quot;</span><span class="token punctuation">,</span>O_WRONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span>fd<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;open myfifo failure&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;this is first process i = %d\n&quot;</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">usleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	process_inter<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
	
	<span class="token function">write</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>process_inter<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;stdio.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;unistd.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;stdlib.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;sys/types.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;fcntl.h&quot;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> fd<span class="token punctuation">;</span>
	
	<span class="token keyword">int</span> process_inter<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
	
	fd<span class="token operator">=</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;./myfifo&quot;</span><span class="token punctuation">,</span>O_RDONLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span>fd<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;open myfifo failure\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;open myfifo sucess\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span><span class="token operator">&amp;</span>process_inter<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">while</span><span class="token punctuation">(</span>process_inter<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span>fi<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;this is first process i = %d\n&quot;</span><span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">usleep</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="信号通信"><a href="#信号通信" class="header-anchor">#</a> 信号通信</h2> <h3 id="关于信号通信"><a href="#关于信号通信" class="header-anchor">#</a> 关于信号通信</h3> <p>信号通信的对象是信号，用户空间无法发出信号，必须通知内核发送信号给另一个用户空间的用户。</p> <h4 id="内核空间的信号"><a href="#内核空间的信号" class="header-anchor">#</a> 内核空间的信号</h4> <p>kill 命令 kill -l可以查看内核发送的信号类型</p> <p>64 种不同的信号</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token number">1</span><span class="token punctuation">)</span> SIGHUP	 <span class="token number">2</span><span class="token punctuation">)</span> SIGINT	 <span class="token number">3</span><span class="token punctuation">)</span> SIGQUIT	 <span class="token number">4</span><span class="token punctuation">)</span> SIGILL	 <span class="token number">5</span><span class="token punctuation">)</span> SIGTRAP
 <span class="token number">6</span><span class="token punctuation">)</span> SIGABRT	 <span class="token number">7</span><span class="token punctuation">)</span> SIGBUS	 <span class="token number">8</span><span class="token punctuation">)</span> SIGFPE	 <span class="token number">9</span><span class="token punctuation">)</span> SIGKILL	<span class="token number">10</span><span class="token punctuation">)</span> SIGUSR1
<span class="token number">11</span><span class="token punctuation">)</span> SIGSEGV	<span class="token number">12</span><span class="token punctuation">)</span> SIGUSR2	<span class="token number">13</span><span class="token punctuation">)</span> SIGPIPE	<span class="token number">14</span><span class="token punctuation">)</span> SIGALRM	<span class="token number">15</span><span class="token punctuation">)</span> SIGTERM
<span class="token number">16</span><span class="token punctuation">)</span> SIGSTKFLT	<span class="token number">17</span><span class="token punctuation">)</span> SIGCHLD	<span class="token number">18</span><span class="token punctuation">)</span> SIGCONT	<span class="token number">19</span><span class="token punctuation">)</span> SIGSTOP	<span class="token number">20</span><span class="token punctuation">)</span> SIGTSTP
<span class="token number">21</span><span class="token punctuation">)</span> SIGTTIN	<span class="token number">22</span><span class="token punctuation">)</span> SIGTTOU	<span class="token number">23</span><span class="token punctuation">)</span> SIGURG	<span class="token number">24</span><span class="token punctuation">)</span> SIGXCPU	<span class="token number">25</span><span class="token punctuation">)</span> SIGXFSZ
<span class="token number">26</span><span class="token punctuation">)</span> SIGVTALRM	<span class="token number">27</span><span class="token punctuation">)</span> SIGPROF	<span class="token number">28</span><span class="token punctuation">)</span> SIGWINCH	<span class="token number">29</span><span class="token punctuation">)</span> SIGIO	<span class="token number">30</span><span class="token punctuation">)</span> SIGPWR
<span class="token number">31</span><span class="token punctuation">)</span> SIGSYS	<span class="token number">34</span><span class="token punctuation">)</span> SIGRTMIN	<span class="token number">35</span><span class="token punctuation">)</span> SIGRTMIN<span class="token operator">+</span><span class="token number">1</span>	<span class="token number">36</span><span class="token punctuation">)</span> SIGRTMIN<span class="token operator">+</span><span class="token number">2</span>	<span class="token number">37</span><span class="token punctuation">)</span> SIGRTMIN<span class="token operator">+</span><span class="token number">3</span>
<span class="token number">38</span><span class="token punctuation">)</span> SIGRTMIN<span class="token operator">+</span><span class="token number">4</span>	<span class="token number">39</span><span class="token punctuation">)</span> SIGRTMIN<span class="token operator">+</span><span class="token number">5</span>	<span class="token number">40</span><span class="token punctuation">)</span> SIGRTMIN<span class="token operator">+</span><span class="token number">6</span>	<span class="token number">41</span><span class="token punctuation">)</span> SIGRTMIN<span class="token operator">+</span><span class="token number">7</span>	<span class="token number">42</span><span class="token punctuation">)</span> SIGRTMIN<span class="token operator">+</span><span class="token number">8</span>
<span class="token number">43</span><span class="token punctuation">)</span> SIGRTMIN<span class="token operator">+</span><span class="token number">9</span>	<span class="token number">44</span><span class="token punctuation">)</span> SIGRTMIN<span class="token operator">+</span><span class="token number">10</span>	<span class="token number">45</span><span class="token punctuation">)</span> SIGRTMIN<span class="token operator">+</span><span class="token number">11</span>	<span class="token number">46</span><span class="token punctuation">)</span> SIGRTMIN<span class="token operator">+</span><span class="token number">12</span>	<span class="token number">47</span><span class="token punctuation">)</span> SIGRTMIN<span class="token operator">+</span><span class="token number">13</span>
<span class="token number">48</span><span class="token punctuation">)</span> SIGRTMIN<span class="token operator">+</span><span class="token number">14</span>	<span class="token number">49</span><span class="token punctuation">)</span> SIGRTMIN<span class="token operator">+</span><span class="token number">15</span>	<span class="token number">50</span><span class="token punctuation">)</span> SIGRTMAX<span class="token operator">-</span><span class="token number">14</span>	<span class="token number">51</span><span class="token punctuation">)</span> SIGRTMAX<span class="token operator">-</span><span class="token number">13</span>	<span class="token number">52</span><span class="token punctuation">)</span> SIGRTMAX<span class="token operator">-</span><span class="token number">12</span>
<span class="token number">53</span><span class="token punctuation">)</span> SIGRTMAX<span class="token operator">-</span><span class="token number">11</span>	<span class="token number">54</span><span class="token punctuation">)</span> SIGRTMAX<span class="token operator">-</span><span class="token number">10</span>	<span class="token number">55</span><span class="token punctuation">)</span> SIGRTMAX<span class="token operator">-</span><span class="token number">9</span>	<span class="token number">56</span><span class="token punctuation">)</span> SIGRTMAX<span class="token operator">-</span><span class="token number">8</span>	<span class="token number">57</span><span class="token punctuation">)</span> SIGRTMAX<span class="token operator">-</span><span class="token number">7</span>
<span class="token number">58</span><span class="token punctuation">)</span> SIGRTMAX<span class="token operator">-</span><span class="token number">6</span>	<span class="token number">59</span><span class="token punctuation">)</span> SIGRTMAX<span class="token operator">-</span><span class="token number">5</span>	<span class="token number">60</span><span class="token punctuation">)</span> SIGRTMAX<span class="token operator">-</span><span class="token number">4</span>	<span class="token number">61</span><span class="token punctuation">)</span> SIGRTMAX<span class="token operator">-</span><span class="token number">3</span>	<span class="token number">62</span><span class="token punctuation">)</span> SIGRTMAX<span class="token operator">-</span><span class="token number">2</span>
<span class="token number">63</span><span class="token punctuation">)</span> SIGRTMAX<span class="token operator">-</span><span class="token number">1</span>	<span class="token number">64</span><span class="token punctuation">)</span> SIGRTMAX
</code></pre></div><p>数字代表信号ID，宏代表的是不同的意义，功能。</p> <h4 id="信号通信的问题"><a href="#信号通信的问题" class="header-anchor">#</a> 信号通信的问题</h4> <ul><li>告诉内核发什么信号，这个信号代表的含义(which) pipe</li> <li>告诉内核信号要发送给哪个进程（who）PID，即进程的代号</li></ul> <h3 id="信号通信的框架"><a href="#信号通信的框架" class="header-anchor">#</a> 信号通信的框架</h3> <h4 id="信号的发送"><a href="#信号的发送" class="header-anchor">#</a> 信号的发送</h4> <p>发送信号进程</p> <p>kill</p> <p>raise</p> <p>alarm</p> <h5 id="kill-系统调用函数"><a href="#kill-系统调用函数" class="header-anchor">#</a> kill 系统调用函数</h5> <p>一个进程可以向另一个进程发送信号，因此信号可以很好的用于进程之间的通信。通过信号输出的信息，使多个进程可以协作完成一个任务。Linux环境使用kill函数向进程或进程组发送信号。</p> <p>int kill (pid_t pid,int sig);</p> <table><thead><tr><th style="text-align:center;">参数</th> <th style="text-align:center;">取值</th> <th style="text-align:center;">含义</th></tr></thead> <tbody><tr><td style="text-align:center;">pid</td> <td style="text-align:center;">&gt;0</td> <td style="text-align:center;">将此信号发送给进程ID为pid的进程</td></tr> <tr><td style="text-align:center;">pid</td> <td style="text-align:center;">==0</td> <td style="text-align:center;">将此信号发送给进程ID和该进程相同的进程</td></tr> <tr><td style="text-align:center;">pid</td> <td style="text-align:center;">&lt;0</td> <td style="text-align:center;">将此信号发送给进程组内进程ID为pid的进程</td></tr> <tr><td style="text-align:center;">pid</td> <td style="text-align:center;">==-1</td> <td style="text-align:center;">将此信号发送给系统所有进程</td></tr> <tr><td style="text-align:center;">sig</td> <td style="text-align:center;">kill -l</td> <td style="text-align:center;">信号宏的ID</td></tr></tbody></table> <h6 id="返回值"><a href="#返回值" class="header-anchor">#</a> 返回值</h6> <p>成功执行时，返回0；失败返回-1。errno被设为以下的某个值EINVAL：指定的信号码无效（参数sig不合法）；EPERM：权限不够无法传送信号给指定进程；ESRCH：参数pid所指定进程或进程组不存在。</p> <h6 id="kill-命令实现"><a href="#kill-命令实现" class="header-anchor">#</a> kill 命令实现</h6> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;sys/types.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;signal.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;unistd.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;stdio.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;stdlib.h&quot;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> sig<span class="token punctuation">;</span>
	<span class="token keyword">int</span> pid<span class="token punctuation">;</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span>argc <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;please input param&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	sig <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	pid <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;input sig=%d,pid=%d\n&quot;</span><span class="token punctuation">,</span>sig<span class="token punctuation">,</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
	<span class="token comment">// 调用系统调用函数 kill</span>
	<span class="token function">kill</span><span class="token punctuation">(</span>pid<span class="token punctuation">,</span>sig<span class="token punctuation">)</span><span class="token punctuation">;</span> 
		
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="raise-系统调用函数"><a href="#raise-系统调用函数" class="header-anchor">#</a> raise 系统调用函数</h5> <h6 id="int-raise-int-sig"><a href="#int-raise-int-sig" class="header-anchor">#</a> int raise(int sig)</h6> <ul><li>函数功能：向进程本身发送一个信号，相当于 kill(getpid(), sig)</li> <li>函数参数：signo,要发送的信号值</li> <li>返回值：成功返回0，出错返回 -1</li></ul> <p>raise告诉内核发送信号给自己，该进程干某些事。</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
   <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;这是一个raise函数的应用实例\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">raise</span><span class="token punctuation">(</span>SIGABRT<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token comment">//向进程本身发送SIGABRT信号失败</span>
   <span class="token punctuation">{</span>
     <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;调用raise函数失败!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//提示发送失败，然后退出</span>
     <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;raise发送SIGABRT信号没有成功!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//如果进程被自己中止则不显示</span>
   <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h5 id="alarm系统调用函数"><a href="#alarm系统调用函数" class="header-anchor">#</a> alarm系统调用函数</h5> <h6 id="unsigned-int-alarm-unsigned-int-seconds"><a href="#unsigned-int-alarm-unsigned-int-seconds" class="header-anchor">#</a> unsigned int alarm(unsigned int seconds);</h6> <ul><li>函数说明：
<ul><li>alarm 函数可设置定时器，当定时器超时，产生 SIGALRM 信号</li> <li>信号由内核产生，在指定的 seconds 秒之后，给<strong>进程本身</strong>发送一个 SIGALRM 信号。</li> <li>收到信号后的进程默认终止当前进程</li> <li>参数为 0，取消以前设置的定时器</li> <li>alarm 发送定时结束后发送信号</li></ul></li> <li>返回值：
<ul><li>0 或以前设置的定时器时间余留秒数</li></ul></li></ul> <h4 id="信号的接收"><a href="#信号的接收" class="header-anchor">#</a> 信号的接收</h4> <p>接收信号的进程，要有什么条件，要想使接收的进程收到信号，这个进程不能结束</p> <p>pause（睡眠）、sleep（睡眠）、while（挂起）</p> <h5 id="pause-系统调用函数"><a href="#pause-系统调用函数" class="header-anchor">#</a> pause 系统调用函数</h5> <h6 id="int-pause-void"><a href="#int-pause-void" class="header-anchor">#</a> int pause(void);</h6> <p>使调用进程进入休眠状态，直到接收信号 signal 时中断。</p> <p>返回值始终为-1</p> <h4 id="信号的处理"><a href="#信号的处理" class="header-anchor">#</a> 信号的处理</h4> <p>接收信号的处理</p> <h5 id="signal-系统调用函数"><a href="#signal-系统调用函数" class="header-anchor">#</a> signal 系统调用函数</h5> <h6 id="void-signal-int-signum-void-handler-int-int"><a href="#void-signal-int-signum-void-handler-int-int" class="header-anchor">#</a> void (*signal(int signum,void (*handler)(int)))(int);</h6> <blockquote><p>void (*handler)(int) 参数</p> <blockquote><p>函数指针变量</p> <p>含有一个整型参数，无返回值</p></blockquote> <p>第一个参数，信号值，告诉内核处理哪个信号</p> <p>第二个参数，函数指针，告诉内核采用哪个处理方式</p> <p>返回值，函数指针</p> <p><a href="https://www.freesion.com/article/64521006466/" target="_blank" rel="noopener noreferrer">信号处理方式<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.runoob.com/cprogramming/c-function-signal.html" target="_blank" rel="noopener noreferrer">C 库函数 – signal() <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <h6 id="不同的处理方式"><a href="#不同的处理方式" class="header-anchor">#</a> 不同的处理方式</h6> <ul><li><p>忽略  signal(SIGINT, SIG_IGN);</p> <div class="language-c extra-class"><pre class="language-c"><code>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;signal.h&gt;</span></span>
          
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>          
        <span class="token function">signal</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span>SIG_IGN<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token keyword">int</span> i<span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;hello world\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>系统默认处理方式  signal(SIGINT, SIG_DFL);</p> <div class="language-c extra-class"><pre class="language-c"><code>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;signal.h&gt;</span></span>
          
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>             
        <span class="token function">signal</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span>SIG_DFL<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token keyword">int</span> i<span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;hello world\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  
</code></pre></div></li> <li><p>自定义指针   程序能够告诉内核，当程序到来时应该调用哪个函数。   signal(signum, functionname);</p> <div class="language-c extra-class"><pre class="language-c"><code>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;signal.h&gt;</span></span>
          
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>         
        <span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      
        <span class="token function">signal</span><span class="token punctuation">(</span>SIGINT<span class="token punctuation">,</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token keyword">int</span> i<span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
                <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;hello world\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>   
<span class="token comment">// 当前进程处理以下操作后结束该进程</span>
<span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">int</span> signum<span class="token punctuation">)</span>
<span class="token punctuation">{</span>   
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;SIGINT\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>signal 函数到达控制流转向信号处理器，从信号处理器返回后继续执行原来的控制流。</p></li></ul> <h2 id="ipc通信"><a href="#ipc通信" class="header-anchor">#</a> IPC通信</h2> <h3 id="ipc的分类"><a href="#ipc的分类" class="header-anchor">#</a> IPC的分类</h3> <ul><li>消息队列：system V message queue</li> <li>信号量：system V semphore</li> <li>共享内存：system V share memory</li></ul> <h3 id="ipc对象的基本概念"><a href="#ipc对象的基本概念" class="header-anchor">#</a> IPC对象的基本概念</h3> <p>支持不同的进程通过ipc对象通信，IPC对象是存储在内核之中，且全局可见。</p> <ul><li>每个IPC对象在内核之中有自己的数据结构，定义在各自头文件</li> <li>如何引用IPC对象
类似于普通文件是通过文件名（文件描述符）进行读写操作，通过IPC对象：IPC key和 IPC标识符进行IPC对象的读写操作。</li></ul> <h4 id="ipc标识符"><a href="#ipc标识符" class="header-anchor">#</a> IPC标识符</h4> <ul><li>类似于文件描述符，可以用一个IPC标示符来引用一个IPC对象</li> <li>IPC对象描述符类似于文件描述符，是一个整数，是IPC对象的内部名字</li> <li>当多个进程引用同一个IPC对象时，需要一个统一的外部名</li> <li>类似于文件名，每个IPC对象与一个key相关联</li></ul> <h4 id="ipc-key"><a href="#ipc-key" class="header-anchor">#</a> IPC key</h4> <ul><li>IPC key，ipc对象的外部名，是一个独一无二的整数，用来确保ipc对象的唯一性</li> <li>该整数类型为key_t,在sys/types.h中被定义为长整型</li> <li>普通文件是通过open打开一个文件名，获得文件描述符；IPC队形是通过get可根据给定的key 去创建一个IPC对象，并返回IPC标识符</li></ul> <h3 id="ipc对象的管理"><a href="#ipc对象的管理" class="header-anchor">#</a> IPC对象的管理</h3> <p>ipcs 查看内核空间对象</p> <h4 id="查看ipc对象"><a href="#查看ipc对象" class="header-anchor">#</a> 查看IPC对象</h4> <blockquote><p><strong>ipcs -m</strong>　　查看系统共享内存信息</p> <p><strong>ipcs -q</strong>　　 查看系统消息队列信息</p> <p><strong>ipcs -s</strong>　　  查看系统信号量信息</p> <p><strong>ipcs [-a]</strong>　    系统默认输出信息，显示系统内所有的IPC信息</p> <p><a href="https://www.cnblogs.com/klb561/p/11871402.html" target="_blank" rel="noopener noreferrer">Linux命令：ipcs/ipcrm命令 <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote> <p>例子：ipcs -m</p> <div class="language-shell extra-class"><pre class="language-shell"><code>------ Shared Memory Segments --------
key        shmid      owner      perms      bytes      nattch     status      
0x0052e2c1 <span class="token number">622592</span>     postgres   <span class="token number">600</span>        <span class="token number">41222144</span>   <span class="token number">34</span>    
</code></pre></div><h4 id="删除ipc对象"><a href="#删除ipc对象" class="header-anchor">#</a> 删除IPC对象</h4> <p>ipcrm -m id</p> <h3 id="共享内存"><a href="#共享内存" class="header-anchor">#</a> 共享内存</h3> <ul><li>共享内存是在内存中单独开辟的一段内存空间</li> <li>这段内存空间有自己特有的数据结构</li> <li>包括访问权限、大小和最近访问的时间等。</li> <li>共享内存的数据读取后不会消失，即数据会一直存在，直到被删除或系统关闭</li></ul> <h4 id="共享内存的创建-打开"><a href="#共享内存的创建-打开" class="header-anchor">#</a> 共享内存的创建/打开</h4> <h5 id="int-shmget-ket-t-key-int-size-int-shmflg"><a href="#int-shmget-ket-t-key-int-size-int-shmflg" class="header-anchor">#</a> int shmget(ket_t key,int size,int shmflg);</h5> <ul><li>key : IPC_PRIVATE或ftok()的返回值</li> <li>size : 共享内存区的大小</li> <li>shmflg : 同open函数的权限位，也可以用8进制法</li> <li>返回值 成功，共享内存段标识符ID 文件描述符 失败-1</li></ul> <h5 id="通信类型"><a href="#通信类型" class="header-anchor">#</a> 通信类型</h5> <p>通过IPC_PRIVATE创建的只能用于亲缘关系之间的通信，ftok()方式创建的可以用于无亲缘关系的通信。</p> <h4 id="共享内存的映射-删除"><a href="#共享内存的映射-删除" class="header-anchor">#</a> 共享内存的映射/删除</h4> <h5 id="void-shmat-int-shmid-const-void-shmaddr-int-shmflg"><a href="#void-shmat-int-shmid-const-void-shmaddr-int-shmflg" class="header-anchor">#</a> void *shmat(int shmid,const void *shmaddr,int shmflg);</h5> <p>将进程的共享内存映射到用户空间</p> <ul><li>第一个参数 ID 号</li> <li>第二个参数 映射的地址，NULL为系统自动完成的映射</li> <li>第三个参数 shmflg : SHM_RDONLY共享内存只读，默认是0，表示共享内存可读写</li> <li>返回值，成功，映射后的地址，失败NULL</li></ul> <h5 id="int-shmdt-const-void-shmaddr"><a href="#int-shmdt-const-void-shmaddr" class="header-anchor">#</a> int shmdt(const void *shmaddr);</h5> <p>将进程里的地址映射删除</p> <ul><li>参数共享内存映射后的地址</li> <li>返回值，成功 0 ，失败 -1</li></ul> <h3 id="消息队列"><a href="#消息队列" class="header-anchor">#</a> 消息队列</h3> <h4 id="什么是消息队列"><a href="#什么是消息队列" class="header-anchor">#</a> 什么是消息队列？</h4> <p>管道中的队列是方向单一、数据结构类型单一的顺序队列。那么消息队列呢？</p> <ul><li>消息队列亦称报文队列，也叫做信箱。是Linux的一种通信机制，这种通信机制传递的数据具有某种结构，而不是简单的字节流。</li> <li>消息队列的本质其实是一个内核提供的链表，内核基于这个链表，实现了一个数据结构</li> <li>向消息队列中写数据，实际上是向这个数据结构中插入一个新结点；从消息队列汇总读数据，实际上是从这个数据结构中删除一个结点</li> <li>消息队列提供了一个从一个进程向另外一个进程发送一块数据的方法</li> <li>消息队列也有管道一样的不足，就是每个数据块的最大长度是有上限的，系统上全体队列的最大总长度也有一个上限。</li> <li>消息队列提供了一个从一个进程向另一个进程发送数据块的方法，每个数据块都可以被认为是有一个类型，接受者接受的数据块可以有不同的类型。</li> <li>每个消息的最大长度是有上限的**(MSGMAX)<strong>，每个消息队列的总的</strong>字节数(MSGMNB)<strong>，系统上消息队列的</strong>总数上限(MSGMNI)**。可以用 <strong>cat /proc/sys/kernel/msgmax</strong> 查看具体的数据。</li></ul> <img src="/imags/xxdl_1.png" alt="xxdl_1"> <blockquote><p>type 代表是的数据结构的类型如，字符串、整型、字节流</p> <p>length 代表的是当前结构中data的长度</p> <p>data 指当前结点消息的数据内容</p> <p>整体表现为链式队列，消息队列中的每个消息类型可以保持不一致</p></blockquote> <p>内核为消息队列IPC对象维护了一个数据结构 <code>struct ipc_perm</code> 用于标记消息队列，让进程知道操作的是哪个消息队列。</p> <p>过程如下：</p> <ol><li>每一个msqid_ds表示一个消息队列</li> <li>通过msqid_ds.msg_first、msg_last维护一个先进先出的msg链表队列</li> <li>当发送一个消息到该消息队列时，把发送的消息构造成一个msg的结构对象</li> <li>添加到msqid_ds.msg_first、msg_last维护的链表队列</li></ol> <h4 id="消息队列的工作机制如何"><a href="#消息队列的工作机制如何" class="header-anchor">#</a> 消息队列的工作机制如何？</h4> <img src="/imags/xxdl_2.png" alt="xxdl_2"> <ol><li>生命周期随内核，消息队列会一直存在，需要我们显示的调用接口删除或使用命令删除</li> <li>消息队列可以双向通信</li> <li>克服了管道只能承载无格式字节流的缺点</li> <li>消息队列中的消息被消费后会被清理即写入数据为插入节点，读取数据为删除节点</li></ol> <h4 id="操作消息队列"><a href="#操作消息队列" class="header-anchor">#</a> 操作消息队列</h4> <h5 id="创建消息队列"><a href="#创建消息队列" class="header-anchor">#</a> 创建消息队列</h5> <h6 id="函数原型"><a href="#函数原型" class="header-anchor">#</a> 函数原型</h6> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/ipc.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/msg.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">msgget</span><span class="token punctuation">(</span><span class="token class-name">key_t</span> key<span class="token punctuation">,</span> <span class="token keyword">int</span> msgflag<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h6 id="函数参数"><a href="#函数参数" class="header-anchor">#</a> 函数参数</h6> <ul><li><p>key：某个消息队列的名字,两种方式</p> <ul><li><p>使用宏</p> <blockquote><p><a href="https://blog.csdn.net/xhu_eternalcc/article/details/16801825" target="_blank" rel="noopener noreferrer"> linux进程通信IPC之IPC_PRIVATE与ftok比较<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote></li> <li><p>用ftok()产生</p></li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/ipc.h&gt;</span></span>
<span class="token class-name">key_t</span> <span class="token function">ftok</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pathname<span class="token punctuation">,</span> <span class="token keyword">int</span> proj_id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>msgflag：有两个选项 <strong>IPC_CREAT</strong> 和 <strong>IPC_EXCL</strong></p> <ul><li>单独使用<strong>IPC_CREAT</strong>，如果消息队列不存在则创建之，如果存在则打开返回；</li> <li>单独使用<strong>IPC_EXCL</strong>是没有意义的；</li> <li>两个同时使用，如果消息队列不存在则创建之，如果存在则出错返回。</li> <li>用来分配权限 0777</li></ul></li> <li><p>返回值：成功返回一个非负整数，即消息队列的标识码，失败返回-1</p></li></ul> <h6 id="函数test"><a href="#函数test" class="header-anchor">#</a> 函数test</h6> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;sys/types.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;sys/msg.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;signal.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;unistd.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;stdio.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;stdlib.h&quot;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> msg_key<span class="token punctuation">;</span>
<span class="token comment">//	key_t key= ftok(&quot;./msg&quot;,)</span>
	msg_key <span class="token operator">=</span> <span class="token function">msgget</span><span class="token punctuation">(</span>IPC_PRIVATE<span class="token punctuation">,</span><span class="token number">0777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>msg_key<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;msg create failure \n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;msg create sucess msg_key = %d \n&quot;</span><span class="token punctuation">,</span>msg_key<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">&quot;ipcs -q&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>	
 <span class="token punctuation">}</span> 
</code></pre></div><p>结果</p> <img src="/imags/xxdl_msgget.png" alt="xxdl_msgget"> <h5 id="控制消息队列"><a href="#控制消息队列" class="header-anchor">#</a> 控制消息队列</h5> <h6 id="函数原型-2"><a href="#函数原型-2" class="header-anchor">#</a> 函数原型</h6> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/ipc.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/msg.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">msgctl</span><span class="token punctuation">(</span><span class="token keyword">int</span> msqid<span class="token punctuation">,</span> <span class="token keyword">int</span> cmd<span class="token punctuation">,</span> <span class="token keyword">struct</span> <span class="token class-name">msqid_ds</span> <span class="token operator">*</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h6 id="函数参数-2"><a href="#函数参数-2" class="header-anchor">#</a> 函数参数</h6> <ul><li>msqid：由msgget函数返回的消息队列标识码</li> <li>cmd：有三个可选的值，在此我们使用IPC_RMID
<ul><li><strong>IPC_STAT</strong> 把msqid_ds结构中的数据设置为消息队列的当前关联值</li> <li><strong>IPC_SET</strong> 在进程有足够权限的前提下，把消息队列的当前关联值设置为msqid_ds数据结构中给出的值</li> <li><strong>IPC_RMID</strong> 删除消息队列</li></ul></li> <li>返回值：成功返回0，失败返回-1</li></ul> <h6 id="函数test-2"><a href="#函数test-2" class="header-anchor">#</a> 函数test</h6> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;sys/types.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;sys/msg.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;signal.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;unistd.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;stdio.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;stdlib.h&quot;</span></span>


<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> msg_key<span class="token punctuation">;</span>
	msg_key <span class="token operator">=</span> <span class="token function">msgget</span><span class="token punctuation">(</span>IPC_PRIVATE<span class="token punctuation">,</span><span class="token number">0777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>msg_key<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;msg create failure \n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;msg create sucess msg_key = %d \n&quot;</span><span class="token punctuation">,</span>msg_key<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">&quot;ipcs -q&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//delete test</span>
	<span class="token function">msgctl</span><span class="token punctuation">(</span>msg_key<span class="token punctuation">,</span>IPC_RMID<span class="token punctuation">,</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">&quot;ipcs -q&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>	
 <span class="token punctuation">}</span>
</code></pre></div><p>结果</p> <img src="/imags/xxdl_msgctl.png" alt="xxdl_msgctl"> <h5 id="消息队列输入"><a href="#消息队列输入" class="header-anchor">#</a> 消息队列输入</h5> <h6 id="函数原型-3"><a href="#函数原型-3" class="header-anchor">#</a> 函数原型</h6> <p>把一条消息添加到消息队列中</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/ipc.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/msg.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">msgsnd</span><span class="token punctuation">(</span><span class="token keyword">int</span> msqid<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>msgp<span class="token punctuation">,</span> <span class="token class-name">size_t</span> msgsz<span class="token punctuation">,</span> <span class="token keyword">int</span> msgflg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h6 id="函数参数-3"><a href="#函数参数-3" class="header-anchor">#</a> 函数参数</h6> <ul><li><p>msgid：由msgget函数返回的消息队列标识码，向谁发送</p></li> <li><p>msgp：指针指向准备发送的消息，发送哪个消息</p> <ul><li>消息结构一方面必须小于系统规定的上限，另一方面必须以一个long int长整型开始，接受者以此来确定消息的类型</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">msgbuf</span>
<span class="token punctuation">{</span>
     <span class="token keyword">long</span> mtype<span class="token punctuation">;</span><span class="token comment">// 消息类型</span>
     <span class="token keyword">char</span> mtext<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 消息正文</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>msgsz：msgp指向的消息的长度，即消息正文的字节数</p></li> <li><p>msgflg：</p> <ul><li>默认为0，直到发送完成函数才返回</li> <li>IPC_NOWAIT 消息没有发送完成函数也会立即返回</li></ul></li> <li><p>返回值：成功返回0，失败返回-1</p></li></ul> <h6 id="函数test-3"><a href="#函数test-3" class="header-anchor">#</a> 函数test</h6> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;sys/types.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;sys/msg.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;signal.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;unistd.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;stdio.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;stdlib.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;string.h&quot;</span></span>

<span class="token keyword">struct</span> <span class="token class-name">msgbuf</span>
<span class="token punctuation">{</span>
	<span class="token keyword">long</span> type<span class="token punctuation">;</span>
	<span class="token keyword">char</span> voltage<span class="token punctuation">[</span><span class="token number">124</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> ID<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> msg_key<span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">msgbuf</span> sendbuf<span class="token punctuation">;</span>
	msg_key <span class="token operator">=</span> <span class="token function">msgget</span><span class="token punctuation">(</span>IPC_PRIVATE<span class="token punctuation">,</span><span class="token number">0777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>msg_key<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;msg create failure \n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;msg create sucess msg_key = %d \n&quot;</span><span class="token punctuation">,</span>msg_key<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">&quot;ipcs -q&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// init sendbuf</span>
	sendbuf<span class="token punctuation">.</span>type<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;please input msg %s\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">fgets</span><span class="token punctuation">(</span>sendbuf<span class="token punctuation">.</span>voltage<span class="token punctuation">,</span><span class="token number">124</span><span class="token punctuation">,</span><span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 
	<span class="token comment">// write msg to queue </span>
	<span class="token function">msgsnd</span><span class="token punctuation">(</span>msg_key<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>sendbuf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>sendbuf<span class="token punctuation">.</span>voltage<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">&quot;ipcs -q&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>	
 <span class="token punctuation">}</span> 
</code></pre></div><p>结果</p> <img src="/imags/xxdl_msgsend.png" alt="xxdl_msgsend"> <h5 id="消息队列输出"><a href="#消息队列输出" class="header-anchor">#</a> 消息队列输出</h5> <h6 id="函数原型-4"><a href="#函数原型-4" class="header-anchor">#</a> 函数原型</h6> <p>从一个消息队列接受消息</p> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/ipc.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/msg.h&gt;</span></span>
<span class="token class-name">ssize_t</span> <span class="token function">msgrcv</span><span class="token punctuation">(</span><span class="token keyword">int</span> msqid<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>msgp<span class="token punctuation">,</span> <span class="token class-name">size_t</span> msgsz<span class="token punctuation">,</span> <span class="token keyword">long</span> msgtype<span class="token punctuation">,</span> <span class="token keyword">int</span> msgflg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h6 id="函数参数-4"><a href="#函数参数-4" class="header-anchor">#</a> 函数参数</h6> <ul><li><p>msgid：由msgget函数返回的消息队列标识码，从哪里读</p></li> <li><p>msgp：指针指向准备读取的消息，读取的消息的内容</p> <ul><li>消息结构一方面必须小于系统规定的上限，另一方面必须以一个long int长整型开始，接受者以此来确定消息的类型</li></ul> <div class="language-c extra-class"><pre class="language-c"><code><span class="token keyword">struct</span> <span class="token class-name">msgbuf</span>
<span class="token punctuation">{</span>
     <span class="token keyword">long</span> mtype<span class="token punctuation">;</span><span class="token comment">// 消息类型</span>
     <span class="token keyword">char</span> mtext<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 消息正文</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>msgsz：msgp想读多少个</p></li> <li><p>msgtype：读取的消息的类型</p> <ul><li>0：接收消息队列中的第一个消息</li> <li>大于0：接收消息队列中第一个类型为msgtype的消息</li> <li>小于0，接收消息队列中类型值不大于msgtype的绝对值且类型值又最小的消息</li></ul></li> <li><p>msgflg：</p> <ul><li>默认为0，没有消息会一直阻塞</li> <li>IPC_NOWAIT 消息没有发送完成函数也会立即返回ENOMSG</li></ul></li> <li><p>返回值：成功返回实际接收到的字符数，失败返回-1</p></li></ul> <h6 id="函数test-4"><a href="#函数test-4" class="header-anchor">#</a> 函数test</h6> <div class="language-c extra-class"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;sys/types.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;sys/msg.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;signal.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;unistd.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;stdio.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;stdlib.h&quot;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;string.h&quot;</span></span>

<span class="token keyword">struct</span> <span class="token class-name">msgbuf</span>
<span class="token punctuation">{</span>
	<span class="token keyword">long</span> type<span class="token punctuation">;</span>
	<span class="token keyword">char</span> voltage<span class="token punctuation">[</span><span class="token number">124</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> ID<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">int</span> msg_key<span class="token punctuation">;</span>
	<span class="token keyword">int</span> msg_ret<span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">msgbuf</span> sendbuf<span class="token punctuation">,</span>recvbuf<span class="token punctuation">;</span>
	msg_key <span class="token operator">=</span> <span class="token function">msgget</span><span class="token punctuation">(</span>IPC_PRIVATE<span class="token punctuation">,</span><span class="token number">0777</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>msg_key<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;msg create failure \n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;msg create sucess msg_key = %d \n&quot;</span><span class="token punctuation">,</span>msg_key<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">&quot;ipcs -q&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// init sendbuf</span>
	sendbuf<span class="token punctuation">.</span>type<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;please input msg %s\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">fgets</span><span class="token punctuation">(</span>sendbuf<span class="token punctuation">.</span>voltage<span class="token punctuation">,</span><span class="token number">124</span><span class="token punctuation">,</span><span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	 
	<span class="token comment">// write msg to queue </span>
	<span class="token function">msgsnd</span><span class="token punctuation">(</span>msg_key<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>sendbuf<span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span>sendbuf<span class="token punctuation">.</span>voltage<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">memset</span><span class="token punctuation">(</span>recvbuf<span class="token punctuation">.</span>voltage<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">124</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// read msg from queue</span>
	msg_ret <span class="token operator">=</span> <span class="token function">msgrcv</span><span class="token punctuation">(</span>msg_key<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>recvbuf<span class="token punctuation">,</span><span class="token number">124</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;recv:%s&quot;</span><span class="token punctuation">,</span>recvbuf<span class="token punctuation">.</span>voltage<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;msg_ret:%d&quot;</span><span class="token punctuation">,</span>msg_ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">&quot;ipcs -q&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>	
 <span class="token punctuation">}</span> 
</code></pre></div><p>结果</p> <img src="/imags/xxdl_msgrcv.png" alt="xxdl_msgrcv"> <h3 id="信号灯"><a href="#信号灯" class="header-anchor">#</a> 信号灯</h3> <blockquote><p><a href="https://www.cnblogs.com/linuxbug/p/4901767.html" target="_blank" rel="noopener noreferrer">Linux进程间通信- 信号灯<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/collection/xtkf.html" class="prev">
        IO-系统开发
      </a></span> <span class="next"><a href="/collection/dxctx.html">
        Linux多线程
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.e2ddde8e.js" defer></script><script src="/assets/js/2.e74445cb.js" defer></script><script src="/assets/js/22.abd1537f.js" defer></script>
  </body>
</html>
